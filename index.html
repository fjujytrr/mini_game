<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hide & Seek ‚Äî Premium Emoji (Updated)</title>
  <style>
:root{   --accent-cyan: #00D8FF;   --birch: #EDE4C8;   --purple-frame: #7a4bff;   --deep-purple: #5a2ecc;   --glass: rgba(255,255,255,0.06); }
/* –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */ html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);background-size:200% 200%;animation:gradientBG 15s ease infinite;color:#fff;overflow:hidden} @keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}} body{display:flex;flex-direction:column;align-items:center;min-height:100vh} /* Header */ header{width:95%;margin:15px 0;display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,0.28);border-radius:12px;padding:10px;backdrop-filter:blur(5px)} .level-bar{display:flex;gap:6px;background:rgba(0,0,0,0.2);padding:6px 10px;border-radius:12px;flex:1;justify-content:space-between} .level{flex:1;text-align:center;padding:6px 0;font-size:14px;font-weight:700;color:#eee;border-radius:8px;background:rgba(255,255,255,0.06);transition:.25s;cursor:pointer} .level.active{background:var(--accent-cyan);color:#000;box-shadow:0 0 8px var(--accent-cyan)} .coin-panel{display:flex;align-items:center;gap:10px;background:rgba(0,0,0,0.28);padding:8px 12px;border-radius:16px;box-shadow:0 0 12px rgba(0,216,255,0.18)} .coin-logo{width:40px;height:40px;border-radius:50%;object-fit:cover;border:3px solid var(--purple-frame);box-shadow:0 6px 18px rgba(122,75,255,0.18);background:#fff} .coin-panel .val{font-weight:700;font-size:18px;color:var(--accent-cyan)} /* –î–æ–º: —Å–µ—Ç–∫–∞ –∫–æ–º–Ω–∞—Ç */ .house{position:relative;width:95%;max-width:500px;margin:20px 0;display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(4,1fr);gap:12px} .room{background:rgba(255,255,255,0.06);border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:28px;color:#fff;cursor:pointer;transition:transform .3s,box-shadow .3s;position:relative;border:2px solid rgba(255,255,255,0.14)} .room:hover{transform:scale(1.05);box-shadow:0 0 18px rgba(0,216,255,0.14)} .room.selected{border-color:var(--accent-cyan);box-shadow:0 0 12px var(--accent-cyan)} .room.found{border-color:#FF0054;box-shadow:0 0 12px #FF0054;animation:foundAnim 1s ease} .room.safe{border-color:#39FF14;box-shadow:0 0 12px #39FF14;animation:safeAnim .8s ease} .room.highlight{box-shadow:0 0 22px 4px var(--accent-cyan);transition:box-shadow .3s} @keyframes foundAnim{0%{transform:scale(1)}50%{transform:rotate(10deg) scale(1.15)}100%{transform:scale(1)}} @keyframes safeAnim{0%{transform:scale(1)}50%{transform:rotate(-10deg) scale(0.95)}100%{transform:scale(1)}} /* –ö–æ–Ω—Ç—Ä–æ–ª—ã */ .controls{width:90%;display:flex;justify-content:space-between;margin-bottom:15px} button{flex:1;margin:0 5px;padding:14px;font-size:20px;border:none;border-radius:12px;cursor:pointer;color:#000;background:var(--accent-cyan);box-shadow:0 4px 12px rgba(0,216,255,0.25);transition:transform .2s,box-shadow .2s} button:active{transform:scale(.98);box-shadow:0 2px 6px rgba(0,216,255,0.18)} button.secondary{background:rgba(0,0,0,0.36);color:#fff;border:1px solid rgba(255,255,255,0.06);box-shadow:0 3px 8px rgba(0,216,255,0.12)} /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */ .bottom-menu{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:90%;max-width:480px;display:flex;justify-content:space-around;gap:8px;background:rgba(0,0,0,0.28);padding:6px 0;border-radius:16px;backdrop-filter:blur(5px);box-shadow:0 0 12px rgba(0,216,255,0.18)} .bottom-menu button{background:transparent;color:#fff;font-size:22px;transition:transform .2s} .bottom-menu button:hover{transform:scale(1.16);color:var(--accent-cyan)} /* –ê–ø–≥—Ä–µ–π–¥—ã */ .upgrade-panel{display:flex;gap:12px;margin:10px 0;overflow-x:auto;padding:12px 10px;width:95%;justify-content:flex-start;align-items:stretch} .upgrade{flex:0 0 auto;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));padding:16px;border-radius:16px;text-align:left;min-width:220px;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.06);transition:transform .18s,box-shadow .18s} .upgrade:hover{transform:translateY(-6px)} .upgrade h3{margin:0 0 8px;font-size:16px;color:var(--accent-cyan)} .upgrade p{margin:0;font-size:14px;color:#eee} .upgrade .price{margin-top:10px;font-weight:800;color:var(--birch);font-size:16px} .upgrade .badge{display:inline-block;margin-top:8px;padding:6px 8px;border-radius:999px;background:rgba(0,0,0,0.18);font-weight:700;color:#fff;font-size:12px} /* Mining info */ .mining-info{margin:10px 0;padding:10px 12px;background:rgba(255,255,255,0.04);border-radius:14px;width:95%;text-align:center;box-shadow:0 2px 6px rgba(0,216,255,0.06)} /* –í–∏–¥–∏–º–∞—è –ø–∞–Ω–µ–ª—å –º–∞–π–Ω–µ—Ä–æ–≤ ‚Äî —É–±–∏—Ä–∞–µ–º —Å –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ */ .miners-panel{display:none;width:95%;max-width:900px;gap:12px;padding:10px;overflow-x:auto;align-items:flex-start;margin-bottom:12px;background:transparent;border-radius:12px} .miners-panel .miner-card{display:none} /* –ú–æ–¥–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω –º–∞–π–Ω–µ—Ä–æ–≤ (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π) */ #miningShop{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:900;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);color:#fff;padding:28px;box-sizing:border-box;overflow-y:auto;border:none} #miningShop h2{color:#ecf8ff;text-align:center;margin-bottom:10px} #miningShop .miners-container{display:flex;flex-wrap:wrap;gap:18px;justify-content:center;padding:8px 6px} #miningShop .miner-card{background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));color:#fff;border-radius:14px;padding:12px;width:160px;display:flex;flex-direction:column;align-items:center;gap:8px;box-shadow:0 10px 30px rgba(0,0,0,0.28);cursor:pointer;transition:transform .18s,box-shadow .18s;border:1px solid rgba(255,255,255,0.06)} #miningShop .miner-card:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(0,0,0,0.35)} #miningShop .card-logo{width:56px;height:56px;border-radius:50%;object-fit:cover;border:3px solid var(--purple-frame);background:#fff;box-shadow:0 6px 18px rgba(122,75,255,0.12)} #miningShop .miner-card h3{margin:6px 0 2px;font-size:16px;color:#f0fbff} #miningShop .miner-card .income{color:var(--birch);font-weight:800} #miningShop .miner-card .bottom{width:100%;display:flex;justify-content:space-between;font-weight:800;font-size:14px;margin-top:6px} #miningShop .price-pill{background:rgba(0,0,0,0.14);padding:6px 8px;border-radius:10px;font-weight:800} /* –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏: —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ */ #buyConfirm{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;background:transparent;padding:0;box-sizing:border-box} #buyConfirm .confirm-box{max-width:520px;margin:0;background:linear-gradient(120deg, rgba(90,46,204,0.95), rgba(122,75,255,0.95));border:2px solid var(--accent-cyan);border-radius:12px;padding:14px;text-align:center;box-shadow:0 8px 30px rgba(122,75,255,0.18)} #buyConfirm.show{display:block} #buyConfirm p{color:#fff;margin:8px 0} #buyConfirm button{margin:6px 6px;padding:8px 12px;font-weight:700;background:var(--accent-cyan);color:#000;border:none;border-radius:8px} /* Info & Profile: —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–µ, –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω –∫–∞–∫ –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω */ #infoWindow, #profileWindow{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:800;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);color:#fff;padding:28px;box-sizing:border-box;overflow-y:auto} #infoWindow .content, #profileWindow .content{max-width:1100px;margin:24px auto;border-radius:16px;padding:18px;background:rgba(0,0,0,0.22);color:#fff;box-shadow:0 10px 30px rgba(0,0,0,0.28);border:1px solid rgba(255,255,255,0.04)} #infoWindow h2, #profileWindow h2{color:#ecf8ff;margin-bottom:10px} #infoWindow ul{color:#eaf2ff;padding-left:20px} #infoWindow ul li::before{content:'‚Ä¢ ';color:var(--accent-cyan);font-weight:600} #infoWindow button, #profileWindow button{width:100%;margin-top:12px;padding:12px;font-size:18px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700} /* Profile specific content */ .settings-card{margin-top:12px;padding:12px;background:rgba(255,255,255,0.03);border-radius:12px;border:1px solid rgba(255,255,255,0.03)} .settings-row{display:flex;align-items:center;justify-content:space-between;gap:12px} .select-lang{Padding:8px 10px;border-radius:8px;border:none;font-weight:700} /* –ê–¥–∞–ø—Ç–∏–≤ */ @media (max-width:520px){   .coin-logo{width:34px;height:34px;border-width:2px}   button{font-size:18px;padding:12px}   #miningShop .miner-card{width:46%}   .upgrade{min-width:160px} }   </style>
</head>
<body>
  <header>
    <div class="level-bar">
   <div class="level" data-val="10000">10K</div>
   <div class="level" data-val="100000">100K</div>
   <div class="level" data-val="1000000">1M</div>
   <div class="level" data-val="5000000">5M</div>
 </div>
 <div class="coin-panel">
      <img class="coin-logo" src="logo.png" alt="Coin logo" />
      <div class="val" id="coinsVal">0</div>
    </div>
  </header>

   <div class="house"></div>

   <div class="controls">
    <button id="startBtn">üè†</button>
    <button class="secondary" id="resetBtn">üîç</button>
  </div>

  <!-- –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–∞–Ω–µ–ª—å –∞–ø–≥—Ä–µ–π–¥–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ -->
  <div class="upgrade-panel" id="upgradePanel">
    <div class="upgrade" data-key="x2Prize" data-base-price="20000">
      <h3>x2 Prize / x2 Loss</h3>
      <p>Double rewards & penalties</p>
      <div class="price">20,000</div>
      <div class="badge">Boost</div>
    </div>
    <div class="upgrade" data-key="check1" data-base-price="20000">
      <h3>Check 1 Room Only</h3>
      <p>Hunter checks 1 room only (1 min)</p>
      <div class="price">20,000</div>
      <div class="timer" id="check1Timer"></div>
    </div>
  </div>

  <div class="mining-info">
    <strong id="miningLabel">Mining Income:</strong> <span id="miningIncomeVal">0</span>/hr
  </div>

  <!-- –°–∫—Ä—ã—Ç–∞—è –ø–∞–Ω–µ–ª—å –º–∞–π–Ω–µ—Ä–æ–≤ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞ –≥–ª–∞–≤–Ω–æ–º) -->
  <div class="miners-panel" id="minersPanelVisible" aria-hidden="true"></div>

  <!-- Modal mining shop (fullscreen modal) -->
  <div id="miningShop" aria-hidden="true">
    <h2 id="shopTitle">Mining Shop</h2>
    <div class="miners-container"></div>
    <button id="closeMiningShop" style="margin-top:12px;width:100%;padding:12px;font-size:18px;border:none;border-radius:12px;background:rgba(0,0,0,0.22);color:#fff;cursor:pointer;">Close</button>
  </div>

  <!-- Buy confirm -->
  <div id="buyConfirm" aria-hidden="true">
    <div class="confirm-box">
      <p id="buyText"></p>
      <div style="display:flex;justify-content:center;">
        <button id="confirmBuy">Buy</button>
        <button id="cancelBuy">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Info window (—Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–∞—è, –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è) -->
  <div id="infoWindow" aria-hidden="true">
    <div class="content">
      <h2 id="infoTitle">How to Play</h2>
      <ul id="infoList">
        <li>Select a room and then click the üîç button to hunt.</li>
        <li>The hunter searches 2 random rooms (1 if "Check 1 Room" is active).</li>
        <li>If your room is found, you lose coins (shown in red).</li>
        <li>If you evade the hunt, you gain coins (shown in green).</li>
        <li>Buy upgrades or miners to improve your chances and income.</li>
        <li>Claim daily rewards and complete quests for bonus coins.</li>
      </ul>
      <button id="closeInfo">Close</button>
    </div>
  </div>

  <!-- Profile window (—Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–∞—è, –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è) -->
  <div id="profileWindow" aria-hidden="true">
    <div class="content">
      <h2 id="profileTitle">Profile</h2>

       <div style="margin-bottom:16px;padding:16px;background:rgba(0,0,0,0.06);border-radius:12px;">
        <h3 id="dailyTitle" style="margin-bottom:8px;font-size:18px;color:#ecf8ff">Daily Reward</h3>
        <p id="dailyText" style="margin-bottom:12px;color:#fff">Get 30,000 coins once a day!</p>
        <button id="claimDaily" style="width:100%;padding:12px;font-size:16px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Claim Daily</button>
        <p id="dailyStatus" style="margin-top:8px;color:var(--birch);font-weight:600;text-align:center;"></p>
      </div>

       <div style="margin-bottom:16px;padding:16px;background:rgba(0,0,0,0.06);border-radius:12px;">
        <h3 id="questTitle" style="margin-bottom:8px;font-size:18px;color:#ecf8ff">Quest</h3>
        <p id="questText" style="margin-bottom:12px;color:#fff">Subscribe to get bonus coins!</p>
        <button id="claimQuest" style="width:100%;padding:12px;font-size:16px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Claim Quest</button>
        <p id="questStatus" style="margin-top:8px;color:var(--birch);font-weight:600;text-align:center;"></p>
      </div>

       <div class="settings-card">
        <div class="settings-row">
          <div>
            <h3 id="settingsTitle">Settings</h3>
            <p id="settingsText">Change language and other preferences.</p>
          </div>
          <div>
            <select id="langSelect" class="select-lang">
              <option value="ru">–†—É—Å—Å–∫–∏–π</option>
              <option value="en">English</option>
            </select>
          </div>
        </div>
      </div>

      <button id="closeProfile" style="width:100%;padding:14px;font-size:18px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Close</button>
    </div>
  </div>

  <div class="bottom-menu">
    <button id="infoBtn" class="secondary">‚Ñπ</button>
    <button id="shopBtn" class="secondary">üõí</button>
    <button id="miningBtn" class="secondary">‚õè</button>
    <button id="profileBtn" class="secondary">üë§</button>
  </div>

  <script>
  /* ==========================    –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π JS (–≥–æ—Ç–æ–≤–æ)    ========================== */ 
 // ========== –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è ========== 
 const i18n = {
  ru: {
    pickRoomFirst: '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É!',
    notEnough: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!',
    dailyAlready: '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–∞!',
    questAlready: '–ö–≤–µ—Å—Ç —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω!',
    miningIncome: '–î–æ—Ö–æ–¥ –º–∞–π–Ω–∏–Ω–≥–∞:',
    miningShop: '–ú–∞–≥–∞–∑–∏–Ω –º–∞–π–Ω–∏–Ω–≥–∞',
    close: '–ó–∞–∫—Ä—ã—Ç—å',
    howToPlay: '–ö–∞–∫ –∏–≥—Ä–∞—Ç—å',
    infoList: [
      '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É üîç –¥–ª—è –æ—Ö–æ—Ç—ã.',
      '–û—Ö–æ—Ç–Ω–∏–∫ –∏—â–µ—Ç 2 —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã (1, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω "Check 1 Room").',
      '–ï—Å–ª–∏ –≤–∞—à—É –∫–æ–º–Ω–∞—Ç—É –Ω–∞—à–ª–∏, –≤—ã —Ç–µ—Ä—è–µ—Ç–µ –º–æ–Ω–µ—Ç—ã (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫—Ä–∞—Å–Ω—ã–º).',
      '–ï—Å–ª–∏ –≤—ã –∏–∑–±–µ–∂–∞–ª–∏ –æ—Ö–æ—Ç—ã, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –º–æ–Ω–µ—Ç—ã (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∑–µ–ª–µ–Ω—ã–º).',
      '–ü–æ–∫—É–ø–∞–π—Ç–µ –∞–ø–≥—Ä–µ–π–¥—ã –∏–ª–∏ –º–∞–π–Ω–µ—Ä–æ–≤, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å —à–∞–Ω—Å—ã –∏ –¥–æ—Ö–æ–¥.',
      '–ó–∞–±–∏—Ä–∞–π—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∫–≤–µ—Å—Ç—ã –¥–ª—è –±–æ–Ω—É—Å–Ω—ã—Ö –º–æ–Ω–µ—Ç.'
    ],
    profile: '–ü—Ä–æ—Ñ–∏–ª—å',
    dailyReward: '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞',
    dailyText: '–ü–æ–ª—É—á–∏—Ç–µ 30 000 –º–æ–Ω–µ—Ç —Ä–∞–∑ –≤ –¥–µ–Ω—å!',
    claimDaily: '–ó–∞–±—Ä–∞—Ç—å',
    quest: '–ö–≤–µ—Å—Ç',
    claimQuest: '–í–∑—è—Ç—å',
    settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
    settingsText: '–°–º–µ–Ω–∏—Ç–µ —è–∑—ã–∫ –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.',
    buyFor: '–ö—É–ø–∏—Ç—å {name} –∑–∞ {price}?',
    buy: '–ö—É–ø–∏—Ç—å',
    cancel: '–û—Ç–º–µ–Ω–∞',
    profitHr: '–ü—Ä–∏–±—ã–ª—å/—á:'
  },
  en: {
    pickRoomFirst: 'Pick a room first!',
    notEnough: 'Not enough coins!',
    dailyAlready: 'Daily reward already claimed!',
    questAlready: 'Quest already claimed!',
    miningIncome: 'Mining Income:',
    miningShop: 'Mining Shop',
    close: 'Close',
    howToPlay: 'How to Play',
    infoList: [
      'Select a room and then click the üîç button to hunt.',
      'The hunter searches 2 random rooms (1 if "Check 1 Room" is active).',
      'If your room is found, you lose coins (shown in red).',
      'If you evade the hunt, you gain coins (shown in green).',
      'Buy upgrades or miners to improve your chances and income.',
      'Claim daily rewards and complete quests for bonus coins.'
    ],
    profile: 'Profile',
    dailyReward: 'Daily Reward',
    dailyText: 'Get 30,000 coins once a day!',
    claimDaily: 'Claim Daily',
    quest: 'Quest',
    claimQuest: 'Claim Quest',
    settings: 'Settings',
    settingsText: 'Change language and other preferences.',
    buyFor: 'Buy {name} for {price}?',
    buy: 'Buy',
    cancel: 'Cancel',
    profitHr: 'Profit/hr:'
  }
};
let lang = localStorage.getItem('lang') || 'ru';
function t(key, vars = {}) {
  const val = i18n[lang][key];
  if (typeof val === 'string') {
    return val.replace(/\{(\w+)\}/g, (_, k) => vars[k] || '');
  }
  return val;
}
function applyLang() {
  document.getElementById('miningLabel').textContent = t('miningIncome');
  document.getElementById('shopTitle').textContent = t('miningShop');
  document.getElementById('closeMiningShop').textContent = t('close');
  document.getElementById('confirmBuy').textContent = t('buy');
  document.getElementById('cancelBuy').textContent = t('cancel');
  document.getElementById('infoTitle').textContent = t('howToPlay');
  document.getElementById('profileTitle').textContent = t('profile');
  document.getElementById('dailyTitle').textContent = t('dailyReward');
  document.getElementById('dailyText').textContent = t('dailyText');
  document.getElementById('claimDaily').textContent = t('claimDaily');
  document.getElementById('questTitle').textContent = t('quest');
  document.getElementById('claimQuest').textContent = t('claimQuest');
  document.getElementById('settingsTitle').textContent = t('settings');
  document.getElementById('settingsText').textContent = t('settingsText');
  document.getElementById('closeInfo').textContent = t('close');
  document.getElementById('closeProfile').textContent = t('close');
  // info list
  const infoListEl = document.getElementById('infoList');
  infoListEl.innerHTML = '';
  t('infoList').forEach(li => { const el = document.createElement('li'); el.textContent = li; infoListEl.appendChild(el); });
}

// ========== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è ==========
const roomsContainer = document.querySelector('.house');
for (let i = 0; i < 8; i++) {
  const d = document.createElement('div');
  d.className = 'room';
  d.dataset.idx = i;
  d.textContent = '+';
  roomsContainer.appendChild(d);
}
let selectedRoom = null; let coins = +localStorage.getItem('coins') || 0; let maxCoins = +localStorage.getItem('maxCoins') || coins; const coinsVal = document.getElementById('coinsVal'); let upgrades = JSON.parse(localStorage.getItem('upgrades')) || { x2Prize: 0, check1: 0 }; let check1Expire = +localStorage.getItem('check1Expire') || 0; let roundInProgress = false;

// –º–∞–π–Ω–µ—Ä—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞)
const minersData = [
  { n: "Miner 1", i: 500, p: 7000 },
  { n: "Miner 2", i: 1788, p: 12000 },
  { n: "Miner 3", i: 2358, p: 15000 },
  { n: "Miner 4", i: 3000, p: 20000 },
  { n: "Miner 5", i: 4500, p: 25000 },
  { n: "Miner 6", i: 5200, p: 30000 },
  { n: "Miner 7", i: 6100, p: 35000 },
  { n: "Miner 8", i: 7200, p: 40000 },
  { n: "Miner 9", i: 8500, p: 45000 },
  { n: "Miner 10", i: 9500, p: 50000 }
];

// ======= –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è minersState (–µ—Å–ª–∏ –≤ localStorage –º–∞—Å—Å–∏–≤ –∫–æ—Ä–æ—á–µ –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω) 
let minersState; try {
  const saved = JSON.parse(localStorage.getItem('minersState'));
  if (Array.isArray(saved)) {
    minersState = minersData.map((_, i) => {
      const s = saved[i];
      if (s && typeof s.count === 'number') return { count: s.count };
      return { count: 0 };
    });
  } else {
    minersState = minersData.map(_ => ({ count: 0 }));
  }
} catch (e) {
  minersState = minersData.map(_ => ({ count: 0 }));
}

const miningIncomeValEl = document.getElementById('miningIncomeVal'); const minersContainerEl = document.querySelector('.miners-container'); const minersPanelVisible = document.getElementById('minersPanelVisible'); const miningShop = document.getElementById('miningShop'); const buyConfirm = document.getElementById('buyConfirm'); const buyText = document.getElementById('buyText'); let pendingMiner = null;

// —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∏—Å–µ–ª 
function format(n) {
  return n >= 1e9 ? (n/1e9).toFixed(1).replace(/\.0$/,'') + 'B' :
         n >= 1e6 ? (n/1e6).toFixed(1).replace(/\.0$/,'') + 'M' :
         n >= 1e3 ? (n/1e3).toFixed(1).replace(/\.0$/,'') + 'K' : String(n);
}

// —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ 
function save() {
  try {
    localStorage.setItem('coins', coins);
    localStorage.setItem('maxCoins', maxCoins);
    localStorage.setItem('upgrades', JSON.stringify(upgrades));
    localStorage.setItem('check1Expire', check1Expire);
    localStorage.setItem('minersState', JSON.stringify(minersState));
    localStorage.setItem('lastTime', Date.now());
    localStorage.setItem('lang', lang);
  } catch (e) {
    console.warn('Save failed', e);
  }
}

// –æ–±–Ω–æ–≤–∏—Ç—å –º–æ–Ω–µ—Ç—ã 
function updCoins(v = 0) {
  coins += v;
  if (coins < 0) coins = 0;
  if (coins > maxCoins) maxCoins = coins;
  coinsVal.textContent = format(coins);
  updLv();
  updUpg();
  updIncome();
  save();
}

// –¥–æ—Ö–æ–¥ –≤ —á–∞—Å (—Å –∑–∞—â–∏—Ç–æ–π –Ω–∞ —Å–ª—É—á–∞–π undefined) 
function getIncome() {
  return minersState.reduce((sum, m, i) => {
    const count = (m && typeof m.count === 'number') ? m.count : 0;
    return sum + (count > 0 ? Math.floor(minersData[i].i * Math.pow(1.5, count - 1)) : 0);
  }, 0);
}
function updIncome() { miningIncomeValEl.textContent = format(getIncome()); }

// –æ—Ñ—Ñ–ª–∞–π–Ω-–¥–æ—Ö–æ–¥ 
function addOfflineCoins() {
  const last = +localStorage.getItem('lastTime') || Date.now();
  const now = Date.now();
  const diffMinutes = (now - last) / 60000;
  if (diffMinutes > 0) {
    const minutesToAward = Math.min(diffMinutes, 180);
    updCoins(Math.floor(getIncome()/60 * minutesToAward));
  }
  localStorage.setItem('lastTime', now);
}
addOfflineCoins();

// –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
setInterval(()=>{ updCoins(Math.floor(getIncome()/3600)); }, 1000);

// —É—Ä–æ–≤–Ω–∏ 
function updLv() { document.querySelectorAll('.level').forEach(l => l.classList.toggle('active', maxCoins >= +l.dataset.val)); }

// –∞–ø–¥–µ–π—Ç—ã –∞–ø–≥—Ä–µ–π–¥–æ–≤ 
function updUpg() {
  document.querySelectorAll('.upgrade').forEach(u => {
    let key = u.dataset.key; let base = +u.dataset.basePrice; let count = upgrades[key] || 0;
    let price = base * Math.pow(2,count);
    let priceEl = u.querySelector('.price'); if (priceEl) priceEl.textContent = format(price);
    const badge = u.querySelector('.badge'); if (badge) badge.textContent = count > 0 ? `Lvl ${count}` : 'New';
  });
}

// –∞–ø–≥—Ä–µ–π–¥—ã –∫–ª–∏–∫–∏
document.querySelectorAll('.upgrade').forEach(u=>{
  u.onclick = ()=>{
    let key = u.dataset.key; let base = +u.dataset.basePrice; let count = upgrades[key]||0;
    let price = base * Math.pow(2,count);
    if (coins >= price) {
      upgrades[key] = count+1; updCoins(-price);
      if (key === 'check1') check1Expire = Date.now()+60000;
      save(); updUpg();
    } else alert(t('notEnough'));
  };
});

// —Ç–∞–π–º–µ—Ä check1 
function updCheck() {
  const el = document.getElementById('check1Timer');
  if (check1Expire > Date.now()) el.textContent = '‚è≥ ' + Math.floor((check1Expire - Date.now())/1000) + 's';
  else el.textContent = '';
}
setInterval(updCheck, 1000);

// –≤—ã–±–æ—Ä –∫–æ–º–Ω–∞—Ç—ã
document.querySelectorAll('.room').forEach(r => {
  r.onclick = () => {
    if (roundInProgress) return;
    document.querySelectorAll('.room').forEach(x=>x.classList.remove('selected'));
    r.classList.add('selected');
    selectedRoom = +r.dataset.idx;
  };
});

// start button
document.getElementById('startBtn').onclick = ()=>{
  if (selectedRoom == null) { alert(t('pickRoomFirst')); return; }
  document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe'));
};

// reset / hunt
document.getElementById('resetBtn').onclick = ()=>{
  if (selectedRoom == null) { alert(t('pickRoomFirst')); return; }
  roundInProgress = true;
  const numPicks = (check1Expire > Date.now()) ? 1 : 2;
  let picks = [...Array(8).keys()].sort(()=>0.5-Math.random()).slice(0,numPicks);
  document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe','highlight'));
  let delay = 0;
  picks.forEach(i=>{
    let room = document.querySelector(`.room[data-idx="${i}"]`);
    setTimeout(()=>{ room.classList.add('highlight'); }, delay);
    setTimeout(()=>{ room.classList.remove('highlight'); }, delay+600);
    delay += 700;
  });
  setTimeout(()=>{
    let prize = 1000, loss = -2000;
    if (upgrades.x2Prize > 0) { prize *= Math.pow(2, upgrades.x2Prize); loss *= Math.pow(2, upgrades.x2Prize); }
    if (picks.includes(selectedRoom)) {
      const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
      room.classList.add('found');
      updCoins(loss);
    } else {
      const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
      room.classList.add('safe');
      updCoins(prize);
    }
    selectedRoom = null;
    document.querySelectorAll('.room').forEach(r=>r.classList.remove('selected'));
    roundInProgress = false;
  }, delay+700);
};

// render miners cards (—Ç–æ–ª—å–∫–æ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ) ‚Äî —Å –∑–∞—â–∏—Ç–æ–π –Ω–∞ undefined 
function renderMiners(){
  if (!minersContainerEl) return;
  minersContainerEl.innerHTML = '';
  minersData.forEach((m,i)=>{
    // –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
    const st = (minersState[i] && typeof minersState[i].count === 'number') ? minersState[i] : { count: 0 };
    const price = m.p * Math.pow(2, st.count);
    const income = st.count > 0 ? Math.floor(m.i * Math.pow(1.5, st.count - 1)) : 0;
     const card = document.createElement('div'); card.className = 'miner-card';
    card.innerHTML = `
      <img class="card-logo" src="logo.png" alt="logo" />
      <h3>${m.n}</h3>
      <div class="income">+${format(income)} / hr</div>
      <div class="bottom">
        <span class="lvl">Lvl ${st.count}</span>
        <span class="price-pill">${format(price)}</span>
      </div>
    `;
    card.onclick = ()=>{
      // —Å–Ω–æ–≤–∞ –∑–∞—â–∏—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã
      const currentSt = (minersState[i] && typeof minersState[i].count === 'number') ? minersState[i] : { count: 0 };
      const currentPrice = m.p * Math.pow(2, currentSt.count);
      if (coins >= currentPrice) {
        pendingMiner = i;
        buyText.textContent = t('buyFor', { name: m.n, price: format(currentPrice) });
        buyConfirm.classList.add('show'); buyConfirm.style.display = 'block'; buyConfirm.setAttribute('aria-hidden','false');
      } else { alert(t('notEnough')); }
    };
    minersContainerEl.appendChild(card);
  });
}

// –æ—Ç–∫—Ä—ã—Ç—å/–∑–∞–∫—Ä—ã—Ç—å miningShop // miningBtn (–∫–∏—Ä–∫–∞) –∏ shopBtn (—Ç–µ–ª–µ–∂–∫–∞) ‚Äî –æ–±–∞ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –º–∞–≥–∞–∑–∏–Ω
const miningBtn = document.getElementById('miningBtn'); const shopBtn = document.getElementById('shopBtn');
miningBtn.onclick = () => { miningShop.style.display = 'block'; miningShop.setAttribute('aria-hidden','false'); renderMiners(); };
shopBtn.onclick = () => { miningShop.style.display = 'block'; miningShop.setAttribute('aria-hidden','false'); renderMiners(); };
document.getElementById('closeMiningShop').onclick = ()=>{ miningShop.style.display = 'none'; miningShop.setAttribute('aria-hidden','true'); };

// buy confirm actions
document.getElementById('confirmBuy').onclick = ()=>{
  if (pendingMiner === null) return;
  const i = pendingMiner; const m = minersData[i]; const st = minersState[i] || { count: 0 };
  const price = m.p * Math.pow(2, st.count);
  if (coins >= price) {
    coins -= price; minersState[i] = { count: (st.count || 0) + 1 }; updCoins(0); save(); renderMiners();
  } else alert(t('notEnough'));
  pendingMiner = null;
  buyConfirm.classList.remove('show'); buyConfirm.style.display = 'none'; buyConfirm.setAttribute('aria-hidden','true');
};
document.getElementById('cancelBuy').onclick = ()=>{ pendingMiner = null; buyConfirm.classList.remove('show'); buyConfirm.style.display = 'none'; buyConfirm.setAttribute('aria-hidden','true'); };

// profile window 
const profileWindowEl = document.getElementById('profileWindow'); document.getElementById('profileBtn').onclick = ()=>{ profileWindowEl.style.display = 'block'; profileWindowEl.setAttribute('aria-hidden','false'); };
document.getElementById('closeProfile').onclick = ()=>{ profileWindowEl.style.display = 'none'; profileWindowEl.setAttribute('aria-hidden','true'); };

// daily & quest 
let questClaimed = localStorage.getItem('questClaimed') === 'true'; let lastDaily = +localStorage.getItem('lastDaily') || 0; const questStatusEl = document.getElementById('questStatus'); const dailyStatusEl = document.getElementById('dailyStatus'); function updateQuestStatus(){ questStatusEl.textContent = questClaimed ? "‚úÖ Completed" : "‚ùå Not claimed"; } function updateDailyStatus(){ const now = Date.now(); const nextAvailable = lastDaily + 24*60*60*1000; if (now >= nextAvailable) dailyStatusEl.textContent = "üí∞ Available!"; else { const diff = nextAvailable - now; const hours = Math.floor(diff / (1000*60*60)); const minutes = Math.floor((diff % (1000*60*60)) / (1000*60)); dailyStatusEl.textContent = `Next in ${hours}h ${minutes}m`; } } setInterval(updateDailyStatus, 60000); updateDailyStatus(); updateQuestStatus();

document.getElementById('claimQuest').onclick = ()=>{ if (questClaimed) alert(t('questAlready')); else { updCoins(50000); questClaimed = true; localStorage.setItem('questClaimed','true'); updateQuestStatus(); } };
document.getElementById('claimDaily').onclick = ()=>{ const now = Date.now(); if (now - lastDaily < 24*60*60*1000) alert(t('dailyAlready')); else { updCoins(30000); lastDaily = now; localStorage.setItem('lastDaily', now); updateDailyStatus(); } };

// info window 
const infoWindowEl = document.getElementById('infoWindow'); document.getElementById('infoBtn').onclick = ()=>{ infoWindowEl.style.display = 'block'; infoWindowEl.setAttribute('aria-hidden','false'); };
document.getElementById('closeInfo').onclick = ()=>{ infoWindowEl.style.display = 'none'; infoWindowEl.setAttribute('aria-hidden','true'); };

// shop toggle: —Ç–µ–ø–µ—Ä—å shopBtn –∏ miningBtn –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –º–∞–≥–∞–∑–∏–Ω; –Ω–∞ –≥–ª–∞–≤–Ω–æ–º ‚Äî —Ç–æ–ª—å–∫–æ upgradePanel –≤–∏–¥–Ω–∞
const upgradePanel = document.getElementById('upgradePanel'); // –°–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–∏–º—É—é –ø–∞–Ω–µ–ª—å –º–∞–π–Ω–µ—Ä–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–ø–≥—Ä–µ–π–¥—ã
minersPanelVisible.style.display = 'none'; upgradePanel.style.display = 'flex';

// language selector 
const langSelect = document.getElementById('langSelect'); langSelect.value = lang; langSelect.onchange = ()=>{ lang = langSelect.value; localStorage.setItem('lang', lang); applyLang(); renderMiners(); };

// init UI coinsVal.textContent = format(coins); updLv(); updUpg(); updIncome(); updCheck(); renderMiners(); applyLang();

// ensure windows hidden on load document.getElementById('infoWindow').style.display = 'none'; document.getElementById('infoWindow').setAttribute('aria-hidden','true'); document.getElementById('profileWindow').style.display = 'none'; document.getElementById('profileWindow').setAttribute('aria-hidden','true'); buyConfirm.style.display = 'none'; buyConfirm.setAttribute('aria-hidden','true');

  </script>

  <!-- =================== Rewards modal: –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–†–ê–ó–ú–ï–†–´ –û–¢–ö–û–†–†–ï–ö–¢–ò–†–û–í–ê–ù–´) =================== -->

  <style>
    /* –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Å—Ç–∏–ª—å –º–æ–¥–∞–ª–∞ (–Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã) */
    #wsModalOverlay{ --wm-accentA:#3b2a7a; --wm-accentB:#8aa7ff; --wm-accentC:#00D8FF; --wm-birch:#EDE4C8; z-index:10000; position:fixed; inset:0; display:flex; align-items:flex-start; justify-content:center; font-family:Inter,system-ui,Arial,sans-serif; }
    #wsModalOverlay.hidden{ display:none; }
    #wsModalOverlay .bgLayer{
      position:absolute; inset:0; background:linear-gradient(120deg,var(--wm-accentA),var(--wm-accentB)); display:block;
      overflow:hidden;
    }
    #wsModalOverlay .bgImage{
      position:absolute; inset:0; background-image:url('fon.png'); background-size:cover; background-position:center; filter:blur(6px) saturate(1.05); mix-blend-mode:overlay; opacity:0.28;
    }
    /* –ò–∑–º–µ–Ω–µ–Ω–æ: .glass —Ç–µ–ø–µ—Ä—å –≥–∏–±–∫–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, –ø–æ—Ç–µ—Ä—è–Ω–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ —É –∫–∞—Ä—Ç–æ—á–µ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ */
    #wsModalOverlay .glass{
      position:fixed;
      top:0;
      bottom:0;
      left:50%;
      transform:translateX(-50%);
      width:100%;
      max-width:980px;
      height:100vh;
      margin:0;
      box-sizing:border-box;
      padding:18px 18px 16px 18px;
      /* –∫–∞—Å–∞–µ–º—Å—è —Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É, —É–±–∏—Ä–∞–µ–º —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è —Å–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É, –æ—Å—Ç–∞–≤–ª—è–µ–º –º—è–≥–∫–∏–µ —É–≥–ª—ã –ø–æ –±–æ–∫–∞–º */
      border-radius:0;
      backdrop-filter: blur(8px) saturate(1.05);
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      box-shadow: 0 0 0 rgba(0,0,0,0);
      display:flex; flex-direction:column; gap:12px; overflow:hidden; z-index:10001;
    }

    /* –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–∫, —á—Ç–æ–±—ã –≤–µ—Å—å –±–ª–æ–∫ –∑–∞–Ω–∏–º–∞–ª –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –±–µ–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ */
    .rewardsContainer{
      background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(255,255,255,0.02));
      border-radius:14px;
      padding:12px;
      box-shadow:0 8px 30px rgba(0,0,0,0.36);
      border:1px solid rgba(255,255,255,0.04);
      /* —Ç–µ–ø–µ—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ .glass –∏ —Ä–∞–∑–º–µ—â–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É */
      display:flex; flex-direction:column; flex:1; min-height:0; overflow:hidden;
    }

    .gridsWrap{ flex:1; min-height:0; overflow:auto; }

    .wsActions{ flex-shrink:0; }

    /* Header */
    #wsModalOverlay .header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:6px; color:#ecf8ff; position:relative; z-index:3; }
    #wsModalOverlay .title{ font-size:20px; font-weight:800; letter-spacing:0.2px; display:flex; align-items:center; gap:10px; }
    #wsModalOverlay .title .coinIcon{ width:36px; height:36px; border-radius:50%; background:linear-gradient(90deg,var(--wm-accentC),#00A8FF); display:inline-flex; align-items:center; justify-content:center; color:#000; font-weight:900; box-shadow:0 8px 28px rgba(0,216,255,0.12); }
    #wsModalOverlay .sub{ color:var(--wm-birch); font-weight:700; font-size:14px; }

    /* Rewards shell: —É–º–µ–Ω—å—à–∏–ª–∏ "–≤—ã—Å–æ—Ç—É" –∏ —Å–¥–µ–ª–∞–ª–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º—ã–º, —á—Ç–æ–±—ã –∫–∞—Ä—Ç–æ—á–∫–∏ –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ */
    .rewardsShell{ display:flex; flex-direction:column; gap:12px; /* –∑–∞–Ω–∏–º–∞–µ—Ç –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –≤–Ω—É—Ç—Ä–∏ .glass */ flex:1; min-height:0; }
    .rewardsContainer{ background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(255,255,255,0.02)); border-radius:14px; padding:12px; box-shadow:0 8px 30px rgba(0,0,0,0.36); border:1px solid rgba(255,255,255,0.04); /* –∑–∞–ø–æ–ª–Ω—è–µ—Ç –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∏ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –Ω–∏–∑–∞ */ flex:1; min-height:0; overflow:auto; }
    .rewardsContainer{ background:linear-gradient(180deg, rgba(0,0,0,0.18), rgba(255,255,255,0.02)); border-radius:14px; padding:12px; box-shadow:0 8px 30px rgba(0,0,0,0.36); border:1px solid rgba(255,255,255,0.04);
      /* –û–≥—Ä–∞–Ω–∏—á–∏–º –≤—ã—Å–æ—Ç—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –≤–∫–ª—é—á–∏–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏ */
      max-height: calc(70vh - 110px); overflow:auto;
    }

    .rewardsGridTop{ display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:12px; }
    .rewardsGridBottom{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px; }
    .rewardCard{ background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:12px; min-height:86px; display:flex; flex-direction:column; align-items:center; justify-content:center; position:relative; transition:transform .16s ease, box-shadow .16s ease; cursor:pointer; border:1px solid rgba(255,255,255,0.04); }
    .rewardCard:hover{ transform:translateY(-6px); }
    .rewardCard.pop{ animation:pop .26s ease; }
    @keyframes pop{ 0%{ transform:scale(1); } 50%{ transform:scale(1.06);} 100%{ transform:scale(1); } }

    .rewardCard .coinIconSmall{ width:44px; height:44px; border-radius:50%; background:linear-gradient(90deg,var(--wm-accentC),#00A8FF); display:flex; align-items:center; justify-content:center; font-weight:800; color:#000; margin-bottom:8px; border:2px solid rgba(255,255,255,0.06); box-shadow:0 8px 18px rgba(0,216,255,0.08); }
    .rewardCard .dayLabel{ font-weight:800; color:#ecf8ff; margin-bottom:6px; }
    .rewardCard .amount{ font-weight:900; font-size:16px; color:var(--wm-accentC); text-shadow: 0 6px 18px rgba(0,216,255,0.08); }
    .rewardCard.locked{ opacity:0.36; pointer-events:auto; }
    .rewardCard.locked .overlay{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(0,0,0,0.36), rgba(0,0,0,0.6)); border-radius:12px; color:#fff; font-weight:800; text-align:center; padding:6px; font-size:13px; }
    .rewardCard.unlocked{ box-shadow:0 10px 30px rgba(0,216,255,0.06); border:1px solid rgba(0,216,255,0.12); }
    .rewardCard.claimed{ opacity:0.9; pointer-events:none; }
    .rewardCard .claimBadge{ position:absolute; top:8px; right:8px; background:linear-gradient(90deg,#FFD54A,#FFC107); color:#000; padding:6px 8px; border-radius:999px; font-weight:800; box-shadow:0 6px 20px rgba(255,193,7,0.12); font-size:12px; }

    .rewardCard.big{ min-height:120px; padding:18px; }

    /* Bottom actions */
    .wsActions{ display:flex; gap:12px; margin-top:12px; align-items:center; justify-content:space-between; }
    .wsActions .left{ color:var(--wm-birch); font-weight:700; }
    .btnPrimary{
      padding:12px 18px; border-radius:12px; font-weight:900; border:none; cursor:pointer;
      background:linear-gradient(90deg,var(--wm-accentC),#00A8FF); color:#000; box-shadow:0 12px 36px rgba(0,216,255,0.18);
    }
    .btnGhost{
      padding:10px 14px; border-radius:12px; font-weight:800; border:1px solid rgba(255,255,255,0.06); background:transparent; color:#ecf8ff; cursor:pointer;
    }

    /* Responsive tweaks */
    @media (max-width:720px){
      .rewardsContainer{ max-height: calc(60vh - 90px); }
      .rewardsGridTop{ grid-template-columns:repeat(2,1fr); }
      .rewardsGridBottom{ grid-template-columns:repeat(2,1fr); }
      .glass{ padding:12px; border-radius:12px 12px 0 0; }
      .rewardCard.big{ min-height:100px; }
    }
  </style>

  <div id="wsModalOverlay" aria-hidden="false" role="dialog" aria-label="Daily rewards modal">
    <div class="bgLayer" aria-hidden="true">
      <div class="bgImage" aria-hidden="true"></div>
    </div>

    <div class="glass" role="document" aria-modal="true">
      <div class="header">
        <div class="title">
          <div class="coinIcon">üíé</div>
          <div>
            <div style="font-size:18px">Premium Gifts</div>
            <div class="sub">7 days of rewards ‚Äî claim one per day</div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:800;color:var(--wm-accentC);font-size:18px" id="wsModalCoinsDisplay">0</div>
          <div style="font-size:12px;color:var(--wm-birch)">Coins balance</div>
        </div>
      </div>

      <div class="rewardsShell" id="rewardsShell">
        <div class="rewardsContainer" id="rewardsContainer">
          <div class="gridsWrap" style="flex:1;min-height:0;overflow:auto;padding-right:6px;box-sizing:border-box;">
            <div class="rewardsGridTop" id="rewardsGridTop" aria-hidden="false"></div>
            <div style="height:8px"></div>
            <div class="rewardsGridBottom" id="rewardsGridBottom" aria-hidden="false"></div>
          </div>

          <div class="wsActions">
            <div class="left">Unlocked: <span id="wsUnlockedCount" style="font-weight:900;color:var(--wm-accentC)">0</span>/7</div>
            <div style="display:flex;gap:10px">
              <button class="btnGhost" id="wsBtnRules">How it works</button>
              <button class="btnPrimary" id="wsBtnClose">Come back tomorrow</button>
            </div>
          </div>
        </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
  (function(){
    // ====== Config ======
    const LS_FIRST = 'ws_first_seen_v2';
    const LS_CLAIMED = 'ws_claimed_v2';
    const MAX_DAYS = 7;
    const amounts = [30000,100000,500000,1000000,3000000,6000000,10000000];

    // ====== Safe LS utils ======
    function safeGetJSON(key, fallback){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return fallback;
        const v = JSON.parse(raw);
        return v;
      }catch(e){ return fallback; }
    }
    function safeSetJSON(key, obj){
      try{ localStorage.setItem(key, JSON.stringify(obj)); }catch(e){}
    }

    // Ensure first seen exists
    let firstSeen = +localStorage.getItem(LS_FIRST) || 0;
    if(!firstSeen || isNaN(firstSeen)){
      firstSeen = Date.now();
      try{ localStorage.setItem(LS_FIRST, String(firstSeen)); }catch(e){}
    }

    // claimed array safe init
    let claimed = safeGetJSON(LS_CLAIMED, null);
    if(!Array.isArray(claimed) || claimed.length !== MAX_DAYS){
      claimed = new Array(MAX_DAYS).fill(false);
      safeSetJSON(LS_CLAIMED, claimed);
    }

    // compute availability
    function daysSinceFirst(){
      const now = Date.now();
      const diffDays = Math.floor((now - firstSeen) / (24*60*60*1000));
      return diffDays;
    }
    function availableCount(){
      return Math.min(MAX_DAYS, daysSinceFirst() + 1);
    }

    // ====== Expose/Connect to game API (safe wrappers) ======
    // Preserve original if any
    const _orig_claim = window.claimRewardFromModal instanceof Function ? window.claimRewardFromModal : null;
    const _orig_updCoins = window.updCoins instanceof Function ? window.updCoins : null;
    const _orig_saveGame = window.saveGameState instanceof Function ? window.saveGameState : null;
    const _orig_format = window.format instanceof Function ? window.format : null;

    // format fallback
    function formatFallback(n){
      if (typeof _orig_format === 'function') return _orig_format(n);
      if (n >= 1e9) return (n/1e9).toFixed(1).replace(/\.0$/,'') + 'B';
      if (n >= 1e6) return (n/1e6).toFixed(1).replace(/\.0$/,'') + 'M';
      if (n >= 1e3) return (n/1e3).toFixed(1).replace(/\.0$/,'') + 'K';
      return String(n);
    }

    // updater fallback: if game has updCoins, use it; else update coinsVal element and localStorage
    function updCoinsPublic(v=0){
      if (typeof _orig_updCoins === 'function'){
        try{ _orig_updCoins(v); return; }catch(e){}
      }
      try{
        let cur = +localStorage.getItem('coins') || 0;
        cur += v;
        if(cur < 0) cur = 0;
        localStorage.setItem('coins', String(cur));
        const el = document.getElementById('coinsVal');
        if(el) el.textContent = formatFallback(cur);
      }catch(e){}
    }

    // save fallback: call game's save() if exists, otherwise persist basic pieces
    function saveGameStatePublic(){
      if (typeof window.save === 'function'){
        try{ window.save(); return; }catch(e){} // original game save function
      }
      try{
        const coins = localStorage.getItem('coins') || '0';
        localStorage.setItem('coins', coins);
        safeSetJSON(LS_CLAIMED, claimed);
        localStorage.setItem(LS_FIRST, String(firstSeen));
      }catch(e){}
    }

    // claimRewardFromModal public: first try original if present (saved in _orig_claim), else fallback to updating coins
    function claimRewardFromModalPublic(amount){
      if (typeof _orig_claim === 'function'){
        try{ _orig_claim(amount); saveGameStatePublic(); return; }catch(e){ }
      }
      try{
        let cur = +localStorage.getItem('coins') || 0;
        cur += amount;
        localStorage.setItem('coins', String(cur));
        if (typeof window.updCoins === 'function' || typeof _orig_updCoins === 'function'){
          updCoinsPublic(0);
        } else {
          const cv = document.getElementById('coinsVal');
          if(cv) cv.textContent = formatFallback(cur);
        }
        saveGameStatePublic();
      }catch(e){}
    }

    // Expose to window (do not overwrite if user already has these functions; but ensure they exist)
    window.claimRewardFromModal = window.claimRewardFromModal || claimRewardFromModalPublic;
    window.updCoins = window.updCoins || updCoinsPublic;
    window.saveGameState = window.saveGameState || saveGameStatePublic;
    window.format = window.format || formatFallback;

    const updCoins = window.updCoins;
    const claimRewardFromModal = window.claimRewardFromModal;
    const saveGameState = window.saveGameState;
    const formatNum = window.format;

    // ====== Modal DOM & logic ======
    const overlay = document.getElementById('wsModalOverlay');
    const gridTop = document.getElementById('rewardsGridTop');
    const gridBottom = document.getElementById('rewardsGridBottom');
    const unlockedCountEl = document.getElementById('wsUnlockedCount');
    const coinsDisplayEl = document.getElementById('wsModalCoinsDisplay');
    const btnClose = document.getElementById('wsBtnClose');
    const btnRules = document.getElementById('wsBtnRules');

    // Hide main page children while modal is visible.
    const hiddenTargets = [];
    function hideMainUI(){
      const bodyChildren = Array.from(document.body.children);
      bodyChildren.forEach(ch=>{
        if (ch === overlay) return;
        const prev = ch.style.display || '';
        hiddenTargets.push({el: ch, prev});
        ch.style.display = 'none';
      });
      overlay.classList.remove('hidden');
    }
    function showMainUI(){
      hiddenTargets.forEach(item=>{
        try{ item.el.style.display = item.prev || ''; }catch(e){}
      });
      hiddenTargets.length = 0;
      overlay.classList.add('hidden');
    }

    // Build cards (1..7).
    function renderCards(){
      const avail = availableCount();
      gridTop.innerHTML = '';
      gridBottom.innerHTML = '';
      let unlockedCount = 0;

      for(let i=0;i<MAX_DAYS;i++){
        const day = i+1;
        const amount = amounts[i] || 0;
        const card = document.createElement('div');
        card.className = 'rewardCard';
        if (day === 7) card.classList.add('big');

        card.innerHTML = `
          <div class="coinIconSmall">üí∞</div>
          <div class="dayLabel">Day ${day}</div>
          <div class="amount">${formatNum(amount)}</div>
        `;

        const isUnlocked = i < avail;
        const isClaimed = !!claimed[i];

        if(isClaimed){
          card.classList.add('claimed');
          const badge = document.createElement('div');
          badge.className = 'claimBadge';
          badge.textContent = 'Claimed';
          card.appendChild(badge);
        } else if(isUnlocked){
          card.classList.add('unlocked');
          unlockedCount++;
        } else {
          card.classList.add('locked');
          const daysToUnlock = day - avail;
          const overlayEl = document.createElement('div');
          overlayEl.className = 'overlay';
          // —Ç–µ–∫—Å—Ç —É–±—Ä–∞–Ω ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –∑–∞—Ç–µ–º–Ω–µ–Ω–∏–µ –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏
          overlayEl.textContent = '';
          card.appendChild(overlayEl);
        }

        card.addEventListener('click', function(){
          if (!isUnlocked || isClaimed) return;
          card.classList.add('pop');
          setTimeout(()=>card.classList.remove('pop'),260);

          claimed[i] = true;
          safeSetJSON(LS_CLAIMED, claimed);

          try{ claimRewardFromModal(amounts[i]); }catch(e){ console.warn('reward error', e); }

          const badge = document.createElement('div');
          badge.className = 'claimBadge';
          badge.textContent = 'Claimed';
          card.appendChild(badge);
          card.classList.remove('unlocked');
          card.classList.add('claimed');
          card.style.pointerEvents = 'none';

          syncCoinsDisplay();

          renderUnlockedCount();
        });

        if(i < 4) gridTop.appendChild(card);
        else gridBottom.appendChild(card);
      }

      renderUnlockedCount();
    }

    function renderUnlockedCount(){
      const avail = availableCount();
      const unlockedNow = Math.min(avail, MAX_DAYS);
      unlockedCountEl.textContent = String(unlockedNow);
    }

    function syncCoinsDisplay(){
      const coins = +localStorage.getItem('coins') || 0;
      coinsDisplayEl.textContent = formatNum(coins);
      const mainEl = document.getElementById('coinsVal');
      if (mainEl) mainEl.textContent = formatNum(coins);
    }

    btnClose.addEventListener('click', function(){
      showMainUI();
      saveGameState();
    });

    btnRules.addEventListener('click', function(){
      alert('Rewards unlock one per day since first visit. Click an unlocked card to claim its coins.');
    });

    hideMainUI();
    renderCards();
    syncCoinsDisplay();

    setInterval(()=>{ renderCards(); }, 60*1000);

    window._wsModal = {
      open: function(){ hideMainUI(); renderCards(); syncCoinsDisplay(); },
      close: function(){ showMainUI(); saveGameState(); },
      getState: function(){ return { firstSeen, claimed: claimed.slice(), available: availableCount() }; },
      forceResetClaims: function(){ claimed = new Array(MAX_DAYS).fill(false); safeSetJSON(LS_CLAIMED,claimed); renderCards(); }
    };

    overlay.tabIndex = -1;
  })();
  </script>

</body>
</html>
