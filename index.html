<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–¢–µ—Å—Ç: TonKeeper ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞</title>
  <style>
    :root{
      --bg:#0f1113;
      --card:#121316;
      --accent:#00d8ff;
      --text:#e6eef3;
      --muted:#9aa7b0;
    }
    html,body{height:100%;margin:0;padding:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;background:var(--bg); color:var(--text);}
    .app {
      min-height:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-end;
      padding:24px;
      box-sizing:border-box;
    }

    .content {
      width:100%;
      max-width:1100px;
      margin:auto;
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      color:var(--muted);
      text-align:center;
    }
    .panel {
      background:linear-gradient(180deg,#0c0d0f,#0f1113);
      border:1px solid rgba(255,255,255,0.03);
      padding:28px;
      border-radius:14px;
      box-shadow:0 10px 40px rgba(0,0,0,0.7);
      width:100%;
      max-width:920px;
    }
    .h1 { font-size:20px; margin:0 0 8px; color:var(--text); }
    .p { color:var(--muted); margin:0 0 14px; font-size:14px; }

    /* Bottom menu */
    .bottom-menu {
      width:100%;
      max-width:1100px;
      display:flex;
      gap:8px;
      padding:12px;
      box-sizing:border-box;
      justify-content:space-between;
      align-items:center;
      margin:12px auto 0;
    }
    .bottom-menu .left { display:flex; gap:8px; align-items:center; }
    .bottom-menu button {
      background:transparent;
      border:1px solid rgba(255,255,255,0.04);
      color:var(--text);
      padding:10px 14px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      backdrop-filter: blur(4px);
    }
    .bottom-menu button:active{ transform:translateY(1px); }
    .wallet-btn { font-size:18px; padding:10px 12px; }

    /* Wallet modal (dark - not white) */
    #walletModal {
      display:none;
      position:fixed;
      inset:0;
      z-index:12000;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg, rgba(2,6,10,0.72), rgba(0,0,0,0.72));
      padding:20px;
    }
    #walletModal .card {
      width:100%;
      max-width:560px;
      border-radius:12px;
      padding:18px;
      box-shadow:0 20px 80px rgba(0,0,0,0.8);
      background:linear-gradient(180deg,#0f1113,#151516);
      color:var(--text);
      border:1px solid rgba(255,255,255,0.03);
      box-sizing:border-box;
    }
    #walletModal .card h3 { margin:0 0 6px; font-size:18px; color:var(--text); }
    #walletModal .card .desc { color:var(--muted); font-size:13px; margin:0 0 12px; }
    #walletModal .row { display:flex; gap:8px; align-items:center; margin-top:12px; flex-wrap:wrap; }
    #walletModal button { padding:10px 12px; border-radius:10px; border:none; cursor:pointer; font-weight:800; }
    .btnPrimary { background:linear-gradient(90deg,var(--accent),#00a8ff); color:#001; }
    .btnGhost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--text); }
    .addr { font-family:monospace; padding:10px; background:rgba(255,255,255,0.02); border-radius:8px; margin-top:10px; word-break:break-all; }
    .hint { margin-top:8px; color:var(--muted); font-size:13px; }

    #closeWalletModal { background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted); padding:6px 8px; border-radius:8px; }

    /* small responsive */
    @media (max-width:520px){
      .panel{ padding:18px; border-radius:12px; }
      .bottom-menu { padding:10px; gap:6px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="content">
      <div class="panel">
        <div class="h1">–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è TonKeeper (TonConnect)</div>
        <div class="p">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É <b>üëõ –ö–æ—à–µ–ª—ë–∫</b> –≤–Ω–∏–∑—É, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –±–µ–ª—ã–π —ç–∫—Ä–∞–Ω ‚Äî —ç—Ç–æ —Å—Ç–∞—Ä—ã–π –±–∞–≥; –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ —Ñ–æ–Ω —Ç—ë–º–Ω—ã–π. –ï—Å–ª–∏ SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω (–æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç), —É–≤–∏–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —ç—Ç–æ–º.</div>
      </div>
    </div>

    <!-- Bottom menu -->
    <div class="bottom-menu">
      <div class="left">
        <button id="homeBtn">üè† –ì–ª–∞–≤–Ω–∞—è</button>
        <button id="shopBtn">üõí –ú–∞–≥–∞–∑–∏–Ω</button>
      </div>

      <div class="right">
        <!-- –ö–æ—à–µ–ª—ë–∫ (–≤—Å—Ç–∞–≤–ª—è–µ–º, —Å—é–¥–∞ –±—É–¥–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è —Å–∫—Ä–∏–ø—Ç) -->
        <button id="walletBtn" class="wallet-btn">üëõ –ö–æ—à–µ–ª—ë–∫</button>
        <button id="settingsBtn">‚öôÔ∏è</button>
      </div>
    </div>
  </div>

  <!-- Wallet modal -->
  <div id="walletModal" role="dialog" aria-hidden="true">
    <div class="card" role="document" aria-label="Wallet connect">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <h3>–ü–æ–¥–∫–ª—é—á–∏—Ç—å TON-–∫–æ—à–µ–ª–µ–∫</h3>
          <div class="desc">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è TonKeeper –∏ –¥—Ä—É–≥–∏–µ –∫–æ—à–µ–ª—å–∫–∏ —á–µ—Ä–µ–∑ TonConnect.</div>
        </div>
        <div>
          <button id="closeWalletModal" class="btnGhost">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
      </div>

      <div id="walletContent">
        <p class="hint">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è¬ª. –ï—Å–ª–∏ SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –ø–æ—è–≤–∏—Ç—Å—è –ø–æ–¥—Å–∫–∞–∑–∫–∞.</p>

        <!-- Root –¥–ª—è UI (–µ—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç) -->
        <div id="walletConnectRoot" style="margin-top:8px;"></div>

        <div class="row">
          <button id="walletConnectBtn" class="btnPrimary">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
          <button id="walletDisconnectBtn" class="btnGhost" style="display:none;">–û—Ç–∫–ª—é—á–∏—Ç—å</button>
        </div>

        <div id="walletStatus" style="margin-top:12px;">
          <div id="walletAddrBox" style="display:none;">
            <div style="font-size:13px;color:var(--muted);">–ê–¥—Ä–µ—Å:</div>
            <div id="walletAddress" class="addr">‚Äî</div>
          </div>
          <div id="walletError" style="color:#ffb4b4;margin-top:10px;display:none;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- TonConnect SDK + UI via CDN (–µ—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –æ–Ω–∏ –Ω–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è - –ø–æ–∫–∞–∂–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ) -->
  <script src="https://unpkg.com/@tonconnect/sdk@0.10.0/dist/tonconnect.min.js"></script>
  <script src="https://unpkg.com/@tonconnect/ui@0.6.1/dist/tonconnect-ui.min.js"></script>

  <script>
    (function(){
      // DOM refs
      const walletBtn = document.getElementById('walletBtn');
      const walletModal = document.getElementById('walletModal');
      const closeWalletModal = document.getElementById('closeWalletModal');
      const walletConnectBtn = document.getElementById('walletConnectBtn');
      const walletDisconnectBtn = document.getElementById('walletDisconnectBtn');
      const walletAddressEl = document.getElementById('walletAddress');
      const walletAddrBox = document.getElementById('walletAddrBox');
      const walletError = document.getElementById('walletError');
      const walletConnectRoot = document.getElementById('walletConnectRoot');

      let connector = null;
      let tonConnectUI = null;

      function showModal(){
        walletModal.style.display = 'flex';
        walletModal.setAttribute('aria-hidden','false');
        walletError.style.display = 'none';
        initTon();
      }
      function hideModal(){
        walletModal.style.display = 'none';
        walletModal.setAttribute('aria-hidden','true');
      }

      walletBtn.addEventListener('click', showModal);
      closeWalletModal.addEventListener('click', hideModal);

      // Safe init TonConnect (non-blocking)
      function initTon(){
        try {
          // If TonConnect SDK is available at window.TonConnect (depends on the loaded bundle)
          const TonConnect = window.TonConnect || (window.TonConnectSDK && window.TonConnectSDK.TonConnect) || (window.tonconnect && window.tonconnect.TonConnect);
          if (TonConnect && !connector) {
            // manifestUrl improves UX ‚Äî see manifest file instructions below
            const manifestUrl = window.location.origin + '/tonconnect-manifest.json';
            connector = new TonConnect({ manifestUrl });
            // restore previous connection if posible
            try { connector.restoreConnection(); } catch(e){}
            // Listen for account changes
            connector.onStatusChange((payload) => {
              // payload may include account info
              if (payload?.account) {
                displayAddress(payload.account);
              } else if (connector?.account) {
                displayAddress(connector.account);
              } else {
                hideAddress();
              }
            });
            // if already connected:
            if (connector.connected && connector.account) {
              displayAddress(connector.account);
            }
          } else {
            // SDK not loaded
            walletError.textContent = 'SDK TonConnect –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω (–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ CDN). –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ TonKeeper –≤–æ–∑–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ CDN.';
            walletError.style.display = 'block';
          }
        } catch(e){
          console.warn('initTon error', e);
          walletError.textContent = '–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TonConnect (—Å–º. –∫–æ–Ω—Å–æ–ª—å).';
          walletError.style.display = 'block';
        }

        // Try to init TonConnect UI if available (optional)
        try {
          const TonConnectUI = window.TonConnectUI || window.TON_CONNECT_UI || (window.tonconnectui && window.tonconnectui.TonConnectUI);
          if (TonConnectUI && !tonConnectUI) {
            tonConnectUI = new TonConnectUI({
              manifestUrl: window.location.origin + '/tonconnect-manifest.json',
              buttonRootId: 'walletConnectRoot'
            });
            // TonConnectUI usually auto-renders buttons into the root
          }
        } catch(e){
          // not critical
          console.warn('initTon UI err', e);
        }
      }

      function displayAddress(account){
        walletAddrBox.style.display = 'block';
        walletDisconnectBtn.style.display = 'inline-block';
        walletAddressEl.textContent = account?.address || (typeof account === 'string' ? account : JSON.stringify(account));
      }
      function hideAddress(){
        walletAddrBox.style.display = 'none';
        walletDisconnectBtn.style.display = 'none';
        walletAddressEl.textContent = '‚Äî';
      }

      async function connectWallet(){
        walletError.style.display = 'none';
        try {
          // Prefer UI open when available
          if (tonConnectUI && typeof tonConnectUI.open === 'function') {
            tonConnectUI.open();
            return;
          }
          // Fallback: use connector.connect
          if (!connector){
            walletError.textContent = 'TonConnect SDK –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω.';
            walletError.style.display = 'block';
            return;
          }
          // Example: try to connect using universalLink hint for Tonkeeper
          const walletSource = { universalLink: 'https://tonkeeper.com' };
          const maybeLink = connector.connect(walletSource);
          if (typeof maybeLink === 'string') {
            // open in new tab/window to trigger mobile wallet / extension
            window.open(maybeLink, '_blank');
          } else if (maybeLink && typeof maybeLink.then === 'function') {
            // If returns promise, await it (some SDK builds do)
            await maybeLink;
          }
        } catch (e) {
          console.error('connectWallet err', e);
          walletError.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–Ω—Å–æ–ª—å.';
          walletError.style.display = 'block';
        }
      }

      async function disconnectWallet(){
        try {
          if (connector && typeof connector.disconnect === 'function') await connector.disconnect();
        } catch(e){ console.warn('disconnect err', e); }
        hideAddress();
      }

      walletConnectBtn.addEventListener('click', connectWallet);
      walletDisconnectBtn.addEventListener('click', disconnectWallet);

      // Init on open
      // Also attempt a delayed init in case CDN loads after page load
      setTimeout(() => { if (walletModal.style.display==='flex') initTon(); }, 700);
      // Try init once on page load for faster UX
      setTimeout(initTon, 500);
    })();
  </script>

  <!--
    === tonconnect-manifest.json (–ø—Ä–∏–º–µ—Ä) ===
    –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ—Ç JSON –∫–∞–∫ —Ñ–∞–π–ª "tonconnect-manifest.json" –≤ –∫–æ—Ä–Ω–µ —Å–∞–π—Ç–∞ (—Ä—è–¥–æ–º —Å index.html), –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∏–∑ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞.
    –≠—Ç–æ —É–ª—É—á—à–∏—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å TonConnect / TonKeeper (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ file://, –Ω–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ).
  -->
  <!--
  {
    "name": "My Cool TON App",
    "description": "Demo app for TonConnect integration",
    "icons": ["https://example.com/icon-192.png"],
    "start_url": "/",
    "display": "standalone",
    "theme_color": "#0f1113"
  }
  -->
</body>
</html>
