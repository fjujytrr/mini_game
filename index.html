<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hide & Seek — Welcome + Game</title>

  <!-- ====== Стили модального окна (светлая тема) ====== -->
  <style>
    /* ------- переменные темы (светлая, премиум) ------- */
    :root{
      --wm-bg:#f5f7fb;
      --wm-card:#ffffff;
      --wm-muted:#8b95a5;
      --wm-accent:#3b82f6;
      --wm-accent-2:#00D8FF;
      --wm-gold:#ffb84d;
      --wm-glass:rgba(255,255,255,0.7);
      --wm-radius:18px;
      --wm-shadow: 0 8px 30px rgba(20,30,60,0.08);
      --wm-shadow-strong: 0 14px 40px rgba(20,30,60,0.12);
    }

    /* Модальное окно — светлая тема */
    .welcomeModal{
      position:fixed;
      inset:0;
      display:flex;
      flex-direction:column;
      z-index:1200;
      align-items:center;
      justify-content:flex-start;
      background:linear-gradient(180deg,rgba(250,250,252,0.95),rgba(250,250,252,0.98));
      color:#222;
      pointer-events:auto;
    }
    .welcomeHeader{
      width:100%;
      height:34vh;
      min-height:200px;
      background-image:url('fon.png');
      background-size:cover;
      background-position:center;
      border-bottom-left-radius:28px;
      border-bottom-right-radius:28px;
      box-shadow:var(--wm-shadow-strong);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:22px;
      box-sizing:border-box;
    }
    .brand{
      margin-top:12px;
      background:linear-gradient(90deg, rgba(255,255,255,0.7), rgba(255,255,255,0.5));
      padding:10px 16px;
      border-radius:999px;
      display:flex;
      align-items:center;
      gap:12px;
      backdrop-filter:blur(6px);
    }
    .brand img{width:44px;height:44px;border-radius:10px;object-fit:cover;border:2px solid rgba(255,255,255,0.6)}
    .brand .title{font-weight:800;font-size:18px;color:#0b1b2c}

    .rewardsArea{
      width:100%;
      flex:1;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding:24px;
      box-sizing:border-box;
      pointer-events:auto;
    }
    .rewardsShell{
      width:95%;
      max-width:1100px;
      height:70vh;
      background:transparent;
      display:flex;
      flex-direction:column;
      justify-content:flex-end;
      align-items:center;
      gap:18px;
      box-sizing:border-box;
    }

    .rewardsCard{ width:100%; background:transparent; padding:18px; border-radius:16px; box-sizing:border-box; display:flex; flex-direction:column; align-items:center; gap:18px }

    .rewardsGridTop{ display:grid; grid-template-columns:repeat(4,1fr); gap:14px; width:100% }
    .rewardsGridBottom{ display:grid; grid-template-columns:1fr 1fr 1.2fr; gap:14px; width:100%; align-items:end }

    .dayBox{
      background:var(--wm-card);
      border-radius:14px;
      padding:16px;
      min-height:120px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
      box-shadow:var(--wm-shadow);
      border:1px solid rgba(12,20,40,0.04);
      transition:transform .18s,box-shadow .18s;
      position:relative;
      overflow:hidden;
      cursor:pointer;
    }
    .dayBox:hover{ transform:translateY(-6px); box-shadow:var(--wm-shadow-strong) }
    .dayBox .coinIcon{ width:44px; height:44px; object-fit:contain }
    .dayBox .dayLabel{ font-weight:700; color:var(--wm-muted); font-size:13px }
    .dayBox .amount{ font-weight:900; font-size:20px; color:var(--wm-accent-2) }

    .dayBox.unlocked{ border:2px solid rgba(0,216,255,0.18) }
    .dayBox.locked{ opacity:0.45; pointer-events:none }

    .dayBox.big{ min-height:150px; padding:20px }

    .lockOverlay{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,rgba(255,255,255,0.8),rgba(255,255,255,0.6)); backdrop-filter:blur(3px); font-weight:800; color:var(--wm-muted); font-size:14px }

    .modalFooter{ width:100%; display:flex; justify-content:center; padding:8px 0 26px }
    .btn-primary{
      background:linear-gradient(90deg,var(--wm-accent),var(--wm-accent-2));
      border:none;color:#fff;padding:14px 22px;border-radius:12px;font-weight:800;font-size:16px;cursor:pointer;
      box-shadow:0 10px 30px rgba(59,130,246,0.18)
    }
    .btn-primary:active{ transform:translateY(1px) }

    @media (max-width:820px){
      .rewardsGridTop{ grid-template-columns:repeat(2,1fr) }
      .rewardsGridBottom{ grid-template-columns:repeat(2,1fr) }
    }
    @media (max-width:480px){
      .welcomeHeader{ height:28vh }
      .dayBox{ min-height:100px; padding:12px }
      .dayBox.big{ min-height:120px }
    }
  </style>

  <!-- ====== Стили основной игры (взяты из вашего кода) ====== -->
  <style>
    :root{
      --accent-cyan: #00D8FF;
      --birch: #EDE4C8;
      --purple-frame: #7a4bff;
      --deep-purple: #5a2ecc;
      --glass: rgba(255,255,255,0.06);
    }
    /* Базовая страница */
    html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);background-size:200% 200%;animation:gradientBG 15s ease infinite;color:#fff;overflow:hidden}
    @keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    body{display:flex;flex-direction:column;align-items:center;min-height:100vh}
    /* Header */
    header{width:95%;margin:15px 0;display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,0.28);border-radius:12px;padding:10px;backdrop-filter:blur(5px)}
    .level-bar{display:flex;gap:6px;background:rgba(0,0,0,0.2);padding:6px 10px;border-radius:12px;flex:1;justify-content:space-between}
    .level{flex:1;text-align:center;padding:6px 0;font-size:14px;font-weight:700;color:#eee;border-radius:8px;background:rgba(255,255,255,0.06);transition:.25s;cursor:pointer}
    .level.active{background:var(--accent-cyan);color:#000;box-shadow:0 0 8px var(--accent-cyan)}
    .coin-panel{display:flex;align-items:center;gap:10px;background:rgba(0,0,0,0.28);padding:8px 12px;border-radius:16px;box-shadow:0 0 12px rgba(0,216,255,0.18)}
    .coin-logo{width:40px;height:40px;border-radius:50%;object-fit:cover;border:3px solid var(--purple-frame);box-shadow:0 6px 18px rgba(122,75,255,0.18);background:#fff}
    .coin-panel .val{font-weight:700;font-size:18px;color:var(--accent-cyan)}
    /* Дом: сетка комнат */
    .house{position:relative;width:95%;max-width:500px;margin:20px 0;display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(4,1fr);gap:12px}
    .room{background:rgba(255,255,255,0.06);border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:28px;color:#fff;cursor:pointer;transition:transform .3s,box-shadow .3s;position:relative;border:2px solid rgba(255,255,255,0.14)}
    .room:hover{transform:scale(1.05);box-shadow:0 0 18px rgba(0,216,255,0.14)}
    .room.selected{border-color:var(--accent-cyan);box-shadow:0 0 12px var(--accent-cyan)}
    .room.found{border-color:#FF0054;box-shadow:0 0 12px #FF0054;animation:foundAnim 1s ease}
    .room.safe{border-color:#39FF14;box-shadow:0 0 12px #39FF14;animation:safeAnim .8s ease}
    .room.highlight{box-shadow:0 0 22px 4px var(--accent-cyan);transition:box-shadow .3s}
    @keyframes foundAnim{0%{transform:scale(1)}50%{transform:rotate(10deg) scale(1.15)}100%{transform:scale(1)}}
    @keyframes safeAnim{0%{transform:scale(1)}50%{transform:rotate(-10deg) scale(0.95)}100%{transform:scale(1)}}
    /* Контролы */
    .controls{width:90%;display:flex;justify-content:space-between;margin-bottom:15px}
    button{flex:1;margin:0 5px;padding:14px;font-size:20px;border:none;border-radius:12px;cursor:pointer;color:#000;background:var(--accent-cyan);box-shadow:0 4px 12px rgba(0,216,255,0.25);transition:transform .2s,box-shadow .2s}
    button:active{transform:scale(.98);box-shadow:0 2px 6px rgba(0,216,255,0.18)}
    button.secondary{background:rgba(0,0,0,0.36);color:#fff;border:1px solid rgba(255,255,255,0.06);box-shadow:0 3px 8px rgba(0,216,255,0.12)}
    /* Нижнее меню */
    .bottom-menu{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:90%;max-width:480px;display:flex;justify-content:space-around;gap:8px;background:rgba(0,0,0,0.28);padding:6px 0;border-radius:16px;backdrop-filter:blur(5px);box-shadow:0 0 12px rgba(0,216,255,0.18)}
    .bottom-menu button{background:transparent;color:#fff;font-size:22px;transition:transform .2s}
    .bottom-menu button:hover{transform:scale(1.16);color:var(--accent-cyan)}
    /* Апгрейды */
    .upgrade-panel{display:flex;gap:12px;margin:10px 0;overflow-x:auto;padding:12px 10px;width:95%;justify-content:flex-start;align-items:stretch}
    .upgrade{flex:0 0 auto;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));padding:16px;border-radius:16px;text-align:left;min-width:220px;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.06);transition:transform .18s,box-shadow .18s}
    .upgrade:hover{transform:translateY(-6px)}
    .upgrade h3{margin:0 0 8px;font-size:16px;color:var(--accent-cyan)}
    .upgrade p{margin:0;font-size:14px;color:#eee}
    .upgrade .price{margin-top:10px;font-weight:800;color:var(--birch);font-size:16px}
    .upgrade .badge{display:inline-block;margin-top:8px;padding:6px 8px;border-radius:999px;background:rgba(0,0,0,0.18);font-weight:700;color:#fff;font-size:12px}
    /* Mining info */
    .mining-info{margin:10px 0;padding:10px 12px;background:rgba(255,255,255,0.04);border-radius:14px;width:95%;text-align:center;box-shadow:0 2px 6px rgba(0,216,255,0.06)}
    /* Видимая панель майнеров — убираем с главного экрана */
    .miners-panel{display:none;width:95%;max-width:900px;gap:12px;padding:10px;overflow-x:auto;align-items:flex-start;margin-bottom:12px;background:transparent;border-radius:12px}
    .miners-panel .miner-card{display:none}
    /* Модальный магазин майнеров (полноэкранный) */
    #miningShop{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:900;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);color:#fff;padding:28px;box-sizing:border-box;overflow-y:auto;border:none}
    #miningShop h2{color:#ecf8ff;text-align:center;margin-bottom:10px}
    #miningShop .miners-container{display:flex;flex-wrap:wrap;gap:18px;justify-content:center;padding:8px 6px}
    #miningShop .miner-card{background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));color:#fff;border-radius:14px;padding:12px;width:160px;display:flex;flex-direction:column;align-items:center;gap:8px;box-shadow:0 10px 30px rgba(0,0,0,0.28);cursor:pointer;transition:transform .18s,box-shadow .18s;border:1px solid rgba(255,255,255,0.06)}
    #miningShop .miner-card:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(0,0,0,0.35)}
    #miningShop .card-logo{width:56px;height:56px;border-radius:50%;object-fit:cover;border:3px solid var(--purple-frame);background:#fff;box-shadow:0 6px 18px rgba(122,75,255,0.12)}
    #miningShop .miner-card h3{margin:6px 0 2px;font-size:16px;color:#f0fbff}
    #miningShop .miner-card .income{color:var(--birch);font-weight:800}
    #miningShop .miner-card .bottom{width:100%;display:flex;justify-content:space-between;font-weight:800;font-size:14px;margin-top:6px}
    #miningShop .price-pill{background:rgba(0,0,0,0.14);padding:6px 8px;border-radius:10px;font-weight:800}
    /* Подтверждение покупки: центрированное */
    #buyConfirm{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;background:transparent;padding:0;box-sizing:border-box}
    #buyConfirm .confirm-box{max-width:520px;margin:0 auto;background:linear-gradient(120deg, rgba(90,46,204,0.95), rgba(122,75,255,0.95));border:2px solid var(--accent-cyan);border-radius:12px;padding:14px;text-align:center;box-shadow:0 8px 30px rgba(122,75,255,0.18)}
    #buyConfirm.show{display:block}
    #buyConfirm p{color:#fff;margin:8px 0}
    #buyConfirm button{margin:6px 6px;padding:8px 12px;font-weight:700;background:var(--accent-cyan);color:#000;border:none;border-radius:8px}
    /* Info & Profile: теперь полноэкранные, непрозрачный фон как главный экран */
    #infoWindow, #profileWindow{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:800;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);color:#fff;padding:28px;box-sizing:border-box;overflow-y:auto}
    #infoWindow .content, #profileWindow .content{max-width:1100px;margin:24px auto;border-radius:16px;padding:18px;background:rgba(0,0,0,0.22);color:#fff;box-shadow:0 10px 30px rgba(0,0,0,0.28);border:1px solid rgba(255,255,255,0.04)}
    #infoWindow h2, #profileWindow h2{color:#ecf8ff;margin-bottom:10px}
    #infoWindow ul{color:#eaf2ff;padding-left:20px}
    #infoWindow ul li::before{content:'• ';color:var(--accent-cyan);font-weight:600}
    #infoWindow button, #profileWindow button{width:100%;margin-top:12px;padding:12px;font-size:18px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700}
    /* Profile specific content */
    .settings-card{margin-top:12px;padding:12px;background:rgba(255,255,255,0.03);border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .settings-row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .select-lang{padding:8px 10px;border-radius:8px;border:none;font-weight:700}
    /* Адаптив */
    @media (max-width:520px){
      .coin-logo{width:34px;height:34px;border-width:2px}
      button{font-size:18px;padding:12px}
      #miningShop .miner-card{width:46%}
      .upgrade{min-width:160px}
    }
  </style>
</head>

<body>
  <!-- ========== МОДАЛ (всплывающее окно при входе) ========== -->
  <div id="welcomeModal" class="welcomeModal" role="dialog" aria-modal="true">
    <div class="welcomeHeader">
      <div class="brand">
        <img src="logo.png" alt="Logo" />
        <div class="title">Hide & Seek — Daily Rewards</div>
      </div>
    </div>

    <div class="rewardsArea">
      <div class="rewardsShell">
        <div class="rewardsCard" aria-live="polite">
          <!-- верхний ряд: Day 1 - 4 -->
          <div class="rewardsGridTop" id="topRow">
            <div class="dayBox" data-day="1">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 1</div>
              <div class="amount">30K</div>
            </div>
            <div class="dayBox" data-day="2">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 2</div>
              <div class="amount">100K</div>
            </div>
            <div class="dayBox" data-day="3">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 3</div>
              <div class="amount">500K</div>
            </div>
            <div class="dayBox" data-day="4">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 4</div>
              <div class="amount">1M</div>
            </div>
          </div>

          <!-- нижний ряд: Day 5 - 7 (Day 7 чуть больше) -->
          <div class="rewardsGridBottom" id="bottomRow">
            <div class="dayBox" data-day="5">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 5</div>
              <div class="amount">3M</div>
            </div>
            <div class="dayBox" data-day="6">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 6</div>
              <div class="amount">6M</div>
            </div>
            <div class="dayBox big" data-day="7">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 7</div>
              <div class="amount">10M</div>
            </div>
          </div>
        </div>

        <div class="modalFooter">
          <button id="closeWelcome" class="btn-primary">Come back tomorrow</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== ОСНОВНАЯ ИГРА (по умолчанию скрыта, появится после закрытия модала) ========== -->
  <div id="mainGame" style="display:none;">
    <!-- Вставлен ваш главный экран и скрипты (контент страницы) -->
    <header>
      <div class="level-bar">
        <div class="level" data-val="10000">10K</div>
        <div class="level" data-val="100000">100K</div>
        <div class="level" data-val="1000000">1M</div>
        <div class="level" data-val="5000000">5M</div>
      </div>
      <div class="coin-panel">
        <img class="coin-logo" src="logo.png" alt="Coin logo" />
        <div class="val" id="coinsVal">0</div>
      </div>
    </header>

    <div class="house"></div>

    <div class="controls">
      <button id="startBtn">🏠</button>
      <button class="secondary" id="resetBtn">🔍</button>
    </div>

    <div class="upgrade-panel" id="upgradePanel">
      <div class="upgrade" data-key="x2Prize" data-base-price="20000">
        <h3>x2 Prize / x2 Loss</h3>
        <p>Double rewards & penalties</p>
        <div class="price">20,000</div>
        <div class="badge">Boost</div>
      </div>
      <div class="upgrade" data-key="check1" data-base-price="20000">
        <h3>Check 1 Room Only</h3>
        <p>Hunter checks 1 room only (1 min)</p>
        <div class="price">20,000</div>
        <div class="timer" id="check1Timer"></div>
      </div>
    </div>

    <div class="mining-info">
      <strong id="miningLabel">Mining Income:</strong> <span id="miningIncomeVal">0</span>/hr
    </div>

    <div class="miners-panel" id="minersPanelVisible" aria-hidden="true"></div>

    <div id="miningShop" aria-hidden="true">
      <h2 id="shopTitle">Mining Shop</h2>
      <div class="miners-container"></div>
      <button id="closeMiningShop" style="margin-top:12px;width:100%;padding:12px;font-size:18px;border:none;border-radius:12px;background:rgba(0,0,0,0.22);color:#fff;cursor:pointer;">Close</button>
    </div>

    <div id="buyConfirm" aria-hidden="true">
      <div class="confirm-box">
        <p id="buyText"></p>
        <div style="display:flex;justify-content:center;">
          <button id="confirmBuy">Buy</button>
          <button id="cancelBuy">Cancel</button>
        </div>
      </div>
    </div>

    <div id="infoWindow" aria-hidden="true">
      <div class="content">
        <h2 id="infoTitle">How to Play</h2>
        <ul id="infoList">
          <li>Select a room and then click the 🔍 button to hunt.</li>
          <li>The hunter searches 2 random rooms (1 if "Check 1 Room" is active).</li>
          <li>If your room is found, you lose coins (shown in red).</li>
          <li>If you evade the hunt, you gain coins (shown in green).</li>
          <li>Buy upgrades or miners to improve your chances and income.</li>
          <li>Claim daily rewards and complete quests for bonus coins.</li>
        </ul>
        <button id="closeInfo">Close</button>
      </div>
    </div>

    <div id="profileWindow" aria-hidden="true">
      <div class="content">
        <h2 id="profileTitle">Profile</h2>

        <div style="margin-bottom:16px;padding:16px;background:rgba(0,0,0,0.06);border-radius:12px;">
          <h3 id="dailyTitle" style="margin-bottom:8px;font-size:18px;color:#ecf8ff">Daily Reward</h3>
          <p id="dailyText" style="margin-bottom:12px;color:#fff">Get 30,000 coins once a day!</p>
          <button id="claimDaily" style="width:100%;padding:12px;font-size:16px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Claim Daily</button>
          <p id="dailyStatus" style="margin-top:8px;color:var(--birch);font-weight:600;text-align:center;"></p>
        </div>

        <div style="margin-bottom:16px;padding:16px;background:rgba(0,0,0,0.06);border-radius:12px;">
          <h3 id="questTitle" style="margin-bottom:8px;font-size:18px;color:#ecf8ff">Quest</h3>
          <p id="questText" style="margin-bottom:12px;color:#fff">Subscribe to get bonus coins!</p>
          <button id="claimQuest" style="width:100%;padding:12px;font-size:16px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Claim Quest</button>
          <p id="questStatus" style="margin-top:8px;color:var(--birch);font-weight:600;text-align:center;"></p>
        </div>

        <div class="settings-card">
          <div class="settings-row">
            <div>
              <h3 id="settingsTitle">Settings</h3>
              <p id="settingsText">Change language and other preferences.</p>
            </div>
            <div>
              <select id="langSelect" class="select-lang">
                <option value="ru">Русский</option>
                <option value="en">English</option>
              </select>
            </div>
          </div>
        </div>

        <button id="closeProfile" style="width:100%;padding:14px;font-size:18px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Close</button>
      </div>
    </div>

    <div class="bottom-menu">
      <button id="infoBtn" class="secondary">ℹ</button>
      <button id="shopBtn" class="secondary">🛒</button>
      <button id="miningBtn" class="secondary">⛏</button>
      <button id="profileBtn" class="secondary">👤</button>
    </div>
  </div>

  <!-- ====== Скрипты: логика модала и логика игры (объединены) ====== -->
  <script>
    /* ==========================
       МОДАЛ: Разблокировка наград и управление показом
       ========================== */
    (function(){
      const modal = document.getElementById('welcomeModal');
      const closeBtn = document.getElementById('closeWelcome');
      const mainGame = document.getElementById('mainGame');
      const firstSeenKey = 'ws_first_seen_v1';

      // сохраняем первый запуск (если отсутствует)
      if (!localStorage.getItem(firstSeenKey)) localStorage.setItem(firstSeenKey, Date.now());
      const firstSeen = +localStorage.getItem(firstSeenKey);

      // считаем сколько полных дней прошло от первого запуска (0 значит первый день)
      const daysSince = Math.floor((Date.now() - firstSeen) / (24*60*60*1000));
      // unlockedDays: Day 1 доступен сразу -> daysSince + 1
      const unlockedDays = Math.min(7, daysSince + 1);

      // пометим карточки
      document.querySelectorAll('.dayBox').forEach(box => {
        const day = Number(box.dataset.day || 0);
        if (day <= unlockedDays) {
          box.classList.add('unlocked');
        } else {
          box.classList.add('locked');
          // добавляем оверлей замка
          const overlay = document.createElement('div'); overlay.className = 'lockOverlay';
          overlay.textContent = `Unlock in ${day - unlockedDays} day${(day - unlockedDays) > 1 ? 's' : ''}`;
          box.appendChild(overlay);
        }
      });

      // кликабельность unlocked: лёгкий эффект
      document.querySelectorAll('.dayBox.unlocked').forEach(b => {
        b.addEventListener('click', ()=>{ b.animate([{ transform: 'scale(1)' },{ transform: 'scale(1.05)' },{ transform: 'scale(1)' }], { duration: 280 }); });
      });

      // Закрываем модал и показываем основную игру
      closeBtn.addEventListener('click', ()=>{
        modal.style.display = 'none';
        mainGame.style.display = '';
        // если нужно — прокинуть фокус в игровую область
        window.scrollTo(0,0);
      });

      // Окно открывается при каждом запуске (не запоминаем закрытие)
    })();
  </script>

  <script>
    /* ==========================
       Логика основной игры (ваш код, слегка адаптирован)
       ========================== */

    // ========== Локализация ==========
    const i18n = {
      ru: {
        pickRoomFirst: 'Сначала выберите комнату!',
        notEnough: 'Недостаточно монет!',
        dailyAlready: 'Ежедневная награда уже получена!',
        questAlready: 'Квест уже выполнен!',
        miningIncome: 'Доход майнинга:',
        miningShop: 'Магазин майнинга',
        close: 'Закрыть',
        howToPlay: 'Как играть',
        infoList: [
          'Выберите комнату, затем нажмите кнопку 🔍 для охоты.',
          'Охотник ищет 2 случайные комнаты (1, если активен "Check 1 Room").',
          'Если вашу комнату нашли, вы теряете монеты (показываются красным).',
          'Если вы избежали охоты, вы получаете монеты (показываются зеленым).',
          'Покупайте апгрейды или майнеров, чтобы улучшить шансы и доход.',
          'Забирайте ежедневные награды и выполняйте квесты для бонусных монет.'
        ],
        profile: 'Профиль',
        dailyReward: 'Ежедневная награда',
        dailyText: 'Получите 30 000 монет раз в день!',
        claimDaily: 'Забрать',
        quest: 'Квест',
        claimQuest: 'Взять',
        settings: 'Настройки',
        settingsText: 'Смените язык и другие параметры.',
        buyFor: 'Купить {name} за {price}?',
        buy: 'Купить',
        cancel: 'Отмена',
        profitHr: 'Прибыль/ч:'
      },
      en: {
        pickRoomFirst: 'Pick a room first!',
        notEnough: 'Not enough coins!',
        dailyAlready: 'Daily reward already claimed!',
        questAlready: 'Quest already claimed!',
        miningIncome: 'Mining Income:',
        miningShop: 'Mining Shop',
        close: 'Close',
        howToPlay: 'How to Play',
        infoList: [
          'Select a room and then click the 🔍 button to hunt.',
          'The hunter searches 2 random rooms (1 if "Check 1 Room" is active).',
          'If your room is found, you lose coins (shown in red).',
          'If you evade the hunt, you gain coins (shown in green).',
          'Buy upgrades or miners to improve your chances and income.',
          'Claim daily rewards and complete quests for bonus coins.'
        ],
        profile: 'Profile',
        dailyReward: 'Daily Reward',
        dailyText: 'Get 30,000 coins once a day!',
        claimDaily: 'Claim Daily',
        quest: 'Quest',
        claimQuest: 'Claim Quest',
        settings: 'Settings',
        settingsText: 'Change language and other preferences.',
        buyFor: 'Buy {name} for {price}?',
        buy: 'Buy',
        cancel: 'Cancel',
        profitHr: 'Profit/hr:'
      }
    };

    let lang = localStorage.getItem('lang') || 'ru';
    function t(key, vars = {}) {
      const val = i18n[lang][key];
      if (typeof val === 'string') {
        return val.replace(/\{(\w+)\}/g, (_, k) => vars[k] || '');
      }
      return val;
    }
    function applyLang() {
      const miningLabelEl = document.getElementById('miningLabel');
      if (miningLabelEl) miningLabelEl.textContent = t('miningIncome');
      const shopTitleEl = document.getElementById('shopTitle');
      if (shopTitleEl) shopTitleEl.textContent = t('miningShop');
      const closeMiningShopEl = document.getElementById('closeMiningShop');
      if (closeMiningShopEl) closeMiningShopEl.textContent = t('close');
      const confirmBuyEl = document.getElementById('confirmBuy');
      if (confirmBuyEl) confirmBuyEl.textContent = t('buy');
      const cancelBuyEl = document.getElementById('cancelBuy');
      if (cancelBuyEl) cancelBuyEl.textContent = t('cancel');
      const infoTitleEl = document.getElementById('infoTitle');
      if (infoTitleEl) infoTitleEl.textContent = t('howToPlay');
      const profileTitleEl = document.getElementById('profileTitle');
      if (profileTitleEl) profileTitleEl.textContent = t('profile');
      const dailyTitleEl = document.getElementById('dailyTitle');
      if (dailyTitleEl) dailyTitleEl.textContent = t('dailyReward');
      const dailyTextEl = document.getElementById('dailyText');
      if (dailyTextEl) dailyTextEl.textContent = t('dailyText');
      const claimDailyEl = document.getElementById('claimDaily');
      if (claimDailyEl) claimDailyEl.textContent = t('claimDaily');
      const questTitleEl = document.getElementById('questTitle');
      if (questTitleEl) questTitleEl.textContent = t('quest');
      const claimQuestEl = document.getElementById('claimQuest');
      if (claimQuestEl) claimQuestEl.textContent = t('claimQuest');
      const settingsTitleEl = document.getElementById('settingsTitle');
      if (settingsTitleEl) settingsTitleEl.textContent = t('settings');
      const settingsTextEl = document.getElementById('settingsText');
      if (settingsTextEl) settingsTextEl.textContent = t('settingsText');
      const closeInfoEl = document.getElementById('closeInfo');
      if (closeInfoEl) closeInfoEl.textContent = t('close');
      const closeProfileEl = document.getElementById('closeProfile');
      if (closeProfileEl) closeProfileEl.textContent = t('close');

      const infoListEl = document.getElementById('infoList');
      if (infoListEl) {
        infoListEl.innerHTML = '';
        t('infoList').forEach(li => {
          const el = document.createElement('li');
          el.textContent = li;
          infoListEl.appendChild(el);
        });
      }
    }

    // ========== Инициализация UI и состояния ==========
    const roomsContainer = document.querySelector('.house');
    if (roomsContainer) {
      for (let i = 0; i < 8; i++) {
        const d = document.createElement('div');
        d.className = 'room';
        d.dataset.idx = i;
        d.textContent = '+';
        roomsContainer.appendChild(d);
      }
    }

    let selectedRoom = null;
    let coins = +localStorage.getItem('coins') || 0;
    let maxCoins = +localStorage.getItem('maxCoins') || coins;
    const coinsVal = document.getElementById('coinsVal');
    let upgrades = JSON.parse(localStorage.getItem('upgrades')) || { x2Prize: 0, check1: 0 };
    let check1Expire = +localStorage.getItem('check1Expire') || 0;
    let roundInProgress = false;

    const minersData = [
      { n: "Miner 1", i: 500, p: 7000 },
      { n: "Miner 2", i: 1788, p: 12000 },
      { n: "Miner 3", i: 2358, p: 15000 },
      { n: "Miner 4", i: 3000, p: 20000 },
      { n: "Miner 5", i: 4500, p: 25000 },
      { n: "Miner 6", i: 5200, p: 30000 },
      { n: "Miner 7", i: 6100, p: 35000 },
      { n: "Miner 8", i: 7200, p: 40000 },
      { n: "Miner 9", i: 8500, p: 45000 },
      { n: "Miner 10", i: 9500, p: 50000 }
    ];

    let minersState;
    try {
      const saved = JSON.parse(localStorage.getItem('minersState'));
      if (Array.isArray(saved)) {
        minersState = minersData.map((_, i) => {
          const s = saved[i];
          if (s && typeof s.count === 'number') return { count: s.count };
          return { count: 0 };
        });
      } else {
        minersState = minersData.map(_ => ({ count: 0 }));
      }
    } catch (e) {
      minersState = minersData.map(_ => ({ count: 0 }));
    }

    const miningIncomeValEl = document.getElementById('miningIncomeVal');
    const minersContainerEl = document.querySelector('.miners-container');
    const minersPanelVisible = document.getElementById('minersPanelVisible');
    const miningShop = document.getElementById('miningShop');
    const buyConfirm = document.getElementById('buyConfirm');
    const buyText = document.getElementById('buyText');
    let pendingMiner = null;

    function format(n) {
      return n >= 1e9 ? (n/1e9).toFixed(1).replace(/\.0$/,'') + 'B' :
             n >= 1e6 ? (n/1e6).toFixed(1).replace(/\.0$/,'') + 'M' :
             n >= 1e3 ? (n/1e3).toFixed(1).replace(/\.0$/,'') + 'K' : String(n);
    }

    function save() {
      try {
        localStorage.setItem('coins', coins);
        localStorage.setItem('maxCoins', maxCoins);
        localStorage.setItem('upgrades', JSON.stringify(upgrades));
        localStorage.setItem('check1Expire', check1Expire);
        localStorage.setItem('minersState', JSON.stringify(minersState));
        localStorage.setItem('lastTime', Date.now());
        localStorage.setItem('lang', lang);
      } catch (e) {
        console.warn('Save failed', e);
      }
    }

    function updCoins(v = 0) {
      coins += v;
      if (coins < 0) coins = 0;
      if (coins > maxCoins) maxCoins = coins;
      if (coinsVal) coinsVal.textContent = format(coins);
      updLv();
      updUpg();
      updIncome();
      save();
    }

    function getIncome() {
      return minersState.reduce((sum, m, i) => {
        const count = (m && typeof m.count === 'number') ? m.count : 0;
        return sum + (count > 0 ? Math.floor(minersData[i].i * Math.pow(1.5, count - 1)) : 0);
      }, 0);
    }
    function updIncome() { if (miningIncomeValEl) miningIncomeValEl.textContent = format(getIncome()); }

    function addOfflineCoins() {
      const last = +localStorage.getItem('lastTime') || Date.now();
      const now = Date.now();
      const diffMinutes = (now - last) / 60000;
      if (diffMinutes > 0) {
        const minutesToAward = Math.min(diffMinutes, 180);
        updCoins(Math.floor(getIncome()/60 * minutesToAward));
      }
      localStorage.setItem('lastTime', now);
    }
    addOfflineCoins();

    setInterval(()=>{ updCoins(Math.floor(getIncome()/3600)); }, 1000);

    function updLv() { document.querySelectorAll('.level').forEach(l => l.classList.toggle('active', maxCoins >= +l.dataset.val)); }

    function updUpg() {
      document.querySelectorAll('.upgrade').forEach(u => {
        let key = u.dataset.key; let base = +u.dataset.basePrice; let count = upgrades[key] || 0;
        let price = base * Math.pow(2,count);
        let priceEl = u.querySelector('.price'); if (priceEl) priceEl.textContent = format(price);
        const badge = u.querySelector('.badge'); if (badge) badge.textContent = count > 0 ? `Lvl ${count}` : 'New';
      });
    }

    document.querySelectorAll('.upgrade').forEach(u=>{
      u.onclick = ()=>{
        let key = u.dataset.key; let base = +u.dataset.basePrice; let count = upgrades[key]||0;
        let price = base * Math.pow(2,count);
        if (coins >= price) {
          upgrades[key] = count+1; updCoins(-price);
          if (key === 'check1') check1Expire = Date.now()+60000;
          save(); updUpg();
        } else alert(t('notEnough'));
      };
    });

    function updCheck() {
      const el = document.getElementById('check1Timer');
      if (el) {
        if (check1Expire > Date.now()) el.textContent = '⏳ ' + Math.floor((check1Expire - Date.now())/1000) + 's';
        else el.textContent = '';
      }
    }
    setInterval(updCheck, 1000);

    // выбор комнаты
    function setupRoomClicks(){
      document.querySelectorAll('.room').forEach(r => {
        r.onclick = () => {
          if (roundInProgress) return;
          document.querySelectorAll('.room').forEach(x=>x.classList.remove('selected'));
          r.classList.add('selected');
          selectedRoom = +r.dataset.idx;
        };
      });
    }

    // start button
    const startBtn = document.getElementById('startBtn');
    if (startBtn) startBtn.onclick = ()=>{
      if (selectedRoom == null) { alert(t('pickRoomFirst')); return; }
      document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe'));
    };

    // reset / hunt
    const resetBtn = document.getElementById('resetBtn');
    if (resetBtn) resetBtn.onclick = ()=>{
      if (selectedRoom == null) { alert(t('pickRoomFirst')); return; }
      roundInProgress = true;
      const numPicks = (check1Expire > Date.now()) ? 1 : 2;
      let picks = [...Array(8).keys()].sort(()=>0.5-Math.random()).slice(0,numPicks);
      document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe','highlight'));
      let delay = 0;
      picks.forEach(i=>{
        let room = document.querySelector(`.room[data-idx="${i}"]`);
        setTimeout(()=>{ if (room) room.classList.add('highlight'); }, delay);
        setTimeout(()=>{ if (room) room.classList.remove('highlight'); }, delay+600);
        delay += 700;
      });
      setTimeout(()=>{
        let prize = 1000, loss = -2000;
        if (upgrades.x2Prize > 0) { prize *= Math.pow(2, upgrades.x2Prize); loss *= Math.pow(2, upgrades.x2Prize); }
        if (picks.includes(selectedRoom)) {
          const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
          if (room) room.classList.add('found');
          updCoins(loss);
        } else {
          const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
          if (room) room.classList.add('safe');
          updCoins(prize);
        }
        selectedRoom = null;
        document.querySelectorAll('.room').forEach(r=>r.classList.remove('selected'));
        roundInProgress = false;
      }, delay+700);
    };

    // render miners cards (только в модальном окне) — с защитой на undefined
    function renderMiners(){
      if (!minersContainerEl) return;
      minersContainerEl.innerHTML = '';
      minersData.forEach((m,i)=>{
        const st = (minersState[i] && typeof minersState[i].count === 'number') ? minersState[i] : { count: 0 };
        const price = m.p * Math.pow(2, st.count);
        const income = st.count > 0 ? Math.floor(m.i * Math.pow(1.5, st.count - 1)) : 0;

        const card = document.createElement('div'); card.className = 'miner-card';
        card.innerHTML = `
          <img class="card-logo" src="logo.png" alt="logo" />
          <h3>${m.n}</h3>
          <div class="income">+${format(income)} / hr</div>
          <div class="bottom">
            <span class="lvl">Lvl ${st.count}</span>
            <span class="price-pill">${format(price)}</span>
          </div>
        `;
        card.onclick = ()=>{
          const currentSt = (minersState[i] && typeof minersState[i].count === 'number') ? minersState[i] : { count: 0 };
          const currentPrice = m.p * Math.pow(2, currentSt.count);
          if (coins >= currentPrice) {
            pendingMiner = i;
            buyText.textContent = t('buyFor', { name: m.n, price: format(currentPrice) });
            buyConfirm.classList.add('show'); buyConfirm.style.display = 'block'; buyConfirm.setAttribute('aria-hidden','false');
          } else { alert(t('notEnough')); }
        };
        minersContainerEl.appendChild(card);
      });
    }

    // открыть/закрыть miningShop
    const miningBtn = document.getElementById('miningBtn');
    const shopBtn = document.getElementById('shopBtn');
    if (miningBtn) miningBtn.onclick = () => { if (miningShop) { miningShop.style.display = 'block'; miningShop.setAttribute('aria-hidden','false'); renderMiners(); } };
    if (shopBtn) shopBtn.onclick = () => { if (miningShop) { miningShop.style.display = 'block'; miningShop.setAttribute('aria-hidden','false'); renderMiners(); } };
    const closeMiningShopBtn = document.getElementById('closeMiningShop');
    if (closeMiningShopBtn) closeMiningShopBtn.onclick = ()=>{ if (miningShop) { miningShop.style.display = 'none'; miningShop.setAttribute('aria-hidden','true'); } };

    // buy confirm actions
    const confirmBuyBtn = document.getElementById('confirmBuy');
    const cancelBuyBtn = document.getElementById('cancelBuy');
    if (confirmBuyBtn) confirmBuyBtn.onclick = ()=>{
      if (pendingMiner === null) return;
      const i = pendingMiner; const m = minersData[i]; const st = minersState[i] || { count: 0 };
      const price = m.p * Math.pow(2, st.count);
      if (coins >= price) {
        coins -= price; minersState[i] = { count: (st.count || 0) + 1 }; updCoins(0); save(); renderMiners();
      } else alert(t('notEnough'));
      pendingMiner = null;
      if (buyConfirm) { buyConfirm.classList.remove('show'); buyConfirm.style.display = 'none'; buyConfirm.setAttribute('aria-hidden','true'); }
    };
    if (cancelBuyBtn) cancelBuyBtn.onclick = ()=>{ pendingMiner = null; if (buyConfirm) { buyConfirm.classList.remove('show'); buyConfirm.style.display = 'none'; buyConfirm.setAttribute('aria-hidden','true'); } };

    // profile window
    const profileWindowEl = document.getElementById('profileWindow');
    const profileBtn = document.getElementById('profileBtn');
    const closeProfileBtn = document.getElementById('closeProfile');
    if (profileBtn) profileBtn.onclick = ()=>{ if (profileWindowEl) { profileWindowEl.style.display = 'block'; profileWindowEl.setAttribute('aria-hidden','false'); } };
    if (closeProfileBtn) closeProfileBtn.onclick = ()=>{ if (profileWindowEl) { profileWindowEl.style.display = 'none'; profileWindowEl.setAttribute('aria-hidden','true'); } };

    // daily & quest
    let questClaimed = localStorage.getItem('questClaimed') === 'true';
    let lastDaily = +localStorage.getItem('lastDaily') || 0;
    const questStatusEl = document.getElementById('questStatus');
    const dailyStatusEl = document.getElementById('dailyStatus');
    function updateQuestStatus(){ if (questStatusEl) questStatusEl.textContent = questClaimed ? "✅ Completed" : "❌ Not claimed"; }
    function updateDailyStatus(){ if (!dailyStatusEl) return; const now = Date.now(); const nextAvailable = lastDaily + 24*60*60*1000; if (now >= nextAvailable) dailyStatusEl.textContent = "💰 Available!"; else { const diff = nextAvailable - now; const hours = Math.floor(diff / (1000*60*60)); const minutes = Math.floor((diff % (1000*60*60)) / (1000*60)); dailyStatusEl.textContent = `Next in ${hours}h ${minutes}m`; } }
    setInterval(updateDailyStatus, 60000); updateDailyStatus(); updateQuestStatus();

    const claimQuestBtn = document.getElementById('claimQuest');
    const claimDailyBtn = document.getElementById('claimDaily');
    if (claimQuestBtn) claimQuestBtn.onclick = ()=>{ if (questClaimed) alert(t('questAlready')); else { updCoins(50000); questClaimed = true; localStorage.setItem('questClaimed','true'); updateQuestStatus(); } };
    if (claimDailyBtn) claimDailyBtn.onclick = ()=>{ const now = Date.now(); if (now - lastDaily < 24*60*60*1000) alert(t('dailyAlready')); else { updCoins(30000); lastDaily = now; localStorage.setItem('lastDaily', now); updateDailyStatus(); } };

    // info window
    const infoWindowEl = document.getElementById('infoWindow');
    const infoBtn = document.getElementById('infoBtn');
    const closeInfoBtn = document.getElementById('closeInfo');
    if (infoBtn) infoBtn.onclick = ()=>{ if (infoWindowEl) { infoWindowEl.style.display = 'block'; infoWindowEl.setAttribute('aria-hidden','false'); } };
    if (closeInfoBtn) closeInfoBtn.onclick = ()=>{ if (infoWindowEl) { infoWindowEl.style.display = 'none'; infoWindowEl.setAttribute('aria-hidden','true'); } };

    // shop toggle: теперь shopBtn и miningBtn открывают магазин; на главном — только upgradePanel видна
    const upgradePanel = document.getElementById('upgradePanel');
    if (minersPanelVisible) minersPanelVisible.style.display = 'none';
    if (upgradePanel) upgradePanel.style.display = 'flex';

    // language selector
    const langSelect = document.getElementById('langSelect');
    if (langSelect) {
      langSelect.value = lang;
      langSelect.onchange = ()=>{ lang = langSelect.value; localStorage.setItem('lang', lang); applyLang(); renderMiners(); };
    }

    // init UI
    if (coinsVal) coinsVal.textContent = format(coins);
    updLv(); updUpg(); updIncome(); updCheck(); renderMiners(); applyLang();
    setupRoomClicks();

    // ensure windows hidden on load
    const infoWindow = document.getElementById('infoWindow');
    if (infoWindow) { infoWindow.style.display = 'none'; infoWindow.setAttribute('aria-hidden','true'); }
    if (profileWindowEl) { profileWindowEl.style.display = 'none'; profileWindowEl.setAttribute('aria-hidden','true'); }
    if (buyConfirm) { buyConfirm.style.display = 'none'; buyConfirm.setAttribute('aria-hidden','true'); }

  </script>
</body>
</html>
