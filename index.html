<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hide & Seek ‚Äî Premium Emoji (Updated with TON Keeper)</title>

  <style>
:root{
  --wm-accentA:#1b1b1f;
  --wm-accentB:#2b2b2f;
  --wm-accentC:#00D8FF;
  --wm-birch:#EDE4C8;
  --accent-cyan:#00D8FF;
  --birch:#EDE4C8;
  --purple-frame:#7a4bff;
  --deep-purple:#5a2ecc;
  --glass-weak: rgba(255,255,255,0.01);
  --glass-strong: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
  --bg-dark: linear-gradient(120deg,#1f2023,#2a2c31);
  --text-light: #ecf2ff;
  --profit-green: #39FF14;
  --logo-border-light: #dcdcdc;
}

html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg-dark);color:var(--text-light);overflow:hidden}
body{display:flex;flex-direction:column;align-items:center;min-height:100vh}

/* header */
header{
  width:95%;
  margin:15px 0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  background: var(--glass-strong);
  border-radius:18px;
  padding:12px 18px;
  backdrop-filter: blur(8px) saturate(1.05);
  box-shadow: 0 14px 40px rgba(0,0,0,0.65);
  border:1px solid rgba(255,255,255,0.03);
}

/* Energy panel */
.energy-panel{ display:flex; align-items:center; gap:8px; padding:6px 10px; border-radius:10px; min-width:100px; max-width:160px; font-weight:800; color:var(--text-light); border:1px solid rgba(255,255,255,0.02); }
.energy-panel .icon{font-size:16px;margin-right:6px}
.energy-panel .val{font-size:14px;color:var(--wm-accentC);line-height:1}
.energy-panel .timer{font-size:11px;color:var(--birch);line-height:1}

/* Coin panel */
.coin-panel{ display:flex; align-items:center; gap:10px; padding:8px 12px; border-radius:12px; margin-left:auto; min-width:140px; max-width:320px; justify-content:flex-end; border:1px solid rgba(255,255,255,0.02); gap:10px; }
.coin-logo, .ton-logo{display:inline-flex;align-items:center;justify-content:center;border-radius:50%;overflow:hidden;flex:0 0 auto}
.coin-logo{width:40px;height:40px;border:2px solid var(--logo-border-light);box-shadow:0 8px 18px rgba(122,75,255,0.06);background:#fff}
.coin-logo img{width:100%;height:100%;object-fit:cover;display:block}
.coin-panel .val{font-weight:900;font-size:14px;color:var(--wm-accentC);line-height:1}
.ton-panel{display:flex;align-items:center;gap:6px;padding:4px 8px;border-radius:10px;background:transparent;margin-left:8px}
.ton-logo{width:34px;height:34px;border:2px solid var(--logo-border-light);background:#fff}
.ton-logo img{width:100%;height:100%;object-fit:cover;display:block}

/* Main area */
.house{ width:95%; height:48vh; margin:12px 0; display:flex; align-items:center; justify-content:center; color:rgba(255,255,255,0.08); font-size:48px; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); }

/* Controls */
.controls{ display:flex; gap:8px; margin:10px 0; }
.btnPrimary{ padding:12px 18px; border-radius:10px; border:none; font-weight:900; background:linear-gradient(90deg,var(--wm-accentC),#00A8FF); color:#000; cursor:pointer; box-shadow:0 12px 36px rgba(0,216,255,0.12) }
.btnGhost{ padding:10px 16px; border-radius:10px; border:1px solid rgba(255,255,255,0.06); background:transparent; color:var(--text-light); cursor:pointer }

/* bottom nav */
.bottom-nav{
  position:fixed; left:0; right:0; bottom:12px; display:flex; justify-content:center; z-index:9999;
}
.bottom-nav .nav-wrap{
  background:var(--glass-strong);
  padding:10px 14px;
  border-radius:40px;
  display:flex;
  gap:8px;
  align-items:center;
  box-shadow:0 18px 60px rgba(0,0,0,0.6);
  border:1px solid rgba(255,255,255,0.03);
}
.bottom-nav button{ background:transparent; border:none; padding:10px 12px; font-size:20px; border-radius:12px; cursor:pointer; color:var(--text-light) }
.bottom-nav button:hover{ transform:translateY(-4px); transition:all .18s ease }

/* wallet modal */
#walletModal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:11000; background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.6)); }
#walletModal .card{ width:95%; max-width:420px; padding:18px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)); border-radius:14px; box-shadow:0 14px 48px rgba(0,0,0,0.7); border:1px solid rgba(255,255,255,0.03); }
#walletModal h3{ margin:0 0 8px 0; color:#ecf8ff }
.wallet-row{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin:8px 0; }
.small-muted{ color:var(--birch); font-size:13px; }

/* responsive */
@media (max-width:520px){
  .coin-logo{width:32px;height:32px;border-width:2px}
  .btnPrimary{font-size:16px;padding:12px}
  .bottom-nav .nav-wrap{ padding:8px; gap:6px }
}
  </style>
</head>
<body>
  <header>
    <!-- Energy -->
    <div class="energy-panel" id="energyPanel" aria-live="polite" aria-atomic="true">
      <div class="icon">‚ö°</div>
      <div style="display:flex;flex-direction:column;align-items:flex-start;">
        <div style="font-size:11px;color:var(--birch);font-weight:800">Energy</div>
        <div style="display:flex;align-items:center;gap:8px;">
          <div class="val" id="energyVal">50</div>
          <div class="timer" id="energyTimer">‚Äî</div>
        </div>
      </div>
    </div>

    <!-- Coin panel -->
    <div class="coin-panel" aria-live="polite" aria-atomic="true">
      <div style="display:flex;align-items:center;gap:8px;">
        <div class="coin-logo" title="ZEX">
          <img src="logo.png" alt="ZEX logo" />
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;line-height:1;">
          <div style="font-size:11px;color:var(--birch);font-weight:800">ZEX</div>
          <div class="val" id="coinsVal">0</div>
        </div>
      </div>
       <div class="ton-panel" style="margin-left:6px;">
        <div class="ton-logo" title="TON">
          <img src="ton.png" alt="TON logo" />
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;line-height:1;">
          <div style="font-size:11px;color:var(--birch);font-weight:800">TON</div>
          <div class="ton-val" id="tonVal">0.00</div>
        </div>
      </div>
    </div>
  </header>

  <div class="house">GAME AREA</div>

  <div class="controls">
    <button id="startBtn" class="btnPrimary">üè† Start</button>
    <button id="resetBtn" class="btnGhost">üîç Hunt</button>
  </div>

  <!-- many UI blocks (shop, casino, profile etc.) -->
  <!-- (–Ø —Å–æ—Ö—Ä–∞–Ω–∏–ª –≤—Å–µ –≤–∞—à–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏ –∏ –ª–æ–≥–∏–∫—É –≤ —Å–∫—Ä–∏–ø—Ç–µ –Ω–∏–∂–µ) -->

  <!-- Wallet modal -->
  <div id="walletModal" aria-hidden="true">
    <div class="card" role="dialog" aria-modal="true" aria-labelledby="walletTitle">
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <h3 id="walletTitle">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫ TON</h3>
        <button id="closeWallet" class="btnGhost">‚úï</button>
      </div>
      <p class="small-muted">–ù–∞–∂–º–∏—Ç–µ <strong>Connect</strong> —á—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å Tonkeeper –∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –∫–æ—à–µ–ª–µ–∫ (TON Connect).</p>

      <div class="wallet-row">
        <div>
          <div class="small-muted">–°—Ç–∞—Ç—É—Å</div>
          <div id="walletStatus" style="font-weight:900">Not connected</div>
        </div>
        <div style="text-align:right;">
          <div class="small-muted">–ê–¥—Ä–µ—Å</div>
          <div id="walletAddr">‚Äî</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;justify-content:center;margin-top:12px;">
        <button id="connectWalletBtn" class="btnPrimary">Connect</button>
        <button id="disconnectWalletBtn" class="btnGhost" style="display:none">Disconnect</button>
      </div>

      <div style="margin-top:12px;font-size:13px;color:var(--birch)">
        –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª <code>/tonconnect-manifest.json</code> –≤ –∫–æ—Ä–µ–Ω—å —Å–∞–π—Ç–∞ ‚Äî –ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ.
        <details style="margin-top:6px;color:var(--birch)">
          <summary style="cursor:pointer">–ü—Ä–∏–º–µ—Ä –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ (click)</summary>
          <pre style="white-space:pre-wrap;margin-top:8px;background:rgba(255,255,255,0.02);padding:8px;border-radius:6px;">
{
  "name": "HideAndSeek DApp",
  "description": "Demo dapp to connect Tonkeeper",
  "icons": ["https://example.com/logo-192.png"],
  "website": "https://your-domain.example"
}
          </pre>
        </details>
      </div>
    </div>
  </div>

  <!-- bottom navigation -->
  <div class="bottom-nav" aria-hidden="false">
    <div class="nav-wrap">
      <button id="navHome" title="Home">üè†</button>
      <button id="miningBtn" title="Mining / Shop">‚õèÔ∏è</button>
      <button id="casinoBtn" title="Casino">üé∞</button>
      <button id="profileBtn" title="Profile">üë§</button>
      <!-- NEW wallet button -->
      <button id="walletBtn" title="Wallet">üëõ</button>
    </div>
  </div>

  <!-- ==========================
       TON Connect SDK (CDN)
       ==========================
       We load the official TonConnect SDK from UNPKG.
       This exposes global TonConnectSDK (TonConnect class).
  -->
  <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>

  <!-- ================
       MAIN GAME SCRIPT
       (–≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à –ø–æ–ª–Ω—ã–π JS-–∫–æ–¥ ‚Äî —è —Å–æ—Ö—Ä–∞–Ω–∏–ª –≤—Å–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
       –ù–∏–∂–µ ‚Äî —É–ø—Ä–æ—â—ë–Ω–Ω–æ: –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ä–∞–Ω–Ω–∏–π init + –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TonConnect.
       –ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –æ–≥—Ä–æ–º–Ω—ã–π —Å–∫—Ä–∏–ø—Ç (–∫–∞–∫ –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ), –ø—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫ –≤ –∫–æ–Ω–µ—Ü –≤–∞—à–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
       –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ CDN –¥–ª—è tonconnect –∑–∞–≥—Ä—É–∂–µ–Ω –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º.
       ================ -->
  <script>
  /* ===========================
     –í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π JS (–∏–≥—Ä–∞) –¥–æ–ª–∂–µ–Ω –∏–¥—Ç–∏ –∑–¥–µ—Å—å.
     –í —Ü–µ–ª—è—Ö –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —è —Å–æ—Ö—Ä–∞–Ω–∏–ª –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ñ—É–Ω–∫—Ü–∏–∏,
     –∞ –∑–∞—Ç–µ–º –¥–æ–±–∞–≤–∏–ª –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é TonConnect.
     (–í —Ä–µ–∞–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ –≤—Å—Ç–∞–≤—å—Ç–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –±–ª–æ–∫ JS –ø–æ–ª–Ω–æ—Å—Ç—å—é;
      –≤ —Ç–æ–º —á–∏—Å–ª–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–π: updCoins, renderMiners, casino, rewards –∏ —Ç.–¥.)
  ============================ */

  // --- –ø—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏–∑ –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞ (–æ–Ω–∏ —É–∂–µ –µ—Å—Ç—å –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–µ) ---
  const LS_COINS = 'coins';
  const LS_TON = 'player_ton_v1';
  const ZEX_TO_TON = 0.000001;

  // minimal UI bindings (–≤ –ø–æ–ª–Ω–æ–º —Ñ–∞–π–ª–µ —É –≤–∞—Å –∏—Ö —É–∂–µ –±–æ–ª—å—à–µ)
  const coinsVal = document.getElementById('coinsVal');
  const tonVal = document.getElementById('tonVal');

  function format(n){
    if (n >= 1e9) return (n/1e9).toFixed(1).replace(/\.0$/,'') + 'B';
    if (n >= 1e6) return (n/1e6).toFixed(1).replace(/\.0$/,'') + 'M';
    if (n >= 1e3) return (n/1e3).toFixed(1).replace(/\.0$/,'') + 'K';
    return String(n);
  }
  function formatTon(n){ return Number(n || 0).toFixed(2); }

  // Load saved values
  let coins = +localStorage.getItem(LS_COINS) || 0;
  let ton = +localStorage.getItem(LS_TON) || 0;
  function updateBalancesDisplay(){
    if (coinsVal) coinsVal.textContent = format(coins);
    if (tonVal) tonVal.textContent = formatTon(ton);
  }
  updateBalancesDisplay();

  // Example: wire existing bottom nav buttons to existing modals if present
  document.getElementById('miningBtn')?.addEventListener('click', ()=> {
    // –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å miningShop –º–æ–¥–∞–ª, –æ—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ:
    const ms = document.getElementById('miningShop');
    if (ms){ ms.style.display = 'block'; ms.setAttribute('aria-hidden','false'); }
  });
  document.getElementById('casinoBtn')?.addEventListener('click', ()=> {
    const casinoModal = document.getElementById('casinoModal');
    if (casinoModal){ casinoModal.style.display = 'flex'; casinoModal.setAttribute('aria-hidden','false'); }
  });
  document.getElementById('profileBtn')?.addEventListener('click', ()=> {
    const profileWindowEl = document.getElementById('profileWindow');
    if (profileWindowEl){ profileWindowEl.style.display = 'block'; profileWindowEl.setAttribute('aria-hidden','false'); }
  });

  // ============================
  // TON CONNECT (Tonkeeper) Integration
  // ============================
  (function initTonConnect(){
    // Elements
    const walletBtn = document.getElementById('walletBtn');
    const walletModal = document.getElementById('walletModal');
    const closeWallet = document.getElementById('closeWallet');
    const connectBtn = document.getElementById('connectWalletBtn');
    const disconnectBtn = document.getElementById('disconnectWalletBtn');
    const walletStatusEl = document.getElementById('walletStatus');
    const walletAddrEl = document.getElementById('walletAddr');

    // Defensive: ensure TonConnect SDK loaded
    if (typeof TonConnectSDK === 'undefined') {
      console.warn('TonConnect SDK not loaded. Wallet connect disabled.');
      // still show modal but with warning
      connectBtn.onclick = ()=> alert('TonConnect SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω (CDN). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ SDK.');
      return;
    }

    // Create connector
    // manifestUrl: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç—å URL –∫ –≤–∞—à–µ–º—É tonconnect-manifest.json (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    const connector = new TonConnectSDK.TonConnect({
      manifestUrl: window.location.origin + '/tonconnect-manifest.json'
    });

    // restore previous connection if any
    try { connector.restoreConnection(); } catch(e){ console.warn('restoreConnection failed', e); }

    // Helper to extract address from various possible payloads
    function extractAddressFromInfo(info){
      if (!info) return null;
      // common shapes: info.account.address  OR info.account?.address
      try {
        if (info.account && info.account.address) return info.account.address;
        if (info?.account?.address) return info.account.address;
        // some SDK versions expose wallet property
        if (info.wallet && info.wallet.account && info.wallet.account.address) return info.wallet.account.address;
      } catch(e){}
      return null;
    }

    function updateWalletUI(info){
      // try info first, then connector state
      let addr = extractAddressFromInfo(info);
      // fallback checks
      try {
        if(!addr && connector?.wallet && connector.wallet?.account && connector.wallet.account.address) addr = connector.wallet.account.address;
        if(!addr && connector?.account && connector.account.address) addr = connector.account.address;
      } catch(e){ /*ignore*/ }

      if (addr){
        walletStatusEl.textContent = 'Connected';
        walletAddrEl.textContent = addr;
        connectBtn.style.display = 'none';
        disconnectBtn.style.display = 'inline-block';
        // Optionally save connected address to localStorage for UI persistence
        localStorage.setItem('connected_ton_address', addr);
      } else {
        walletStatusEl.textContent = 'Not connected';
        walletAddrEl.textContent = '‚Äî';
        connectBtn.style.display = 'inline-block';
        disconnectBtn.style.display = 'none';
        localStorage.removeItem('connected_ton_address');
      }
    }

    // TON Connect status listener
    connector.onStatusChange((walletInfo) => {
      console.log('TonConnect status change', walletInfo);
      updateWalletUI(walletInfo);
    });

    // Connect button
    connectBtn.addEventListener('click', async () => {
      try {
        // connect() opens selection dialog (Tonkeeper, Tonkeeper extension, other wallets)
        await connector.connect();
        // after successful connect, onStatusChange will be triggered and update UI
      } catch (e) {
        console.error('Connector.connect error', e);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–æ—à–µ–ª—å–∫–∞: ' + (e?.message || e));
      }
    });

    // Disconnect button
    disconnectBtn.addEventListener('click', async () => {
      try {
        await connector.disconnect();
      } catch(e){
        console.warn('disconnect failed', e);
      } finally {
        updateWalletUI(null);
      }
    });

    // open modal
    walletBtn.addEventListener('click', ()=> {
      walletModal.style.display = 'flex';
      walletModal.setAttribute('aria-hidden','false');
      updateWalletUI(); // refresh
    });
    // close modal
    closeWallet.addEventListener('click', ()=> {
      walletModal.style.display = 'none';
      walletModal.setAttribute('aria-hidden','true');
    });

    // expose for debugging
    window._tonConnector = connector;
    // initial UI update
    updateWalletUI();
  })();

  // ============================
  // (–û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏–≥—Ä—ã ‚Äî –≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–∫—Ä–∏–ø—Ç)
  // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é, —á—Ç–æ –≤–µ—Å—å –≤–∞—à –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π JS (exploded) —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ;
  // –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –≤—Å—Ç–∞–≤—å—Ç–µ —Ç—É–¥–∞ –∏—Å—Ö–æ–¥–Ω—ã–π –±–ª–æ–∫ –ø–æ–ª–Ω–æ—Å—Ç—å—é (–æ–Ω –µ—Å—Ç—å –≤ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º –≤–∞–º–∏ —Ñ–∞–π–ª–µ).
  // ============================
  </script>
</body>
</html>
