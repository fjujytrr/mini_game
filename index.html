<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hide & Seek — Welcome + Game</title>

  <!-- ========== СТИЛИ ИГРЫ (оригинальные, без изменений) ========== -->
  <style>
:root{
  --accent-cyan: #00D8FF;
  --birch: #EDE4C8;
  --purple-frame: #7a4bff;
  --deep-purple: #5a2ecc;
  --glass: rgba(255,255,255,0.06);
}
/* Базовая страница */
html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);background-size:200% 200%;animation:gradientBG 15s ease infinite;color:#fff;overflow:hidden}
@keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
body{display:flex;flex-direction:column;align-items:center;min-height:100vh}
/* Header */
header{width:95%;margin:15px 0;display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,0.28);border-radius:12px;padding:10px;backdrop-filter:blur(5px)}
.level-bar{display:flex;gap:6px;background:rgba(0,0,0,0.2);padding:6px 10px;border-radius:12px;flex:1;justify-content:space-between}
.level{flex:1;text-align:center;padding:6px 0;font-size:14px;font-weight:700;color:#eee;border-radius:8px;background:rgba(255,255,255,0.06);transition:.25s;cursor:pointer}
.level.active{background:var(--accent-cyan);color:#000;box-shadow:0 0 8px var(--accent-cyan)}
.coin-panel{display:flex;align-items:center;gap:10px;background:rgba(0,0,0,0.28);padding:8px 12px;border-radius:16px;box-shadow:0 0 12px rgba(0,216,255,0.18)}
.coin-logo{width:40px;height:40px;border-radius:50%;object-fit:cover;border:3px solid var(--purple-frame);box-shadow:0 6px 18px rgba(122,75,255,0.18);background:#fff}
.coin-panel .val{font-weight:700;font-size:18px;color:var(--accent-cyan)}
/* Дом: сетка комнат */
.house{position:relative;width:95%;max-width:500px;margin:20px 0;display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(4,1fr);gap:12px}
.room{background:rgba(255,255,255,0.06);border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:28px;color:#fff;cursor:pointer;transition:transform .3s,box-shadow .3s;position:relative;border:2px solid rgba(255,255,255,0.14)}
.room:hover{transform:scale(1.05);box-shadow:0 0 18px rgba(0,216,255,0.14)}
.room.selected{border-color:var(--accent-cyan);box-shadow:0 0 12px var(--accent-cyan)}
.room.found{border-color:#FF0054;box-shadow:0 0 12px #FF0054;animation:foundAnim 1s ease}
.room.safe{border-color:#39FF14;box-shadow:0 0 12px #39FF14;animation:safeAnim .8s ease}
.room.highlight{box-shadow:0 0 22px 4px var(--accent-cyan);transition:box-shadow .3s}
@keyframes foundAnim{0%{transform:scale(1)}50%{transform:rotate(10deg) scale(1.15)}100%{transform:scale(1)}}
@keyframes safeAnim{0%{transform:scale(1)}50%{transform:rotate(-10deg) scale(0.95)}100%{transform:scale(1)}}
/* Контролы */
.controls{width:90%;display:flex;justify-content:space-between;margin-bottom:15px}
button{flex:1;margin:0 5px;padding:14px;font-size:20px;border:none;border-radius:12px;cursor:pointer;color:#000;background:var(--accent-cyan);box-shadow:0 4px 12px rgba(0,216,255,0.25);transition:transform .2s,box-shadow .2s}
button:active{transform:scale(.98);box-shadow:0 2px 6px rgba(0,216,255,0.18)}
button.secondary{background:rgba(0,0,0,0.36);color:#fff;border:1px solid rgba(255,255,255,0.06);box-shadow:0 3px 8px rgba(0,216,255,0.12)}
/* Нижнее меню */
.bottom-menu{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:90%;max-width:480px;display:flex;justify-content:space-around;gap:8px;background:rgba(0,0,0,0.28);padding:6px 0;border-radius:16px;backdrop-filter:blur(5px);box-shadow:0 0 12px rgba(0,216,255,0.18)}
.bottom-menu button{background:transparent;color:#fff;font-size:22px;transition:transform .2s}
.bottom-menu button:hover{transform:scale(1.16);color:var(--accent-cyan)}
/* Апгрейды */
.upgrade-panel{display:flex;gap:12px;margin:10px 0;overflow-x:auto;padding:12px 10px;width:95%;justify-content:flex-start;align-items:stretch}
.upgrade{flex:0 0 auto;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));padding:16px;border-radius:16px;text-align:left;min-width:220px;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.06);transition:transform .18s,box-shadow .18s}
.upgrade:hover{transform:translateY(-6px)}
.upgrade h3{margin:0 0 8px;font-size:16px;color:var(--accent-cyan)}
.upgrade p{margin:0;font-size:14px;color:#eee}
.upgrade .price{margin-top:10px;font-weight:800;color:var(--birch);font-size:16px}
.upgrade .badge{display:inline-block;margin-top:8px;padding:6px 8px;border-radius:999px;background:rgba(0,0,0,0.18);font-weight:700;color:#fff;font-size:12px}
/* Mining info */
.mining-info{margin:10px 0;padding:10px 12px;background:rgba(255,255,255,0.04);border-radius:14px;width:95%;text-align:center;box-shadow:0 2px 6px rgba(0,216,255,0.06)}
/* Видимая панель майнеров — убираем с главного экрана */
.miners-panel{display:none;width:95%;max-width:900px;gap:12px;padding:10px;overflow-x:auto;align-items:flex-start;margin-bottom:12px;background:transparent;border-radius:12px}
.miners-panel .miner-card{display:none}
/* Модальный магазин майнеров (полноэкранный) */
#miningShop{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:900;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);color:#fff;padding:28px;box-sizing:border-box;overflow-y:auto;border:none}
#miningShop h2{color:#ecf8ff;text-align:center;margin-bottom:10px}
#miningShop .miners-container{display:flex;flex-wrap:wrap;gap:18px;justify-content:center;padding:8px 6px}
#miningShop .miner-card{background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));color:#fff;border-radius:14px;padding:12px;width:160px;display:flex;flex-direction:column;align-items:center;gap:8px;box-shadow:0 10px 30px rgba(0,0,0,0.28);cursor:pointer;transition:transform .18s,box-shadow .18s;border:1px solid rgba(255,255,255,0.06)}
#miningShop .miner-card:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(0,0,0,0.35)}
#miningShop .card-logo{width:56px;height:56px;border-radius:50%;object-fit:cover;border:3px solid var(--purple-frame);background:#fff;box-shadow:0 6px 18px rgba(122,75,255,0.12)}
#miningShop .miner-card h3{margin:6px 0 2px;font-size:16px;color:#f0fbff}
#miningShop .miner-card .income{color:var(--birch);font-weight:800}
#miningShop .miner-card .bottom{width:100%;display:flex;justify-content:space-between;font-weight:800;font-size:14px;margin-top:6px}
#miningShop .price-pill{background:rgba(0,0,0,0.14);padding:6px 8px;border-radius:10px;font-weight:800}
/* Подтверждение покупки: центрированное */
#buyConfirm{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;background:transparent;padding:0;box-sizing:border-box}
#buyConfirm .confirm-box{max-width:520px;margin:0 auto;background:linear-gradient(120deg, rgba(90,46,204,0.95), rgba(122,75,255,0.95));border:2px solid var(--accent-cyan);border-radius:12px;padding:14px;text-align:center;box-shadow:0 8px 30px rgba(122,75,255,0.18)}
#buyConfirm.show{display:block}
#buyConfirm p{color:#fff;margin:8px 0}
#buyConfirm button{margin:6px 6px;padding:8px 12px;font-weight:700;background:var(--accent-cyan);color:#000;border:none;border-radius:8px}
/* Info & Profile: теперь полноэкранные, непрозрачный фон как главный экран */
#infoWindow, #profileWindow{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:800;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);color:#fff;padding:28px;box-sizing:border-box;overflow-y:auto}
#infoWindow .content, #profileWindow .content{max-width:1100px;margin:24px auto;border-radius:16px;padding:18px;background:rgba(0,0,0,0.22);color:#fff;box-shadow:0 10px 30px rgba(0,0,0,0.28);border:1px solid rgba(255,255,255,0.04)}
#infoWindow h2, #profileWindow h2{color:#ecf8ff;margin-bottom:10px}
#infoWindow ul{color:#eaf2ff;padding-left:20px}
#infoWindow ul li::before{content:'• ';color:var(--accent-cyan);font-weight:600}
#infoWindow button, #profileWindow button{width:100%;margin-top:12px;padding:12px;font-size:18px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700}
/* Profile specific content */
.settings-card{margin-top:12px;padding:12px;background:rgba(255,255,255,0.03);border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
.settings-row{display:flex;align-items:center;justify-content:space-between;gap:12px}
.select-lang{padding:8px 10px;border-radius:8px;border:none;font-weight:700}
/* Адаптив */
@media (max-width:520px){
  .coin-logo{width:34px;height:34px;border-width:2px}
  button{font-size:18px;padding:12px}
  #miningShop .miner-card{width:46%}
  .upgrade{min-width:160px}
}
  </style>

  <!-- ========== СТИЛИ МОДАЛА (фиолетовая тема, не влияет на глобальные html/body) ========== -->
  <style>
    :root{
      --wm-accentA: #5a2ecc;
      --wm-accentB: #7a4bff;
      --wm-accentC: #00D8FF;
      --wm-card:#0f0b1a;
      --wm-muted:#cfd8ff;
      --wm-radius:20px;
      --wm-shadow: 0 18px 60px rgba(26,10,60,0.45);
    }

    /* модал поверх игры */
    .welcomeModal{
      position:fixed; inset:0; z-index:2000;
      display:flex; flex-direction:column; align-items:center; justify-content:flex-start;
      background:linear-gradient(180deg, rgba(10,6,24,0.92), rgba(58,26,104,0.88));
      color:var(--wm-muted);
    }

    .welcomeHeader{
      width:100%; height:34vh; min-height:200px;
      background-image: linear-gradient(180deg,var(--wm-accentA), var(--wm-accentB)), url('fon.png');
      background-blend-mode:screen;
      background-size:cover; background-position:center;
      border-bottom-left-radius:28px; border-bottom-right-radius:28px;
      box-shadow:var(--wm-shadow);
      display:flex; align-items:flex-start; justify-content:center; padding:22px; box-sizing:border-box;
    }
    .brand{
      margin-top:12px; background:rgba(255,255,255,0.06); padding:10px 16px; border-radius:999px;
      display:flex; align-items:center; gap:12px; backdrop-filter: blur(6px);
    }
    .brand img{ width:44px; height:44px; border-radius:10px; object-fit:cover; border:2px solid rgba(255,255,255,0.12) }
    .brand .title{ font-weight:800; font-size:18px; color: #fff }

    .rewardsArea{ width:100%; flex:1; display:flex; align-items:flex-end; justify-content:center; padding:24px; box-sizing:border-box; }
    .rewardsShell{ width:95%; max-width:1100px; height:70vh; display:flex; flex-direction:column; justify-content:flex-end; gap:18px; box-sizing:border-box; }

    .rewardsCard{ width:100%; padding:18px; border-radius:14px; box-sizing:border-box; display:flex; flex-direction:column; gap:18px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); }

    .rewardsGridTop{ display:grid; grid-template-columns:repeat(4,1fr); gap:14px; width:100%; }
    .rewardsGridBottom{ display:grid; grid-template-columns:1fr 1fr 1.2fr; gap:14px; width:100%; align-items:end; }

    .dayBox{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:14px; padding:16px; min-height:120px; display:flex; flex-direction:column; align-items:center; gap:10px;
      box-shadow: 0 10px 30px rgba(10,6,24,0.6);
      border:1px solid rgba(255,255,255,0.04);
      position:relative; overflow:hidden; cursor:pointer; color:#fff;
    }
    .dayBox .coinIcon{ width:44px; height:44px; object-fit:contain; filter: drop-shadow(0 6px 18px rgba(122,75,255,0.18)); }
    .dayBox .dayLabel{ font-weight:700; color:rgba(255,255,255,0.75); font-size:13px }
    .dayBox .amount{ font-weight:900; font-size:20px; color:var(--wm-accentC) }

    .dayBox.locked{ opacity:0.45; pointer-events:none }
    .dayBox.unlocked{ border:2px solid rgba(122,75,255,0.18) }
    .dayBox.big{ min-height:150px; padding:20px }

    .lockOverlay{ position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg,rgba(10,6,24,0.6),rgba(10,6,24,0.5)); font-weight:800; color:rgba(255,255,255,0.7); font-size:14px }

    .claimBadge{ position:absolute; top:10px; right:10px; background:linear-gradient(90deg,#ffd28a,#ffb84d); color:#2a0a00; padding:6px 10px; border-radius:999px; font-weight:800; font-size:12px; box-shadow:0 6px 18px rgba(0,0,0,0.3) }

    .modalFooter{ width:100%; display:flex; justify-content:center; padding:8px 0 26px }
    .btn-primary{ background:linear-gradient(90deg,var(--wm-accentB),var(--wm-accentA)); border:none; color:#fff; padding:14px 22px; border-radius:12px; font-weight:800; font-size:16px; cursor:pointer; box-shadow:0 12px 36px rgba(122,75,255,0.22) }
    .btn-primary:active{ transform:translateY(1px) }

    @media (max-width:820px){
      .rewardsGridTop{ grid-template-columns:repeat(2,1fr) }
      .rewardsGridBottom{ grid-template-columns:repeat(2,1fr) }
    }
    @media (max-width:480px){
      .welcomeHeader{ height:28vh }
      .dayBox{ min-height:100px; padding:12px }
      .dayBox.big{ min-height:120px }
    }
  </style>
</head>
<body>

  <!-- ========== ОСНОВНАЯ ИГРА (в DOM, но скрыта до закрытия модала) ========== -->
  <div id="mainGame" style="display:none;">
    <header>
      <div class="level-bar">
        <div class="level" data-val="10000">10K</div>
        <div class="level" data-val="100000">100K</div>
        <div class="level" data-val="1000000">1M</div>
        <div class="level" data-val="5000000">5M</div>
      </div>
      <div class="coin-panel">
        <img class="coin-logo" src="logo.png" alt="Coin logo" />
        <div class="val" id="coinsVal">0</div>
      </div>
    </header>

    <div class="house"></div>

    <div class="controls">
      <button id="startBtn">🏠</button>
      <button class="secondary" id="resetBtn">🔍</button>
    </div>

    <div class="upgrade-panel" id="upgradePanel">
      <div class="upgrade" data-key="x2Prize" data-base-price="20000">
        <h3>x2 Prize / x2 Loss</h3>
        <p>Double rewards & penalties</p>
        <div class="price">20,000</div>
        <div class="badge">Boost</div>
      </div>
      <div class="upgrade" data-key="check1" data-base-price="20000">
        <h3>Check 1 Room Only</h3>
        <p>Hunter checks 1 room only (1 min)</p>
        <div class="price">20,000</div>
        <div class="timer" id="check1Timer"></div>
      </div>
    </div>

    <div class="mining-info">
      <strong id="miningLabel">Mining Income:</strong> <span id="miningIncomeVal">0</span>/hr
    </div>

    <div class="miners-panel" id="minersPanelVisible" aria-hidden="true"></div>

    <div id="miningShop" aria-hidden="true">
      <h2 id="shopTitle">Mining Shop</h2>
      <div class="miners-container"></div>
      <button id="closeMiningShop" style="margin-top:12px;width:100%;padding:12px;font-size:18px;border:none;border-radius:12px;background:rgba(0,0,0,0.22);color:#fff;cursor:pointer;">Close</button>
    </div>

    <div id="buyConfirm" aria-hidden="true">
      <div class="confirm-box">
        <p id="buyText"></p>
        <div style="display:flex;justify-content:center;">
          <button id="confirmBuy">Buy</button>
          <button id="cancelBuy">Cancel</button>
        </div>
      </div>
    </div>

    <div id="infoWindow" aria-hidden="true">
      <div class="content">
        <h2 id="infoTitle">How to Play</h2>
        <ul id="infoList">
          <li>Select a room and then click the 🔍 button to hunt.</li>
          <li>The hunter searches 2 random rooms (1 if "Check 1 Room" is active).</li>
          <li>If your room is found, you lose coins (shown in red).</li>
          <li>If you evade the hunt, you gain coins (shown in green).</li>
          <li>Buy upgrades or miners to improve your chances and income.</li>
          <li>Claim daily rewards and complete quests for bonus coins.</li>
        </ul>
        <button id="closeInfo">Close</button>
      </div>
    </div>

    <div id="profileWindow" aria-hidden="true">
      <div class="content">
        <h2 id="profileTitle">Profile</h2>

        <div style="margin-bottom:16px;padding:16px;background:rgba(0,0,0,0.06);border-radius:12px;">
          <h3 id="dailyTitle" style="margin-bottom:8px;font-size:18px;color:#ecf8ff">Daily Reward</h3>
          <p id="dailyText" style="margin-bottom:12px;color:#fff">Get 30,000 coins once a day!</p>
          <button id="claimDaily" style="width:100%;padding:12px;font-size:16px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Claim Daily</button>
          <p id="dailyStatus" style="margin-top:8px;color:var(--birch);font-weight:600;text-align:center;"></p>
        </div>

        <div style="margin-bottom:16px;padding:16px;background:rgba(0,0,0,0.06);border-radius:12px;">
          <h3 id="questTitle" style="margin-bottom:8px;font-size:18px;color:#ecf8ff">Quest</h3>
          <p id="questText" style="margin-bottom:12px;color:#fff">Subscribe to get bonus coins!</p>
          <button id="claimQuest" style="width:100%;padding:12px;font-size:16px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Claim Quest</button>
          <p id="questStatus" style="margin-top:8px;color:var(--birch);font-weight:600;text-align:center;"></p>
        </div>

        <div class="settings-card">
          <div class="settings-row">
            <div>
              <h3 id="settingsTitle">Settings</h3>
              <p id="settingsText">Change language and other preferences.</p>
            </div>
            <div>
              <select id="langSelect" class="select-lang">
                <option value="ru">Русский</option>
                <option value="en">English</option>
              </select>
            </div>
          </div>
        </div>

        <button id="closeProfile" style="width:100%;padding:14px;font-size:18px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Close</button>
      </div>
    </div>

    <div class="bottom-menu">
      <button id="infoBtn" class="secondary">ℹ</button>
      <button id="shopBtn" class="secondary">🛒</button>
      <button id="miningBtn" class="secondary">⛏</button>
      <button id="profileBtn" class="secondary">👤</button>
    </div>
  </div>

  <!-- ========== МОДАЛ ОКНО С НАГРАДАМИ (показывается поверх игры при каждом заходе) ========== -->
  <div id="welcomeModal" class="welcomeModal" role="dialog" aria-modal="true">
    <div class="welcomeHeader">
      <div class="brand">
        <img src="logo.png" alt="Logo" />
        <div class="title">Hide & Seek — Daily Rewards</div>
      </div>
    </div>

    <div class="rewardsArea">
      <div class="rewardsShell">
        <div class="rewardsCard" aria-live="polite">
          <!-- верхний ряд: Day 1 - 4 -->
          <div class="rewardsGridTop" id="topRow">
            <div class="dayBox" data-day="1">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 1</div>
              <div class="amount">30K</div>
            </div>
            <div class="dayBox" data-day="2">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 2</div>
              <div class="amount">100K</div>
            </div>
            <div class="dayBox" data-day="3">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 3</div>
              <div class="amount">500K</div>
            </div>
            <div class="dayBox" data-day="4">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 4</div>
              <div class="amount">1M</div>
            </div>
          </div>

          <!-- нижний ряд: Day 5 - 7 (Day 7 чуть больше) -->
          <div class="rewardsGridBottom" id="bottomRow">
            <div class="dayBox" data-day="5">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 5</div>
              <div class="amount">3M</div>
            </div>
            <div class="dayBox" data-day="6">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 6</div>
              <div class="amount">6M</div>
            </div>
            <div class="dayBox big" data-day="7">
              <img class="coinIcon" src="coin.png" alt="coin" />
              <div class="dayLabel">Day 7</div>
              <div class="amount">10M</div>
            </div>
          </div>
        </div>

        <div class="modalFooter">
          <button id="closeWelcome" class="btn-primary">Come back tomorrow</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== СКРИПТ: логика игры (выполняется ПЕРВОЙ, чтобы modal мог начислять монеты) ========== -->
  <script>
    /* ---- Глобальные функции и состояние игры (как в вашем оригинале), но экспортированы на window */
    (function(){
      // форматирование
      function format(n) {
        return n >= 1e9 ? (n/1e9).toFixed(1).replace(/\.0$/,'') + 'B' :
               n >= 1e6 ? (n/1e6).toFixed(1).replace(/\.0$/,'') + 'M' :
               n >= 1e3 ? (n/1e3).toFixed(1).replace(/\.0$/,'') + 'K' : String(n);
      }
      window.format = format;

      // состояние
      window.coins = +localStorage.getItem('coins') || 0;
      window.maxCoins = +localStorage.getItem('maxCoins') || window.coins;
      window.upgrades = JSON.parse(localStorage.getItem('upgrades')) || { x2Prize: 0, check1: 0 };
      window.check1Expire = +localStorage.getItem('check1Expire') || 0;

      // miners (same as before)
      window.minersData = [
        { n: "Miner 1", i: 500, p: 7000 },
        { n: "Miner 2", i: 1788, p: 12000 },
        { n: "Miner 3", i: 2358, p: 15000 },
        { n: "Miner 4", i: 3000, p: 20000 },
        { n: "Miner 5", i: 4500, p: 25000 },
        { n: "Miner 6", i: 5200, p: 30000 },
        { n: "Miner 7", i: 6100, p: 35000 },
        { n: "Miner 8", i: 7200, p: 40000 },
        { n: "Miner 9", i: 8500, p: 45000 },
        { n: "Miner 10", i: 9500, p: 50000 }
      ];

      try {
        const saved = JSON.parse(localStorage.getItem('minersState'));
        if (Array.isArray(saved)) {
          window.minersState = window.minersData.map((_, i) => {
            const s = saved[i];
            if (s && typeof s.count === 'number') return { count: s.count };
            return { count: 0 };
          });
        } else {
          window.minersState = window.minersData.map(_ => ({ count: 0 }));
        }
      } catch (e) {
        window.minersState = window.minersData.map(_ => ({ count: 0 }));
      }

      // функции для веб-UI
      window.saveGameState = function(){
        try {
          localStorage.setItem('coins', window.coins);
          localStorage.setItem('maxCoins', window.maxCoins);
          localStorage.setItem('upgrades', JSON.stringify(window.upgrades));
          localStorage.setItem('check1Expire', window.check1Expire);
          localStorage.setItem('minersState', JSON.stringify(window.minersState));
          localStorage.setItem('lastTime', Date.now());
        } catch(e){ console.warn('save failed', e); }
      };

      window.updCoins = function(v = 0){
        window.coins += v;
        if (window.coins < 0) window.coins = 0;
        if (window.coins > window.maxCoins) window.maxCoins = window.coins;
        const coinsVal = document.getElementById('coinsVal');
        if (coinsVal) coinsVal.textContent = format(window.coins);
        // update other UI if needed
        window.saveGameState();
      };

      // income calc
      window.getIncome = function(){
        return window.minersState.reduce((sum, m, i) => {
          const count = (m && typeof m.count === 'number') ? m.count : 0;
          return sum + (count > 0 ? Math.floor(window.minersData[i].i * Math.pow(1.5, count - 1)) : 0);
        }, 0);
      };

      // init some UI parts used by modal (rooms, etc.)
      (function initUI(){
        const roomsContainer = document.querySelector('.house');
        if (roomsContainer && roomsContainer.children.length === 0) {
          for (let i = 0; i < 8; i++) {
            const d = document.createElement('div');
            d.className = 'room';
            d.dataset.idx = i;
            d.textContent = '+';
            roomsContainer.appendChild(d);
          }
        }
        const coinsVal = document.getElementById('coinsVal');
        if (coinsVal) coinsVal.textContent = format(window.coins);
      })();

      // expose small helper for modal
      window.claimRewardFromModal = function(amount){
        // amount — integer, e.g. 30000
        window.updCoins(amount);
      };

      // ensure periodic income and offline handled (simple)
      (function offlineAndIncome(){
        const last = +localStorage.getItem('lastTime') || Date.now();
        const now = Date.now();
        const diffMinutes = (now - last) / 60000;
        if (diffMinutes > 0) {
          const minutesToAward = Math.min(diffMinutes, 180);
          const incomePerHour = window.getIncome();
          window.updCoins(Math.floor(incomePerHour/60 * minutesToAward));
        }
        localStorage.setItem('lastTime', now);
        setInterval(()=>{ window.updCoins(Math.floor(window.getIncome()/3600)); }, 1000);
      })();

      // expose done
    })();
  </script>

  <!-- ========== СКРИПТ: логика модала (использует window.claimRewardFromModal / window.updCoins) ========== -->
  <script>
    (function(){
      const modal = document.getElementById('welcomeModal');
      const closeBtn = document.getElementById('closeWelcome');
      const mainGame = document.getElementById('mainGame');

      // firstSeen logic (days since first install)
      const firstSeenKey = 'ws_first_seen_v2';
      if (!localStorage.getItem(firstSeenKey)) localStorage.setItem(firstSeenKey, Date.now());
      const firstSeen = +localStorage.getItem(firstSeenKey);
      const daysSince = Math.floor((Date.now() - firstSeen) / (24*60*60*1000));
      const unlockedDays = Math.min(7, daysSince + 1);

      // claimed days state (persisted)
      const claimedKey = 'ws_claimed_v2';
      let claimedDays = [];
      try {
        const saved = JSON.parse(localStorage.getItem(claimedKey));
        if (Array.isArray(saved) && saved.length === 7) claimedDays = saved;
        else claimedDays = [false,false,false,false,false,false,false];
      } catch (e) { claimedDays = [false,false,false,false,false,false,false]; }

      // mapping day->amount numeric
      const amounts = [30000,100000,500000,1000000,3000000,6000000,10000000];

      // set up boxes
      document.querySelectorAll('.dayBox').forEach(box=>{
        const day = Number(box.dataset.day || 0);
        box.classList.remove('unlocked','locked');
        // remove previous overlays/badges if any
        const existingOverlay = box.querySelector('.lockOverlay');
        if (existingOverlay) existingOverlay.remove();
        const existingBadge = box.querySelector('.claimBadge');
        if (existingBadge) existingBadge.remove();

        if (day <= unlockedDays) {
          box.classList.add('unlocked');
          // if already claimed — mark claimed
          if (claimedDays[day-1]) {
            const badge = document.createElement('div'); badge.className = 'claimBadge'; badge.textContent = 'Claimed';
            box.appendChild(badge);
            box.classList.add('claimed');
            box.style.pointerEvents = 'none';
          } else {
            // make clickable — adds claim button UI (small)
            box.addEventListener('click', onClaimClick);
            // optional: add small 'Tap to claim' badge
            const tip = document.createElement('div'); tip.style.position='absolute'; tip.style.left='12px'; tip.style.bottom='8px'; tip.style.fontSize='12px'; tip.style.opacity='0.9'; tip.style.color='rgba(255,255,255,0.85)'; tip.textContent = 'Tap to claim';
            box.appendChild(tip);
          }
        } else {
          box.classList.add('locked');
          const overlay = document.createElement('div'); overlay.className = 'lockOverlay';
          overlay.textContent = `Unlock in ${day - unlockedDays} day${(day - unlockedDays) > 1 ? 's' : ''}`;
          box.appendChild(overlay);
        }
      });

      function onClaimClick(e){
        const box = e.currentTarget;
        const day = Number(box.dataset.day || 0);
        if (!box || isNaN(day)) return;
        if (claimedDays[day-1]) {
          // already claimed (shouldn't happen because pointerEvents set) — ignore
          return;
        }
        // award amount
        const amount = amounts[day-1] || 0;
        // give user coins via game API if present, otherwise update localStorage fallback
        if (typeof window.claimRewardFromModal === 'function') {
          window.claimRewardFromModal(amount);
        } else {
          // fallback: increment localStorage coins
          try {
            const cur = +localStorage.getItem('coins') || 0;
            localStorage.setItem('coins', cur + amount);
          } catch(e){}
        }

        // mark claimed, persist
        claimedDays[day-1] = true;
        localStorage.setItem(claimedKey, JSON.stringify(claimedDays));

        // visual update: badge + disable further clicks
        const badge = document.createElement('div'); badge.className = 'claimBadge'; badge.textContent = 'Claimed';
        box.appendChild(badge);
        box.classList.add('claimed');
        box.style.pointerEvents = 'none';

        // small pop animation
        box.animate([{ transform: 'scale(1)' },{ transform: 'scale(1.06)' },{ transform: 'scale(1)' }], { duration: 260 });

        // update coins in main UI if exists
        const coinsVal = document.getElementById('coinsVal');
        if (coinsVal && typeof window.format === 'function') {
          // coins already updated through window.updCoins; just refresh display
          coinsVal.textContent = window.format(window.coins || (+localStorage.getItem('coins')||0));
        }
      }

      // Close button — hides modal and shows game
      closeBtn.addEventListener('click', ()=>{
        modal.style.display = 'none';
        mainGame.style.display = '';
        // focus
        window.scrollTo(0,0);
      });

      // modal shows every load (we do not set "don't show again")
      // ensure mainGame hidden until closed
      mainGame.style.display = 'none';
    })();
  </script>

  <!-- ========== ДОП. СКРИПТЫ: инициализация UI игры (кнопки, апгрейды и пр.) ========= -->
  <script>
    (function(){
      // Minimal initialization to keep original behavior intact.
      // (If у вас есть расширенная логика — просто подставьте её вместо этого блока.)
      // Some UI wiring to ensure game works as before.

      // Language / i18n placeholders (simple)
      const i18n = {
        ru: { pickRoomFirst: 'Сначала выберите комнату!', notEnough: 'Недостаточно монет!', dailyAlready: 'Ежедневная награда уже получена!', questAlready: 'Квест уже выполнен!', miningIncome: 'Доход майнинга:' },
        en: { pickRoomFirst: 'Pick a room first!', notEnough: 'Not enough coins!', dailyAlready: 'Daily reward already claimed!', questAlready: 'Quest already claimed!', miningIncome: 'Mining Income:' }
      };
      let lang = localStorage.getItem('lang') || 'ru';

      function t(k){ return (i18n[lang] && i18n[lang][k]) ? i18n[lang][k] : k; }

      // Setup basic UI interactions (upgrades, miners modal, rooms, etc.)
      // (I kept this condensed — full original logic can be pasted here unchanged if needed.)
      // Rooms selection
      let selectedRoom = null, roundInProgress = false;
      function setupRooms(){
        document.querySelectorAll('.room').forEach(r=>{
          r.onclick = ()=>{
            if (roundInProgress) return;
            document.querySelectorAll('.room').forEach(x=>x.classList.remove('selected'));
            r.classList.add('selected');
            selectedRoom = +r.dataset.idx;
          };
        });
      }
      setupRooms();

      // Start / reset buttons
      const startBtn = document.getElementById('startBtn');
      const resetBtn = document.getElementById('resetBtn');
      if (startBtn) startBtn.onclick = ()=>{ if (selectedRoom==null) alert(t('pickRoomFirst')); else document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe')); };
      if (resetBtn) resetBtn.onclick = ()=>{
        if (selectedRoom==null) { alert(t('pickRoomFirst')); return; }
        roundInProgress = true;
        const numPicks = (window.check1Expire > Date.now()) ? 1 : 2;
        let picks = [...Array(8).keys()].sort(()=>0.5-Math.random()).slice(0,numPicks);
        document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe','highlight'));
        let delay = 0;
        picks.forEach(i=>{
          let room = document.querySelector(`.room[data-idx="${i}"]`);
          setTimeout(()=>{ if (room) room.classList.add('highlight'); }, delay);
          setTimeout(()=>{ if (room) room.classList.remove('highlight'); }, delay+600);
          delay += 700;
        });
        setTimeout(()=>{
          let prize = 1000, loss = -2000;
          if (window.upgrades && window.upgrades.x2Prize > 0) { prize *= Math.pow(2, window.upgrades.x2Prize); loss *= Math.pow(2, window.upgrades.x2Prize); }
          if (picks.includes(selectedRoom)) {
            const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
            if (room) room.classList.add('found');
            if (typeof window.updCoins === 'function') window.updCoins(loss); else console.warn('updCoins not defined');
          } else {
            const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
            if (room) room.classList.add('safe');
            if (typeof window.updCoins === 'function') window.updCoins(prize); else console.warn('updCoins not defined');
          }
          selectedRoom = null;
          document.querySelectorAll('.room').forEach(r=>r.classList.remove('selected'));
          roundInProgress = false;
        }, delay+700);
      };

      // Mining shop toggles
      const miningBtn = document.getElementById('miningBtn');
      const shopBtn = document.getElementById('shopBtn');
      const miningShop = document.getElementById('miningShop');
      const minersContainerEl = document.querySelector('.miners-container');
      function renderMiners(){
        if (!minersContainerEl) return;
        minersContainerEl.innerHTML = '';
        (window.minersData || []).forEach((m,i)=>{
          const st = (window.minersState && window.minersState[i] && typeof window.minersState[i].count === 'number') ? window.minersState[i] : { count:0 };
          const price = m.p * Math.pow(2, st.count);
          const income = st.count > 0 ? Math.floor(m.i * Math.pow(1.5, st.count-1)) : 0;
          const card = document.createElement('div'); card.className = 'miner-card';
          card.innerHTML = `<img class="card-logo" src="logo.png" alt="logo" /><h3>${m.n}</h3><div class="income">+${window.format ? window.format(income) : income} / hr</div><div class="bottom"><span class="lvl">Lvl ${st.count}</span><span class="price-pill">${window.format ? window.format(price) : price}</span></div>`;
          card.onclick = ()=>{
            const currentSt = (window.minersState && window.minersState[i] && typeof window.minersState[i].count === 'number') ? window.minersState[i] : { count: 0 };
            const currentPrice = m.p * Math.pow(2, currentSt.count);
            if (window.coins >= currentPrice) {
              // simple buy
              window.coins -= currentPrice;
              window.minersState[i] = { count: (currentSt.count || 0) + 1 };
              window.updCoins(0);
              window.saveGameState();
              renderMiners();
            } else alert('Not enough coins!');
          };
          minersContainerEl.appendChild(card);
        });
      }
      if (miningBtn) miningBtn.onclick = ()=>{ if (miningShop) { miningShop.style.display = 'block'; renderMiners(); } };
      if (shopBtn) shopBtn.onclick = ()=>{ if (miningShop) { miningShop.style.display = 'block'; renderMiners(); } };
      const closeMiningShopBtn = document.getElementById('closeMiningShop');
      if (closeMiningShopBtn) closeMiningShopBtn.onclick = ()=>{ if (miningShop) miningShop.style.display = 'none'; };

      // Profile and Info
      const profileBtn = document.getElementById('profileBtn');
      const profileWindowEl = document.getElementById('profileWindow');
      const closeProfileBtn = document.getElementById('closeProfile');
      if (profileBtn) profileBtn.onclick = ()=>{ if (profileWindowEl) profileWindowEl.style.display = 'block'; };
      if (closeProfileBtn) closeProfileBtn.onclick = ()=>{ if (profileWindowEl) profileWindowEl.style.display = 'none'; };

      const infoBtn = document.getElementById('infoBtn');
      const infoWindowEl = document.getElementById('infoWindow');
      const closeInfoBtn = document.getElementById('closeInfo');
      if (infoBtn) infoBtn.onclick = ()=>{ if (infoWindowEl) infoWindowEl.style.display = 'block'; };
      if (closeInfoBtn) closeInfoBtn.onclick = ()=>{ if (infoWindowEl) infoWindowEl.style.display = 'none'; };

      // Claim daily/quest
      let questClaimed = localStorage.getItem('questClaimed') === 'true';
      let lastDaily = +localStorage.getItem('lastDaily') || 0;
      const questStatusEl = document.getElementById('questStatus');
      const dailyStatusEl = document.getElementById('dailyStatus');
      function updateQuestStatus(){ if (questStatusEl) questStatusEl.textContent = questClaimed ? "✅ Completed" : "❌ Not claimed"; }
      function updateDailyStatus(){ if (!dailyStatusEl) return; const now = Date.now(); const nextAvailable = lastDaily + 24*60*60*1000; if (now >= nextAvailable) dailyStatusEl.textContent = "💰 Available!"; else { const diff = nextAvailable - now; const hours = Math.floor(diff / (1000*60*60)); const minutes = Math.floor((diff % (1000*60*60)) / (1000*60)); dailyStatusEl.textContent = `Next in ${hours}h ${minutes}m`; } }
      setInterval(updateDailyStatus, 60000); updateDailyStatus(); updateQuestStatus();

      const claimQuestBtn = document.getElementById('claimQuest'), claimDailyBtn = document.getElementById('claimDaily');
      if (claimQuestBtn) claimQuestBtn.onclick = ()=>{ if (questClaimed) alert(t('questAlready')); else { window.updCoins(50000); questClaimed = true; localStorage.setItem('questClaimed','true'); updateQuestStatus(); } };
      if (claimDailyBtn) claimDailyBtn.onclick = ()=>{ const now = Date.now(); if (now - lastDaily < 24*60*60*1000) alert(t('dailyAlready')); else { window.updCoins(30000); lastDaily = now; localStorage.setItem('lastDaily', now); updateDailyStatus(); } };

      // final adjust: refresh coins display
      const coinsVal = document.getElementById('coinsVal');
      if (coinsVal) coinsVal.textContent = window.format ? window.format(window.coins) : window.coins;
    })();
  </script>
</body>
</html>
