<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hide & Seek — Premium Emoji (Updated)</title>
  <style>
:root{
  --wm-accentA:#1b1b1f;
  --wm-accentB:#2b2b2f;
  --wm-accentC:#00D8FF;
  --wm-birch:#EDE4C8;
  --accent-cyan:#00D8FF;
  --birch:#EDE4C8;
  --purple-frame:#7a4bff;
  --deep-purple:#5a2ecc;
  --glass-weak: rgba(255,255,255,0.01);
  --glass-strong: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
  --bg-dark: linear-gradient(120deg,#1f2023,#2a2c31);
  --text-light: #ecf2ff;
  --profit-green: #39FF14;
  --logo-border-light: #dcdcdc;
}

/* Base page */
html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg-dark);color:var(--text-light);overflow:hidden}
body{display:flex;flex-direction:column;align-items:center;min-height:100vh}

/* ====== Apply rewards-modal "glass" aesthetic to main UI ====== */
header{
  width:95%;
  margin:15px 0;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  background: var(--glass-strong);
  border-radius:18px;
  padding:12px 18px;
  backdrop-filter: blur(8px) saturate(1.05);
  box-shadow: 0 14px 40px rgba(0,0,0,0.65);
  border:1px solid rgba(255,255,255,0.03);
}

/* Energy panel (уменьшена) */
.energy-panel{
  display:flex;
  align-items:center;
  gap:8px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  padding:6px 10px;
  border-radius:10px;
  box-shadow:0 10px 30px rgba(0,0,0,0.6);
  min-width:100px;
  max-width:160px;
  font-weight:800;
  color:var(--text-light);
  border:1px solid rgba(255,255,255,0.02);
}
.energy-panel .icon{font-size:16px;margin-right:6px}
.energy-panel .val{font-size:14px;color:var(--wm-accentC);line-height:1}
.energy-panel .timer{font-size:11px;color:var(--birch);line-height:1}

/* Coin panel */
.coin-panel{
  display:flex;
  align-items:center;
  gap:10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  padding:8px 12px;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,0.6);
  margin-left:auto;
  min-width:140px;
  max-width:320px;
  justify-content:flex-end;
  border:1px solid rgba(255,255,255,0.02);
  gap:10px;
}
.coin-logo, .ton-logo{display:inline-flex;align-items:center;justify-content:center;border-radius:50%;overflow:hidden;flex:0 0 auto}
.coin-logo{width:40px;height:40px;border:2px solid var(--logo-border-light);box-shadow:0 8px 18px rgba(122,75,255,0.06);background:#fff}
.coin-logo img{width:100%;height:100%;object-fit:cover;display:block}
.coin-panel .val{font-weight:900;font-size:14px;color:var(--wm-accentC);line-height:1}
.ton-panel{display:flex;align-items:center;gap:6px;padding:4px 8px;border-radius:10px;background:transparent;margin-left:8px}
.ton-logo{width:34px;height:34px;border:2px solid var(--logo-border-light);box-shadow:0 8px 14px rgba(255,193,7,0.06);background:#fff}
.ton-logo img{width:100%;height:100%;object-fit:cover;display:block}
.ton-val{font-weight:800;font-size:13px;color:#ffeaa7;line-height:1}

/* House / rooms */
.house{position:relative;width:95%;max-width:560px;margin:20px 0;display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(4,1fr);gap:14px}
.room{
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border-radius:14px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  font-size:28px;
  color:var(--text-light);
  cursor:pointer;
  transition:transform .28s,box-shadow .28s;
  position:relative;
  border:1px solid rgba(255,255,255,0.02);
  box-shadow: 0 10px 30px rgba(0,0,0,0.6);
}
.room:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.7)}
.room.selected{border-color:var(--wm-accentC);box-shadow:0 0 18px var(--wm-accentC)}
.room.found{border-color:#FF0054;box-shadow:0 0 12px #FF0054;animation:foundAnim 1s ease}
.room.safe{border-color:var(--profit-green);box-shadow:0 0 12px var(--profit-green);animation:safeAnim .8s ease}
.room.highlight{box-shadow:0 0 40px 12px rgba(0,216,255,0.18);transition:box-shadow .2s, transform .18s}
@keyframes foundAnim{0%{transform:scale(1)}50%{transform:rotate(10deg) scale(1.15)}100%{transform:scale(1)}}
@keyframes safeAnim{0%{transform:scale(1)}50%{transform:rotate(-10deg) scale(0.95)}100%{transform:scale(1)}}

/* Controls */
.controls{width:90%;display:flex;justify-content:space-between;margin-bottom:18px}
.btnPrimary{
  flex:1;margin:0 6px;padding:14px;font-size:18px;border-radius:12px;border:none;cursor:pointer;background:linear-gradient(90deg,var(--wm-accentC),#00A8FF);color:#000;font-weight:900;box-shadow:0 12px 36px rgba(0,216,255,0.12);transition:transform .16s;
}
.btnPrimary:active{transform:scale(.98)}
.btnGhost{
  flex:1;margin:0 6px;padding:12px 14px;font-size:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text-light);font-weight:800;cursor:pointer;
}

/* Bottom menu */
.bottom-menu{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:90%;max-width:560px;display:flex;justify-content:space-around;gap:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));padding:12px;border-radius:16px;backdrop-filter:blur(8px);box-shadow:0 18px 50px rgba(0,0,0,0.65);border:1px solid rgba(255,255,255,0.02)}
.bottom-menu button{background:transparent;color:var(--text-light);font-size:20px;transition:transform .18s}
.bottom-menu button:hover{transform:scale(1.12);color:var(--wm-accentC)}

/* Upgrades panel */
.upgrade-panel{display:flex;gap:12px;margin:10px 0;overflow-x:auto;padding:14px 12px;width:95%;justify-content:flex-start;align-items:stretch}
.upgrade{flex:0 0 auto;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));padding:16px;border-radius:16px;text-align:left;min-width:220px;cursor:pointer;box-shadow:0 14px 40px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.02);transition:transform .18s}
.upgrade:hover{transform:translateY(-8px)}
.upgrade h3{margin:0 0 8px;font-size:16px;color:var(--wm-accentC)}
.upgrade p{margin:0;font-size:14px;color:#eaf5ff}
.upgrade .price{margin-top:10px;font-weight:900;color:var(--birch);font-size:16px}
.upgrade .badge{display:inline-block;margin-top:8px;padding:6px 8px;border-radius:999px;background:rgba(0,0,0,0.12);font-weight:700;color:#fff;font-size:12px}

/* Mining info */
.mining-info{margin:10px 0;padding:12px 14px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:14px;width:95%;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.02)}

/* Mining shop modal */
#miningShop{
  display:none;
  position:fixed;
  inset:0;
  z-index:900;
  color:var(--text-light);
  padding:28px;
  box-sizing:border-box;
  overflow-y:auto;
}
#miningShop::before{
  content: '';
  position: fixed;
  inset: 0;
  z-index: -1;
  background-image: url('fon.png');
  background-size: cover;
  background-position: center center;
  background-repeat: no-repeat;
  background-color: rgba(6,10,14,0.56);
  background-blend-mode: overlay;
  filter: blur(8px) saturate(1.02);
  -webkit-filter: blur(8px) saturate(1.02);
}
#miningShop .close-top { position:absolute; top:18px; right:18px; border:none; background:transparent; color:var(--text-light); font-size:20px; cursor:pointer; padding:8px 10px; border-radius:8px; }
#miningShop h2{color:#ecf8ff;text-align:center;margin-bottom:10px}
#miningShop .miners-container{ display:flex; flex-wrap:wrap; gap:18px; justify-content:center; padding:18px 12px; margin:0; background: transparent !important; border: none !important; border-radius: 0 !important; box-shadow: none !important; max-height: calc(100vh - 200px); overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 40px; }
#miningShop .miner-card{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));color:#fff;border-radius:14px;padding:12px;width:160px;display:flex;flex-direction:column;align-items:center;gap:8px;box-shadow:0 18px 40px rgba(0,0,0,0.7);cursor:pointer;transition:transform .18s,box-shadow .18s;border:1px solid rgba(255,255,255,0.02)}
#miningShop .miner-card:hover{transform:translateY(-8px);box-shadow:0 26px 60px rgba(0,0,0,0.75)}
#miningShop .card-logo{width:56px;height:56px;border-radius:50%;object-fit:cover;border:3px solid #fff;background:#fff;box-shadow:0 8px 24px rgba(122,75,255,0.06)}
#miningShop .miner-card h3{margin:6px 0 2px;font-size:16px;color:#f0fbff}
#miningShop .miner-card .income{color:var(--birch);font-weight:900}
#miningShop .miner-card .bottom{width:100%;display:flex;justify-content:space-between;font-weight:900;font-size:14px;margin-top:6px}
#miningShop .price-pill{background:rgba(0,0,0,0.12);padding:6px 8px;border-radius:10px;font-weight:900}

/* Buy confirm */
#buyConfirm{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;background:transparent;padding:0;box-sizing:border-box}
#buyConfirm .confirm-box{max-width:520px;margin:0;background:linear-gradient(120deg, rgba(40,40,40,0.98), rgba(60,60,60,0.98));border:2px solid var(--wm-accentC);border-radius:12px;padding:14px;text-align:center;box-shadow:0 18px 50px rgba(0,0,0,0.7)}
#buyConfirm.show{display:block}
#buyConfirm p{color:#fff;margin:8px 0}
#buyConfirm button{margin:6px 6px;padding:8px 12px;font-weight:700;background:linear-gradient(90deg,var(--wm-accentC),#00A8FF);color:#000;border:none;border-radius:8px}

/* Info & Profile windows */
#infoWindow, #profileWindow{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:800;background:linear-gradient(120deg,#1b1b1f,#2b2c2f);color:var(--text-light);padding:28px;box-sizing:border-box;overflow-y:auto}
#infoWindow .content, #profileWindow .content{max-width:1100px;margin:24px auto;border-radius:16px;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));color:#fff;box-shadow:0 18px 50px rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,0.02)}
#infoWindow h2, #profileWindow h2{color:#ecf8ff;margin-bottom:10px}

/* Profile sections */
.profile-section{
  margin-bottom:16px;
  padding:16px;
  border-radius:12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
  border:1px solid rgba(255,255,255,0.03);
  box-shadow:0 12px 30px rgba(0,0,0,0.5);
}
.profile-section h3{margin:0 0 8px;color:#ecf8ff;font-size:18px}
.profile-section p{margin:0 0 12px;color:#eaf5ff}
.profile-section .row{display:flex;gap:8px;align-items:center}
.profile-section .meta{font-weight:700;color:var(--birch);font-size:13px}
.profile-section .sep{height:1px;background:rgba(255,255,255,0.03);margin:12px 0;border-radius:1px}

/* Withdraw modal */
.withdraw-modal{display:none;position:fixed;inset:0;z-index:12000;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(10,10,12,0.75), rgba(20,20,24,0.85));backdrop-filter:blur(8px);padding:20px;box-sizing:border-box}
.withdraw-card{width:100%;max-width:820px;background:linear-gradient(180deg, rgba(18,18,20,0.98), rgba(34,34,36,0.98));border-radius:14px;padding:18px;box-shadow:0 30px 80px rgba(0,0,0,0.65);border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column;gap:14px}
.withdraw-header{display:flex;justify-content:space-between;align-items:center;color:#ecf8ff}
.withdraw-header .title{display:flex;align-items:center;gap:12px;margin-right:12px}
.withdraw-header .title .icon{width:44px;height:44px;border-radius:10px;background:linear-gradient(90deg,var(--wm-accentC),#7adcff);display:inline-flex;align-items:center;justify-content:center;font-weight:900;color:#000}
.withdraw-body{display:grid;grid-template-columns:1fr;gap:14px;align-items:start}
.withdraw-section{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 12px 30px rgba(0,0,0,0.45)}
.addr-input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text-light);font-weight:800}
.small-note{font-size:13px;color:var(--birch);font-weight:700}
.copy-btn{padding:8px 10px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--wm-accentC),#00A8FF);color:#000;font-weight:900;cursor:pointer}
.withdraw-actions{display:flex;gap:8px;justify-content:flex-end}
.withdraw-warning{background:linear-gradient(180deg, rgba(255,165,0,0.03), rgba(255,255,255,0.00));padding:10px;border-radius:8px;border:1px solid rgba(255,165,0,0.04);color:#ffdb9c;font-weight:700}
.withdraw-success{background:linear-gradient(180deg, rgba(57,255,20,0.02), rgba(255,255,255,0.00));padding:10px;border-radius:8px;border:1px solid rgba(57,255,20,0.04);color:var(--profit-green);font-weight:900}

/* Quests */
.quests-modal{
  display:none;
  position:fixed;
  inset:0;
  z-index:13000;
  align-items:center;
  justify-content:center;
  background:linear-gradient(180deg, rgba(6,10,14,0.6), rgba(6,10,14,0.8));
  backdrop-filter: blur(6px) saturate(1.02);
  padding:20px;
  box-sizing:border-box;
}
.quests-modal[aria-hidden="false"]{ display:flex; }

.quests-card{
  width:100%;
  max-width:880px;
  border-radius:14px;
  padding:18px;
  box-sizing:border-box;
  background: linear-gradient(180deg, rgba(30,30,32,0.98), rgba(44,44,48,0.98));
  border:1px solid rgba(255,255,255,0.03);
  box-shadow: 0 20px 60px rgba(0,0,0,0.6);
  display:flex;
  flex-direction:column;
  gap:12px;
  max-height: calc(100vh - 120px);
  overflow:auto;
}

.quests-header{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
.quests-header h2{ margin:0; font-size:18px; color:#ecf8ff; font-weight:900; }

.quests-container{ display:flex; flex-direction:column; gap:10px; padding-top:6px; }

.quest-card{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:12px 14px;
  border-radius:12px;
  background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));
  border:1px solid rgba(255,255,255,0.02);
  box-shadow: 0 8px 18px rgba(0,0,0,0.45);
  cursor:default;
  transition: transform .14s ease, box-shadow .14s ease;
}
.quest-card:hover{ transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0,0,0,0.6); }

.quest-left{ display:flex; gap:12px; align-items:flex-start; min-width:0; }
.quest-title{ font-weight:900; font-size:15px; color:#ecf8ff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:420px; }

.quest-arrow{
  flex:0 0 auto;
  margin-left:12px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:40px;
  height:40px;
  border-radius:10px;
  background:transparent;
  border:1px solid rgba(255,255,255,0.04);
  cursor:pointer;
  font-weight:900;
  transition: transform .14s ease, background .14s;
}
.quest-arrow:active{ transform:scale(.98); }
.quest-arrow:hover{ background: rgba(255,255,255,0.02); }

.claimBadge{background:linear-gradient(90deg,#FFD54A,#FFC107); color:#000; padding:6px 8px; border-radius:999px; font-weight:800; box-shadow:0 6px 20px rgba(255,193,7,0.12); font-size:12px;}

@media (max-width:700px){
  .quest-card{ padding:10px; gap:8px; }
  .quest-title{ font-size:14px; max-width:220px; }
  .quests-card{ padding:12px; }
}
  </style>
</head>
<body>
  <header>
    <div class="energy-panel" id="energyPanel" aria-live="polite" aria-atomic="true">
      <div class="icon">⚡</div>
      <div style="display:flex;flex-direction:column;align-items:flex-start;">
        <div style="font-size:11px;color:var(--birch);font-weight:800">Energy</div>
        <div style="display:flex;align-items:center;gap:8px;">
          <div class="val" id="energyVal">50</div>
          <div class="timer" id="energyTimer">—</div>
        </div>
      </div>
    </div>

    <div class="coin-panel" aria-live="polite" aria-atomic="true">
      <div style="display:flex;align-items:center;gap:8px;">
        <div class="coin-logo" title="XTR">
          <img src="logo.png" alt="XTR logo" />
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;line-height:1;">
          <div style="font-size:11px;color:var(--birch);font-weight:800">XTR</div>
          <div class="val" id="coinsVal">0</div>
        </div>
      </div>
       <div class="ton-panel" style="margin-left:6px;">
        <div class="ton-logo" title="TON">
          <img src="ton.png" alt="TON logo" />
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;line-height:1;">
          <div style="font-size:11px;color:var(--birch);font-weight:800">TON</div>
          <div class="ton-val" id="tonVal">0.00</div>
        </div>
      </div>
    </div>
  </header>

  <div class="house"></div>

  <div class="controls">
    <button id="startBtn" class="btnPrimary">🏠 Start</button>
    <button id="resetBtn" class="btnGhost">🔍 Hunt</button>
  </div>

  <div class="upgrade-panel" id="upgradePanel">
    <div class="upgrade" data-key="x2Prize" data-base-price="20000">
      <h3>x2 Prize / x2 Loss</h3>
      <p>Double rewards & penalties</p>
      <div class="price">20,000</div>
      <div class="badge">Boost</div>
    </div>
    <div class="upgrade" data-key="check1" data-base-price="20000">
      <h3>Check 1 Room Only</h3>
      <p>Hunter checks 1 room only (1 min)</p>
      <div class="price">20,000</div>
      <div class="timer" id="check1Timer"></div>
    </div>

    <div class="upgrade" data-key="shield" data-base-price="25000">
      <h3>Shield (1m)</h3>
      <p>Protects you from loss for 1 minute</p>
      <div class="price">25,000</div>
      <div class="timer" id="shieldTimer"></div>
      <div class="badge">Defence</div>
    </div>

    <div class="upgrade" data-key="incBoost" data-base-price="30000">
      <h3>Double Income (1m)</h3>
      <p>Mining income ×2 for 1 minute</p>
      <div class="price">30,000</div>
      <div class="timer" id="incTimer"></div>
      <div class="badge">Income</div>
    </div>

    <div class="upgrade" data-key="luck" data-base-price="22000">
      <h3>Lucky Escape (1m)</h3>
      <p>50% chance to evade if hunted (1 minute)</p>
      <div class="price">22,000</div>
      <div class="timer" id="luckTimer"></div>
      <div class="badge">Chance</div>
    </div>
  </div>

  <div class="mining-info">
    <strong id="miningLabel">Mining Income:</strong> <span id="miningIncomeVal">0</span>/hr
  </div>

  <div class="miners-panel" id="minersPanelVisible" aria-hidden="true"></div>

  <div id="miningShop" aria-hidden="true">
    <button id="closeMiningShopTop" class="close-top" title="Close">✕</button>
    <h2 id="shopTitle">Mining Shop</h2>
    <div class="miners-container"></div>
  </div>

  <div id="buyConfirm" aria-hidden="true">
    <div class="confirm-box">
      <p id="buyText"></p>
      <div style="display:flex;justify-content:center;">
        <button id="confirmBuy" class="btnPrimary">Buy</button>
        <button id="cancelBuy" class="btnGhost">Cancel</button>
      </div>
    </div>
  </div>

  <div id="profileWindow" aria-hidden="true">
    <div class="content">
      <h2 id="profileTitle">Profile</h2>

      <div class="profile-section" id="profile-daily">
        <h3 id="dailyTitle">Daily Reward</h3>
        <p id="dailyText">Get 30,000 XTR once a day!</p>
        <div class="row">
          <button id="claimDaily" class="btnPrimary" style="flex:1;">Claim Daily</button>
        </div>
        <div class="sep"></div>
        <p class="meta" id="dailyStatus" style="text-align:center;margin-top:8px;"></p>
      </div>

      <div class="profile-section" id="profile-quests-entry" style="display:flex;align-items:center;justify-content:space-between;">
        <div>
          <h3>Quests</h3>
          <p class="meta" style="margin:0;color:var(--birch);">Open available quests to get rewards.</p>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <button id="openQuestsBtn" class="btnPrimarySmall" style="padding:8px 12px;">Open</button>
        </div>
      </div>

      <div class="profile-section" id="profile-settings">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
          <div>
            <h3 id="settingsTitle">Settings</h3>
            <p id="settingsText">Change language and other preferences.</p>
          </div>
          <div>
            <select id="langSelect" class="select-lang" style="padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text-light);">
              <option value="ru">Русский</option>
              <option value="en">English</option>
            </select>
          </div>
        </div>
      </div>

      <button id="closeProfile" class="btnPrimary" style="width:100%;">Close</button>
    </div>
  </div>

  <div class="bottom-menu">
    <button id="miningBtn" class="btnGhost">⛏</button>
    <button id="profileBtn" class="btnGhost">👤</button>
    <button id="withdrawBtn" class="btnGhost" title="Вывод">💸</button>
    <button id="casinoBtn" class="btnGhost" title="Casino">🎰</button>
  </div>

  <!-- Rewards modal -->
  <div id="wsModalOverlay" aria-hidden="false" role="dialog" aria-label="Daily rewards modal">
    <div class="bgLayer" aria-hidden="true">
      <div class="bgImage" aria-hidden="true"></div>
    </div>

    <div class="glass" role="document" aria-modal="true">
      <div class="header">
        <div class="title">
          <div class="coinIcon">💎</div>
          <div>
            <div style="font-size:18px" id="wsTitle">Premium Gifts</div>
            <div class="sub">7 days of rewards — claim one per day</div>
          </div>
        </div>
        <div style="text-align:right">
          <div style="font-weight:800;color:var(--wm-accentC);font-size:18px" id="wsModalCoinsDisplay">0 XTR • 0.00 TON</div>
          <div style="font-size:12px;color:var(--wm-birch)">Coins balance</div>
        </div>
      </div>

      <div class="rewardsShell" id="rewardsShell">
        <div class="rewardsContainer" id="rewardsContainer">
          <div class="rewardsGridTop" id="rewardsGridTop" aria-hidden="false"></div>
          <div style="height:8px"></div>
          <div class="rewardsGridBottom" id="rewardsGridBottom" aria-hidden="false"></div>

          <div class="wsActions">
            <div class="left">Unlocked: <span id="wsUnlockedCount" style="font-weight:900;color:var(--wm-accentC)">0</span>/7</div>
            <div style="display:flex;gap:10px">
              <button class="btnGhost" id="wsBtnRules">How it works</button>
              <button class="btnPrimarySmall" id="wsBtnClose">Come back tomorrow</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Casino modal -->
  <div id="casinoModal" class="casino-modal" aria-hidden="true" role="dialog" aria-label="Casino wheel">
    <div class="card" role="document">
      <div class="casino-header">
        <div>
          <div id="casinoTitle" style="font-size:20px;font-weight:900">🎰 Казино</div>
          <div id="casinoSubtitle" style="color:var(--birch);font-weight:700">Spin the wheel — once every 2 hours</div>
        </div>
        <div id="casinoBalance" style="text-align:right;font-weight:800;color:var(--wm-accentC)">0 XTR • 0.00 TON</div>
      </div>

      <div class="casino-body">
        <div class="wheel-wrap">
          <canvas id="wheelCanvas" width="800" height="800" aria-hidden="false"></canvas>
          <div class="wheel-pointer" aria-hidden="true"></div>
        </div>

        <div class="casino-controls">
          <div class="casino-note">Next spin in: <span id="casinoCooldown">Ready</span></div>
          <button id="spinBtn" class="spin-btn">SPIN</button>
          <div>Result: <span id="casinoResult" class="casino-result">—</span></div>
          <button id="closeCasino" class="btnGhost" style="padding:8px 12px;border-radius:10px;">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Withdraw modal (simplified) -->
  <div id="withdrawModal" class="withdraw-modal" aria-hidden="true" role="dialog" aria-label="Вывод">
    <div class="withdraw-card" role="document">
      <div class="withdraw-header">
        <div class="title">
          <div class="icon">💸</div>
          <div>
            <div style="font-size:18px;font-weight:900">Вывод средств</div>
            <div style="font-size:13px;color:var(--birch)">Платежи проходят через TON</div>
          </div>
        </div>
        <div style="font-size:13px;color:var(--birch);">Доверие: выплаты оформляются администратором</div>
      </div>

      <div style="font-size:13px;color:var(--birch);margin-top:4px;">Все токены будут автоматически отправлены на указанный выше адрес в дату листинга монеты — <strong>15 декабря 2025</strong>.</div>

      <div class="withdraw-body">
        <div class="withdraw-section" aria-label="address-section">
          <div class="sec-title">📫 Адрес для выплат</div>
          <div class="sec-desc">Укажите TON-адрес. После сохранения адрес будет привязан.</div>

          <input id="withdrawAddressInput" class="addr-input" placeholder="UQ..." aria-label="TON address input" />
          <div style="height:10px"></div>
          <div style="display:flex;gap:8px;align-items:center;">
            <button id="saveWithdrawAddr" class="btnPrimary">Сохранить</button>
            <button id="changeWithdrawAddr" class="btnGhost">Сменить</button>
            <button id="copyAddrBtn" class="copy-btn" style="margin-left:auto;">Копировать</button>
          </div>
          <div style="height:10px"></div>
          <div id="boundAddrInfo" class="small-note"></div>
          <div id="withdrawStatus" class="withdraw-warning" style="margin-top:8px;">Проверьте адрес</div>
        </div>
      </div>

      <div style="display:flex;justify-content:flex-end;margin-top:12px;">
        <button id="closeWithdraw" class="btnGhost">Закрыть</button>
      </div>
    </div>
  </div>

  <!-- Quests Modal -->
  <div id="questsModal" class="quests-modal" aria-hidden="true" role="dialog" aria-label="Quests">
    <div class="quests-card" role="document">
      <div class="quests-header">
        <h2 id="questsTitle">Quests</h2>
        <button id="closeQuests" class="btnGhost" title="Close">✕</button>
      </div>
      <div class="quests-container" id="questsContainer" tabindex="0" aria-live="polite"></div>
    </div>
  </div>

<script>
  /* ===========================
     JS (modified: quests show only title; arrow claims 100000 XTR)
  =========================== */

  // Storage keys & constants
  const LS_COINS = 'coins';
  const LS_TON = 'player_ton_v1';
  const ZEX_TO_TON = 0.000001;

  // i18n (ru/en)
  const i18n = {
    ru: {
      pickRoomFirst: 'Сначала выберите комнату!',
      notEnough: 'Недостаточно монет!',
      dailyAlready: 'Ежедневная награда уже получена!',
      questAlready: 'Квест уже выполнен!',
      miningIncome: 'Доход майнинга:',
      miningShop: 'Магазин майнинга',
      close: 'Закрыть',
      howToPlay: 'Как играть',
      profile: 'Профиль',
      dailyReward: 'Ежедневная награда',
      dailyText: 'Получите 30 000 XTR раз в день!',
      claimDaily: 'Забрать',
      startBtn: '🏠 Начать',
      resetBtn: '🔍 Охота',
      wsTitle: 'Премиум подарки',
      wsSub: '7 дней наград — забирайте по одному в день',
      wsBtnClose: 'Вернуться завтра',
      wsBtnRules: 'Как это работает',
      dayLabel: 'День',
      claimed: 'Забрано',
      casinoTitle: '🎰 Казино',
      casinoSubtitle: 'Вращайте колесо — раз в 2 часа',
      spin: 'КРУТИТЬ',
      ready: 'Готово',
      full: 'Полный',
      coinsBalance: 'Баланс монет',
      questsTitle: 'Квесты',
      quest_tg_title: 'Подписаться в Telegram',
      quest_yt_title: 'Подписаться на YouTube',
      claimRewardConfirm: 'Забрать награду 100,000 XTR?',
      rewardGiven: 'Награда получена: +100,000 XTR',
      alreadyClaimed: 'Награду уже забрали.'
    },
    en: {
      pickRoomFirst: 'Pick a room first!',
      notEnough: 'Not enough coins!',
      dailyAlready: 'Daily reward already claimed!',
      questAlready: 'Quest already claimed!',
      miningIncome: 'Mining Income:',
      miningShop: 'Mining Shop',
      close: 'Close',
      howToPlay: 'How to Play',
      profile: 'Profile',
      dailyReward: 'Daily Reward',
      dailyText: 'Get 30,000 XTR once a day!',
      claimDaily: 'Claim Daily',
      startBtn: '🏠 Start',
      resetBtn: '🔍 Hunt',
      wsTitle: 'Premium Gifts',
      wsSub: '7 days of rewards — claim one per day',
      wsBtnClose: 'Come back tomorrow',
      wsBtnRules: 'How it works',
      dayLabel: 'Day',
      claimed: 'Claimed',
      casinoTitle: '🎰 Casino',
      casinoSubtitle: 'Spin the wheel — once every 2 hours',
      spin: 'SPIN',
      ready: 'Ready',
      full: 'Full',
      coinsBalance: 'Coins balance',
      questsTitle: 'Quests',
      quest_tg_title: 'Subscribe on Telegram',
      quest_yt_title: 'Subscribe on YouTube',
      claimRewardConfirm: 'Claim reward 100,000 XTR?',
      rewardGiven: 'Reward received: +100,000 XTR',
      alreadyClaimed: 'Reward already claimed.'
    }
  };

  let lang = localStorage.getItem('lang') || 'ru';
  function t(k){ return (i18n[lang] && i18n[lang][k]) || (i18n.ru && i18n.ru[k]) || ''; }

  // simple formatting
  function format(n){
    if (n >= 1e9) return (n/1e9).toFixed(1).replace(/\.0$/,'') + 'B';
    if (n >= 1e6) return (n/1e6).toFixed(1).replace(/\.0$/,'') + 'M';
    if (n >= 1e3) return (n/1e3).toFixed(1).replace(/\.0$/,'') + 'K';
    return String(n);
  }
  function formatTon(n){ if (!isFinite(n)) return '0.00'; return Number(n).toFixed(2); }

  // state
  let coins = +localStorage.getItem(LS_COINS) || 0;
  let ton = +localStorage.getItem(LS_TON) || 0;

  // update UI balances
  function updateBalancesDisplay(){
    const coinsVal = document.getElementById('coinsVal');
    if (coinsVal) coinsVal.textContent = format(coins);
    const tonEl = document.getElementById('tonVal');
    if (tonEl) tonEl.textContent = formatTon(ton);
    const ws = document.getElementById('wsModalCoinsDisplay');
    if (ws) ws.textContent = format(coins) + ' XTR • ' + formatTon(ton) + ' TON';
  }

  function updCoins(v){
    v = Number(v)||0;
    if (v>0) {
      ton += v * ZEX_TO_TON;
      localStorage.setItem(LS_TON, String(ton));
    }
    coins += v;
    if (coins < 0) coins = 0;
    localStorage.setItem(LS_COINS, String(coins));
    updateBalancesDisplay();
  }

  // init some basic UI pieces (rooms)
  const roomsContainer = document.querySelector('.house');
  for (let i = 0; i < 8; i++) {
    const d = document.createElement('div');
    d.className = 'room';
    d.dataset.idx = i;
    d.textContent = '+';
    roomsContainer.appendChild(d);
  }

  // apply language to a few elements
  function applyLang(){
    document.getElementById('miningLabel') && (document.getElementById('miningLabel').textContent = t('miningIncome'));
    document.getElementById('wsTitle') && (document.getElementById('wsTitle').textContent = t('wsTitle'));
    document.getElementById('startBtn') && (document.getElementById('startBtn').textContent = t('startBtn'));
    document.getElementById('resetBtn') && (document.getElementById('resetBtn').textContent = t('resetBtn'));
    document.getElementById('questsTitle') && (document.getElementById('questsTitle').textContent = t('questsTitle'));
  }

  // ---------- Quests: only titles, arrow opens link and allows claim 100000 ----------
  (function(){
    const questsModal = document.getElementById('questsModal');
    const questsContainer = document.getElementById('questsContainer');
    const openQuestsBtn = document.getElementById('openQuestsBtn');
    const closeQuestsBtn = document.getElementById('closeQuests');

    // quests: two items with URL and storage key
    const quests = [
      { key: 'tg', titleKey: 'quest_tg_title', url: 'https://t.me/xtr_monkey', storageKey: 'quest_claimed_tg' },
      { key: 'yt', titleKey: 'quest_yt_title', url: 'https://youtube.com/@xtr_monkey?si=wCkg9jAlFKSpm8XL', storageKey: 'quest_claimed_yt' }
    ];

    function isClaimed(q){
      return localStorage.getItem(q.storageKey) === '1';
    }
    function markClaimed(q){
      localStorage.setItem(q.storageKey, '1');
    }

    function render(){
      if (!questsContainer) return;
      questsContainer.innerHTML = '';
      quests.forEach(q=>{
        const card = document.createElement('div');
        card.className = 'quest-card';
        // only title (no description)
        card.innerHTML = `
          <div class="quest-left" role="button" tabindex="0">
            <div class="quest-meta">
              <div class="quest-title">${t(q.titleKey)}</div>
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:8px;">
            <div class="claim-area"></div>
            <button class="quest-arrow" data-action="${q.url}" aria-label="Open ${t(q.titleKey)}">→</button>
          </div>
        `;
        const arrow = card.querySelector('.quest-arrow');
        const claimArea = card.querySelector('.claim-area');

        // if already claimed, show badge
        if (isClaimed(q)) {
          const b = document.createElement('div');
          b.className = 'claimBadge';
          b.textContent = t('claimed') || 'Claimed';
          claimArea.appendChild(b);
        }

        arrow.addEventListener('click', (ev)=>{
          ev.stopPropagation();
          // open link in new tab
          try { window.open(q.url, '_blank', 'noopener'); } catch(e){ /* ignore */ }

          // if already claimed, notify
          if (isClaimed(q)) {
            alert(t('alreadyClaimed') || t('questAlready') || 'Already claimed');
            return;
          }

          // confirm claiming 100,000
          const conf = confirm(t('claimRewardConfirm') || 'Claim reward 100,000 XTR?');
          if (!conf) return;

          // give reward 100000
          try {
            updCoins(100000);
            markClaimed(q);
            // update UI: add badge
            const b = document.createElement('div');
            b.className = 'claimBadge';
            b.textContent = t('claimed') || 'Claimed';
            claimArea.appendChild(b);
            alert(t('rewardGiven') || 'Reward received: +100,000 XTR');
          } catch (e) {
            console.error('claim error', e);
            alert('Error while giving reward');
          }
        });

        // clicking the left area also opens link and triggers same flow
        card.querySelector('.quest-left').addEventListener('click', ()=> arrow.click());

        questsContainer.appendChild(card);
      });
    }

    function openModal(){
      if (!questsModal) return;
      questsModal.style.display = 'flex';
      questsModal.setAttribute('aria-hidden','false');
      render();
    }
    function closeModal(){
      if (!questsModal) return;
      questsModal.style.display = 'none';
      questsModal.setAttribute('aria-hidden','true');
    }

    if (openQuestsBtn) openQuestsBtn.addEventListener('click', openModal);
    if (closeQuestsBtn) closeQuestsBtn.addEventListener('click', closeModal);
    document.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeModal(); });

    window._questsModal = { open: openModal, close: closeModal, render };

    // render on load so that eye sees initial state if opened programmatically
    render();
  })();

  // Basic balances init
  updateBalancesDisplay();

  // language select handling
  const langSelect = document.getElementById('langSelect');
  if (langSelect) {
    langSelect.value = lang;
    langSelect.onchange = () => { lang = langSelect.value; localStorage.setItem('lang', lang); applyLang(); window._questsModal && window._questsModal.render && window._questsModal.render(); };
  }
  applyLang();

  // Minimal other functionality so page doesn't break
  (function initRoomsAndButtons(){
    let selectedRoom = null;
    document.querySelectorAll('.room').forEach(r => r.onclick = () => {
      document.querySelectorAll('.room').forEach(x=>x.classList.remove('selected'));
      r.classList.add('selected');
      selectedRoom = +r.dataset.idx;
    });

    document.getElementById('startBtn').onclick = ()=>{ if (selectedRoom == null) { alert(t('pickRoomFirst')); return; } document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe')); };
    document.getElementById('resetBtn').onclick = ()=>{ if (selectedRoom == null) { alert(t('pickRoomFirst')); return; } alert('Hunt simulated (no detailed game logic in this minimal demo).'); };
    const profileBtn = document.getElementById('profileBtn');
    const profileWindow = document.getElementById('profileWindow');
    if (profileBtn) profileBtn.onclick = ()=>{ if (profileWindow) { profileWindow.style.display = 'block'; profileWindow.setAttribute('aria-hidden','false'); } };
    const closeProfile = document.getElementById('closeProfile');
    if (closeProfile) closeProfile.onclick = ()=>{ if (profileWindow) { profileWindow.style.display = 'none'; profileWindow.setAttribute('aria-hidden','true'); } };
  })();

  // ensure withdraw functionality minimal (uses localStorage)
  (function withdrawInit(){
    const withdrawBtn = document.getElementById('withdrawBtn');
    const withdrawModal = document.getElementById('withdrawModal');
    const closeWithdraw = document.getElementById('closeWithdraw');
    const saveAddrBtn = document.getElementById('saveWithdrawAddr');
    const changeAddrBtn = document.getElementById('changeWithdrawAddr');
    const copyAddrBtn = document.getElementById('copyAddrBtn');
    const withdrawInput = document.getElementById('withdrawAddressInput');
    const boundInfo = document.getElementById('boundAddrInfo');
    const LS_WITHDRAW_ADDR = 'player_withdraw_ton_addr_v1';

    function loadBound(){ return localStorage.getItem(LS_WITHDRAW_ADDR) || ''; }
    function saveBound(a){ localStorage.setItem(LS_WITHDRAW_ADDR, a); }
    function mask(a){ if (!a) return ''; if (a.length<=10) return a; return a.slice(0,6) + '...' + a.slice(-6); }

    function render(){
      const a = loadBound();
      if (a) {
        boundInfo.textContent = 'Привязанный адрес: ' + mask(a);
        withdrawInput.style.display = 'none';
        saveAddrBtn.style.display = 'none';
        changeAddrBtn.style.display = 'inline-block';
        copyAddrBtn.style.display = 'inline-block';
      } else {
        boundInfo.textContent = 'Адрес не привязан.';
        withdrawInput.style.display = 'block';
        saveAddrBtn.style.display = 'inline-block';
        changeAddrBtn.style.display = 'none';
        copyAddrBtn.style.display = 'none';
      }
    }

    if (withdrawBtn) withdrawBtn.addEventListener('click', ()=>{ withdrawModal.style.display = 'flex'; withdrawModal.setAttribute('aria-hidden','false'); render(); });
    if (closeWithdraw) closeWithdraw.addEventListener('click', ()=>{ withdrawModal.style.display = 'none'; withdrawModal.setAttribute('aria-hidden','true'); });

    if (saveAddrBtn) saveAddrBtn.addEventListener('click', ()=>{ const v = (withdrawInput.value||'').trim(); if (!v) { alert('Введите адрес'); return; } saveBound(v); render(); });
    if (changeAddrBtn) changeAddrBtn.addEventListener('click', ()=>{ withdrawInput.style.display = 'block'; withdrawInput.value = ''; saveAddrBtn.style.display = 'inline-block'; changeAddrBtn.style.display = 'none'; copyAddrBtn.style.display = 'none'; boundInfo.textContent = 'Введите новый адрес.'; });
    if (copyAddrBtn) copyAddrBtn.addEventListener('click', ()=>{ const a = loadBound(); if (!a) return; navigator.clipboard && navigator.clipboard.writeText(a).then(()=>{ alert('Адрес скопирован'); }).catch(()=>{ alert('Не удалось скопировать'); }); });
    render();
  })();

</script>
</body>
</html>
