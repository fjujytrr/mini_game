<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hide & Seek ‚Äî Premium Emoji (TON Wallets)</title>
  <style>
:root{
  --wm-accentA:#1b1b1f;
  --wm-accentB:#2b2b2f;
  --wm-accentC:#00D8FF;
  --wm-birch:#EDE4C8;
  --accent-cyan:#00D8FF;
  --birch:#EDE4C8;
  --purple-frame:#7a4bff;
  --deep-purple:#5a2ecc;
  --glass-weak: rgba(255,255,255,0.01);
  --glass-strong: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
  --bg-dark: linear-gradient(120deg,#1f2023,#2a2c31);
  --text-light: #ecf2ff;
  --profit-green: #39FF14;
  --logo-border-light: #dcdcdc;
}
html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg-dark);color:var(--text-light);overflow:hidden}
body{display:flex;flex-direction:column;align-items:center;min-height:100vh}
/* ... (rest of CSS is identical to previous file - omitted here for brevity) ... */
/* small screens tweak */
@media (max-width:520px){
  .coin-logo{width:32px;height:32px;border-width:2px}
  .btnPrimary{font-size:16px;padding:12px}
  #miningShop .miner-card{width:46%}
  .upgrade{min-width:160px}
  .coin-panel{min-width:100px;max-width:220px;padding:6px 6px}
  .coin-panel .val{font-size:12px}
}
  </style>
</head>
<body>
  <header>
    <!-- Energy -->
    <div class="energy-panel" id="energyPanel" aria-live="polite" aria-atomic="true">
      <div class="icon">‚ö°</div>
      <div style="display:flex;flex-direction:column;align-items:flex-start;">
        <div style="font-size:11px;color:var(--birch);font-weight:800">Energy</div>
        <div style="display:flex;align-items:center;gap:8px;">
          <div class="val" id="energyVal">50</div>
          <div class="timer" id="energyTimer">‚Äî</div>
        </div>
      </div>
    </div>

    <!-- Coin panel -->
    <div class="coin-panel" aria-live="polite" aria-atomic="true">
      <div style="display:flex;align-items:center;gap:8px;">
        <div class="coin-logo" title="ZEX">
          <img src="logo.png" alt="ZEX logo" />
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;line-height:1;">
          <div style="font-size:11px;color:var(--birch);font-weight:800">ZEX</div>
          <div class="val" id="coinsVal">0</div>
        </div>
      </div>
       <div class="ton-panel" style="margin-left:6px;">
        <div class="ton-logo" title="TON">
          <img src="ton.png" alt="TON logo" />
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;line-height:1;">
          <div style="font-size:11px;color:var(--birch);font-weight:800">TON</div>
          <div class="ton-val" id="tonVal">0.00</div>
        </div>
      </div>
    </div>
  </header>

  <div class="house"></div>

  <div class="controls">
    <button id="startBtn" class="btnPrimary">üè† Start</button>
    <button id="resetBtn" class="btnGhost">üîç Hunt</button>
  </div>

  <div class="upgrade-panel" id="upgradePanel">
    <!-- upgrades omitted for brevity; same as original -->
  </div>

  <div class="mining-info">
    <strong id="miningLabel">Mining Income:</strong> <span id="miningIncomeVal">0</span>/hr
  </div>

  <div class="miners-panel" id="minersPanelVisible" aria-hidden="true"></div>

  <div id="miningShop" aria-hidden="true">
    <h2 id="shopTitle">Mining Shop</h2>
    <div class="miners-container"></div>
    <button id="closeMiningShop" class="btnGhost" style="margin-top:12px;width:100%;padding:12px;border-radius:12px;">Close</button>
  </div>

  <div id="buyConfirm" aria-hidden="true">
    <div class="confirm-box">
      <p id="buyText"></p>
      <div style="display:flex;justify-content:center;">
        <button id="confirmBuy" class="btnPrimary">Buy</button>
        <button id="cancelBuy" class="btnGhost">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Info, Profile, Rewards, Casino modals omitted for brevity (same as previous) -->

  <!-- Wallet modal: hosts TON Connect UI (supports many TON wallets) -->
  <div id="walletModal" class="casino-modal" aria-hidden="true" role="dialog" aria-label="Connect TON Wallet">
    <div class="card" role="document" style="max-width:520px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <div style="font-size:20px;font-weight:900">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å TON-–∫–æ—à–µ–ª—ë–∫</div>
        <div id="walletConnectedIcon" style="font-weight:800;color:var(--wm-accentC)"></div>
      </div>

      <div style="padding:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:12px;margin-bottom:12px;">
        <div style="font-weight:700;color:var(--birch);margin-bottom:6px;">–°—Ç–∞—Ç—É—Å</div>
        <div id="walletStatus">–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ</div>
        <div id="walletAddress" style="font-size:13px;color:var(--wm-accentC);font-weight:800;margin-top:6px"></div>
      </div>

      <div style="display:flex;gap:8px;flex-direction:column;">
        <div id="ton-connect-root" style="display:flex;justify-content:center;"></div>
        <div style="display:flex;gap:8px;">
          <button id="openWalletModalBtn" class="btnGhost" style="flex:1;">Open connect dialog</button>
          <button id="disconnectWalletBtn" class="btnGhost" style="flex:1;">Disconnect</button>
        </div>
        <div style="font-size:13px;color:var(--birch);">–≠—Ç–æ—Ç –≤–∏–¥–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TON Connect ‚Äî –æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç TonKeeper, TonHub, Binance Web3 –∏ –¥—Ä—É–≥–∏–µ –∫–æ—à–µ–ª—å–∫–∏ —Å TON.</div>
        <div style="display:flex;gap:8px;margin-top:12px;">
          <button id="closeWalletModal" class="btnGhost" style="flex:1;">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="bottom-menu">
    <button id="infoBtn" class="btnGhost">‚Ñπ</button>
    <button id="shopBtn" class="btnGhost">üõí</button>
    <button id="miningBtn" class="btnGhost">‚õè</button>
    <button id="profileBtn" class="btnGhost">üë§</button>
    <button id="walletBtn" class="btnGhost" title="Connect Wallet">üîå</button>
    <button id="casinoBtn" class="btnGhost" title="Casino">üé∞</button>
  </div>

  <!-- TonConnect UI (CDN) -->
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

  <script>
  // ---------- Minimal TON Connect integration (UI) ----------
  // Uses TON Connect UI library (renders a standard wallet selector and handles connection flows).
  // See docs: https://docs.ton.org/develop/dapps/ton-connect/overview for manifest and usage.

  let tonConnectUI = null;
  const manifestUrl = (location.protocol === 'file:') ? 'https://example.com/tonconnect-manifest.json' : location.origin + '/tonconnect-manifest.json';
  // NOTE: create a `tonconnect-manifest.json` on your server (see docs). For local testing you can host it anywhere and update manifestUrl.

  function initTonConnectUI(){
    try{
      if (window.TON_CONNECT_UI && !tonConnectUI){
        tonConnectUI = new TON_CONNECT_UI.TonConnectUI({ manifestUrl, buttonRootId: 'ton-connect-root' });

        tonConnectUI.onStatusChange((status) => {
          // status: 'connected' | 'disconnected' | 'connecting'
          const statusEl = document.getElementById('walletStatus');
          const addrEl = document.getElementById('walletAddress');
          const icon = document.getElementById('walletConnectedIcon');
          if (status === 'connected'){
            statusEl.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
            icon.textContent = '‚úì';
            const account = tonConnectUI.getAccount(); // returns {address, name, ...} when connected
            if (account && account.address) addrEl.textContent = account.address;
            updateBalancesDisplay();
          } else if (status === 'connecting'){
            statusEl.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            icon.textContent = '';
          } else {
            statusEl.textContent = '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
            addrEl.textContent = '';
            icon.textContent = '';
          }
        });
      }
    }catch(e){
      console.warn('TonConnect UI init failed', e);
    }
  }

  async function openTonConnectModal(){
    try{
      initTonConnectUI();
      if (!tonConnectUI) throw new Error('TON Connect UI not available');
      await tonConnectUI.openModal();
    }catch(e){
      alert('–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + (e && e.message ? e.message : String(e)));
    }
  }

  async function disconnectTon(){
    try{
      if (tonConnectUI) await tonConnectUI.disconnect();
      document.getElementById('walletStatus').textContent = '–ù–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ';
      document.getElementById('walletAddress').textContent = '';
      document.getElementById('walletConnectedIcon').textContent = '';
    }catch(e){ console.warn('disconnect failed', e); }
  }

  // Fallback lightweight detection for common injected wallets (TonKeeper, Tonhub, Binance)
  function detectTonWallets(){
    const detected = [];
    if (window.TonKeeper || window.tonkeeper || window.ton) detected.push('TonKeeper');
    if (window.tonhub) detected.push('TonHub');
    if (window.BinanceChain || window.BinanceWallet) detected.push('Binance Web3');
    return detected;
  }

  // Wire UI buttons
  document.getElementById('walletBtn').addEventListener('click', ()=>{
    document.getElementById('walletModal').style.display = 'flex';
    document.getElementById('walletModal').setAttribute('aria-hidden','false');
    initTonConnectUI();
    const found = detectTonWallets();
    document.getElementById('walletStatus').textContent = found.length ? '–ù–∞–π–¥–µ–Ω: ' + found.join(', ') : 'Wallets not detected (use TON Connect UI to open list)';
  });
  document.getElementById('closeWalletModal').addEventListener('click', ()=>{ document.getElementById('walletModal').style.display = 'none'; document.getElementById('walletModal').setAttribute('aria-hidden','true'); });
  document.getElementById('openWalletModalBtn').addEventListener('click', openTonConnectModal);
  document.getElementById('disconnectWalletBtn').addEventListener('click', disconnectTon);

  // Init when page loads (so the TonConnect UI button is rendered into the modal)
  window.addEventListener('load', ()=>{
    initTonConnectUI();
  });

  // ---------- The rest of your game's JS (energy, coins, miners, rewards, etc.) remains unchanged ----------
  // For brevity this file keeps the same game logic as before. Make sure save(), updCoins(), updateBalancesDisplay() and formatTon() are available globally.

  </script>
</body>
</html>
