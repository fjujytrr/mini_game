<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hide & Seek ‚Äî Premium Emoji</title>
<style>
:root{
  --accent-cyan:#00D8FF;
  --birch:#EDE4C8;
  --purple-frame:#7a4bff;
  --light-purple:#EADFFF;
  --deep-purple:#5a2ecc;
}

/* --- —Ñ–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî —á—É—Ç—å —Å–≤–µ—Ç–ª–µ–µ --- */
html,body{
  height:100%;
  margin:0;
  padding:0;
  font-family:Inter,system-ui,Arial,sans-serif;
  background:linear-gradient(120deg,#5a3b9a,#a7c4ff); /* —Å–≤–µ—Ç–ª–µ–µ, —á–µ–º —Ä–∞–Ω—å—à–µ */
  background-size:200% 200%;
  animation:gradientBG 15s ease infinite;
  color:#fff;
  overflow:hidden;
}
@keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
body{display:flex;flex-direction:column;align-items:center;min-height:100vh}

/* Header */
header{width:95%;margin:15px 0;display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,0.06);border-radius:12px;padding:10px;backdrop-filter:blur(4px)}
.level-bar{display:flex;gap:6px;background:rgba(0,0,0,0.07);padding:6px 10px;border-radius:12px;flex:1;justify-content:space-between}
.level{flex:1;text-align:center;padding:6px 0;font-size:14px;font-weight:700;color:#eee;border-radius:8px;background:rgba(255,255,255,0.04);transition:.25s;cursor:pointer}
.level.active{background:var(--accent-cyan);color:#000;box-shadow:0 0 8px var(--accent-cyan)}
.coin-panel{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,0.06);padding:8px 12px;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
.coin-logo{width:40px;height:40px;border-radius:50%;object-fit:cover;border:3px solid var(--purple-frame);background:#fff}
.coin-panel .val{font-weight:700;font-size:18px;color:var(--accent-cyan)}

/* House (rooms) */
.house{position:relative;width:95%;max-width:500px;margin:20px 0;display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(4,1fr);gap:12px}
.room{background:rgba(255,255,255,0.06);border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:28px;color:#fff;cursor:pointer;transition:transform .3s,box-shadow .3s;position:relative;border:2px solid rgba(255,255,255,0.08)}
.room:hover{transform:scale(1.03)}
.room.selected{border-color:var(--accent-cyan)}
.room.found{border-color:#FF0054}
.room.safe{border-color:#39FF14}

/* Controls */
.controls{width:90%;display:flex;justify-content:space-between;margin-bottom:15px}
button{flex:1;margin:0 5px;padding:14px;font-size:20px;border:none;border-radius:12px;cursor:pointer;color:#000;background:var(--accent-cyan);box-shadow:0 6px 18px rgba(0,0,0,0.08)}
button.secondary{background:rgba(255,255,255,0.08);color:#000;box-shadow:0 6px 18px rgba(0,0,0,0.06)}

/* Bottom menu */
.bottom-menu{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:90%;max-width:480px;display:flex;justify-content:space-around;gap:8px;background:rgba(255,255,255,0.06);padding:6px 0;border-radius:16px;box-shadow:0 6px 20px rgba(0,0,0,0.06)}
.bottom-menu button{background:transparent;color:#fff;font-size:22px;transition:transform .18s}
.bottom-menu button:hover{transform:scale(1.12)}

/* Upgrade panel (–≤–∏–¥–Ω–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ) */
.upgrade-panel{display:flex;gap:12px;margin:10px 0;overflow-x:auto;padding:10px;width:95%;justify-content:center;align-items:stretch}
.upgrade{flex:0 0 auto;background:rgba(255,255,255,0.06);padding:12px;border-radius:14px;text-align:center;min-width:220px;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
.upgrade h3{margin:0 0 6px;font-size:16px;color:var(--deep-purple)}
.upgrade p{margin:0;font-size:14px;color:#222}
.upgrade .price{margin-top:6px;font-weight:700;color:var(--birch)}

/* Mining info */
.mining-info{margin:10px 0;padding:10px 12px;background:rgba(255,255,255,0.05);border-radius:14px;width:95%;text-align:center;box-shadow:0 6px 18px rgba(0,0,0,0.06)}

/* –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –º–∞–π–Ω–µ—Ä–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ ‚Äî –æ–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã */
#minersPanelVisible{display:none;}

/* Modal mining shop (full-screen modal) */
#miningShop{
  display:none;
  position:fixed;
  top:0;left:0;width:100%;height:100%;z-index:900;
  background:linear-gradient(120deg,#5a3b9a,#a7c4ff);
  color:#fff;padding:18px;box-sizing:border-box;overflow:hidden;
}
#miningShop .shop-inner{
  max-width:920px;margin:0 auto;height:100%;display:flex;flex-direction:column;
}
#miningShop h2{color:#fff;text-align:center;margin-bottom:8px}

/* –°–µ—Ç–∫–∞ –º–∞–π–Ω–µ—Ä–æ–≤: 2 –∫–æ–ª–æ–Ω–∫–∏, –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ */
#miningShop .miners-container{
  display:grid;
  grid-template-columns:repeat(2, minmax(0,1fr)); /* 2 –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —Ä—è–¥ */
  gap:12px;
  padding:6px;
  overflow-y:auto;
  flex:1; /* –∑–∞–ø–æ–ª–Ω–∏—Ç—å –≤—ã—Å–æ—Ç—É –≤–Ω—É—Ç—Ä–∏ .shop-inner */
  -webkit-overflow-scrolling:touch;
}
#miningShop .miner-card{
  background:rgba(255,255,255,0.06);
  color:#fff;border-radius:12px;padding:10px;display:flex;flex-direction:column;align-items:center;gap:8px;
  min-height:100px; /* —á—É—Ç—å –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
  box-shadow:0 6px 18px rgba(0,0,0,0.12);border:1px solid rgba(255,255,255,0.04);
}
#miningShop .miner-card .card-logo{width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid var(--purple-frame);background:#fff}
#miningShop .miner-card h3{margin:0;font-size:16px;color:#fff}
#miningShop .miner-card .income{color:var(--birch);font-weight:700}
#miningShop .miners-footer{margin-top:10px}

/* Buy confirm modal ‚Äî —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ (–±–µ–∑ –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è —ç–∫—Ä–∞–Ω–∞) */
#buyConfirm{
  display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:950;background:transparent;padding:0;box-sizing:border-box;
}
#buyConfirm .confirm-box{
  max-width:480px;padding:12px;border-radius:12px;background:linear-gradient(120deg, rgba(90,46,204,0.95), rgba(122,75,255,0.95));border:2px solid var(--accent-cyan);box-shadow:0 10px 40px rgba(0,0,0,0.18);
}
#buyConfirm p{color:#fff;margin:10px 0}
#buyConfirm button{margin:6px 6px;padding:8px 12px;border-radius:8px;border:none;background:var(--accent-cyan);font-weight:700;color:#000}

/* Info & Profile windows ‚Äî —Ç–µ–ø–µ—Ä—å –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –∏ —Ñ–æ–Ω –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π */
/* –æ–∫–Ω–æ-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–ø–æ–ª–Ω–æ–µ –æ–∫–Ω–æ) */
#infoWindow, #profileWindow{
  display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:920;box-sizing:border-box;padding:0;margin:0;overflow:auto;
}
/* when opened with .full class, background is opaque and .content fills whole screen */
#infoWindow.full, #profileWindow.full{
  background:var(--light-purple); /* –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Å–≤–µ—Ç–ª–æ-—Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π —Ñ–æ–Ω */
}

/* content will fill the screen when .full is applied */
#infoWindow.full .content, #profileWindow.full .content{
  width:100%;height:100%;margin:0;border-radius:0;padding:20px;box-sizing:border-box;color:#1b0630; /* —Ç–µ–º–Ω–µ–µ —Ç–µ–∫—Å—Ç */
}

/* default content (if shown non-full) - keep safe styles */
#infoWindow .content, #profileWindow .content{
  max-width:720px;margin:24px auto;border-radius:12px;padding:18px;background:linear-gradient(160deg, rgba(210,180,255,0.95), rgba(240,225,255,0.98));color:#000;box-shadow:0 6px 20px rgba(0,0,0,0.08)
}
#infoWindow h2, #profileWindow h2{color:var(--deep-purple)}
#infoWindow ul{color:#333;padding-left:20px}
#infoWindow ul li::before{content:'‚Ä¢ ';color:var(--deep-purple);font-weight:600}

/* profile content specifics */
.settings-card{margin-top:12px;padding:12px;background:rgba(255,255,255,0.03);border-radius:12px}
.settings-row{display:flex;align-items:center;justify-content:space-between;gap:12px}
.select-lang{padding:8px 10px;border-radius:8px;border:none;font-weight:700}

/* –∞–¥–∞–ø—Ç–∏–≤ */
@media (max-width:520px){
  header{padding:8px}
  .coin-logo{width:34px;height:34px}
  button{font-size:16px;padding:10px}
  #miningShop .miners-container{grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
}
</style>
</head>
<body>

<header>
  <div class="level-bar">
    <div class="level" data-val="10000">10K</div>
    <div class="level" data-val="50000">50K</div>
    <div class="level" data-val="100000">100K</div>
    <div class="level" data-val="250000">250K</div>
    <div class="level" data-val="500000">500K</div>
    <div class="level" data-val="1000000">1M</div>
    <div class="level" data-val="5000000">5M</div>
  </div>
  <div class="coin-panel">
    <img class="coin-logo" src="logo.png" alt="Coin logo" />
    <div class="val" id="coinsVal">0</div>
  </div>
</header>

<!-- –ö–æ–º–Ω–∞—Ç—ã -->
<div class="house"></div>

<!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã -->
<div class="controls">
  <button id="startBtn">üè†</button>
  <button class="secondary" id="resetBtn">üîç</button>
</div>

<!-- Upgrade panel ‚Äî –≤–∏–¥–µ–Ω –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ, –º–∞–π–Ω–µ—Ä—ã —É–¥–∞–ª–µ–Ω—ã —Å –≥–ª–∞–≤–Ω–æ–≥–æ -->
<div class="upgrade-panel" id="upgradePanel">
  <div class="upgrade" data-key="x2Prize" data-base-price="20000">
    <h3>x2 Prize / x2 Loss</h3>
    <p>Double rewards & penalties</p>
    <div class="price">20,000</div>
  </div>
  <div class="upgrade" data-key="check1" data-base-price="20000">
    <h3>Check 1 Room Only</h3>
    <p>Hunter checks 1 room only (1 min)</p>
    <div class="price">20,000</div>
    <div class="timer" id="check1Timer"></div>
  </div>
</div>

<div class="mining-info">
  <strong id="miningLabel">Mining Income:</strong> <span id="miningIncomeVal">0</span>/hr
</div>

<!-- –ü–∞–Ω–µ–ª—å –º–∞–π–Ω–µ—Ä–æ–≤ (—Å–∫—Ä—ã—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º) -->
<div id="minersPanelVisible"></div>

<!-- –ú–æ–¥–∞–ª—å–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω –º–∞–π–Ω–µ—Ä–æ–≤ (–æ—Ç–¥–µ–ª—å–Ω—ã–π full-screen modal —Å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π –∫–∞—Ä—Ç–æ—á–µ–∫ 2 –≤ —Ä—è–¥) -->
<div id="miningShop" aria-hidden="true">
  <div class="shop-inner">
    <h2 id="shopTitle">Mining Shop</h2>
    <div class="miners-container"></div>
    <div class="miners-footer" style="margin-top:10px;">
      <button id="closeMiningShop" style="width:100%;padding:12px;border-radius:10px;border:none;background:rgba(0,0,0,0.12);color:#fff;cursor:pointer;">Close</button>
    </div>
  </div>
</div>

<!-- –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∫–∏ -->
<div id="buyConfirm" aria-hidden="true">
  <div class="confirm-box">
    <p id="buyText"></p>
    <div style="display:flex;justify-content:center;">
      <button id="confirmBuy">Buy</button>
      <button id="cancelBuy" style="background:rgba(255,255,255,0.12);color:#fff;margin-left:8px;">Cancel</button>
    </div>
  </div>
</div>

<!-- Info window (–û–± –∏–≥—Ä–µ) -->
<div id="infoWindow" aria-hidden="true">
  <div class="content">
    <h2 id="infoTitle">How to Play</h2>
    <ul id="infoList">
      <li>Select a room and then click the üîç button to hunt.</li>
      <li>The hunter searches 2 random rooms (1 if "Check 1 Room" is active).</li>
      <li>If your room is found, you lose coins (shown in red).</li>
      <li>If you evade the hunt, you gain coins (shown in green).</li>
      <li>Buy upgrades or miners to improve your chances and income.</li>
      <li>Claim daily rewards and complete quests for bonus coins.</li>
    </ul>
    <button id="closeInfo">Close</button>
  </div>
</div>

<!-- Profile window (–Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏) -->
<div id="profileWindow" aria-hidden="true">
  <div class="content">
    <h2 id="profileTitle">Profile</h2>

    <div style="margin-bottom:16px;padding:16px;background:rgba(255,255,255,0.06);border-radius:12px;">
      <h3 id="dailyTitle" style="margin-bottom:8px;font-size:18px;color:#2b1440">Daily Reward</h3>
      <p id="dailyText" style="margin-bottom:12px;color:#2b1440">Get 30,000 coins once a day!</p>
      <button id="claimDaily" style="width:100%;padding:12px;font-size:16px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Claim Daily</button>
      <p id="dailyStatus" style="margin-top:8px;color:var(--deep-purple);font-weight:600;text-align:center;"></p>
    </div>

    <div style="margin-bottom:16px;padding:16px;background:rgba(255,255,255,0.06);border-radius:12px;">
      <h3 id="questTitle" style="margin-bottom:8px;font-size:18px;color:#2b1440">Quest</h3>
      <p id="questText" style="margin-bottom:12px;color:#2b1440">Subscribe to get bonus coins!</p>
      <button id="claimQuest" style="width:100%;padding:12px;font-size:16px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Claim Quest</button>
      <p id="questStatus" style="margin-top:8px;color:var(--deep-purple);font-weight:600;text-align:center;"></p>
    </div>

    <div class="settings-card">
      <div class="settings-row">
        <div>
          <h3 id="settingsTitle">Settings</h3>
          <p id="settingsText">Change language and other preferences.</p>
        </div>
        <div>
          <select id="langSelect" class="select-lang">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="en">English</option>
          </select>
        </div>
      </div>
    </div>

    <button id="closeProfile" style="width:100%;padding:14px;font-size:18px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Close</button>
  </div>
</div>

<!-- Bottom menu -->
<div class="bottom-menu">
  <button id="infoBtn" class="secondary">‚Ñπ</button>
  <button id="shopBtn" class="secondary">üõí</button>
  <button id="miningBtn" class="secondary">‚õè</button>
  <button id="profileBtn" class="secondary">üë§</button>
</div>

<script>
/* ===== i18n (ru/en) ===== */
const i18n = {
  ru: {
    pickRoomFirst:'–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É!',
    notEnough:'–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!',
    dailyAlready:'–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–∞!',
    questAlready:'–ö–≤–µ—Å—Ç —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω!',
    miningIncome:'–î–æ—Ö–æ–¥ –º–∞–π–Ω–∏–Ω–≥–∞:',
    miningShop:'–ú–∞–≥–∞–∑–∏–Ω –º–∞–π–Ω–∏–Ω–≥–∞',
    close:'–ó–∞–∫—Ä—ã—Ç—å',
    howToPlay:'–ö–∞–∫ –∏–≥—Ä–∞—Ç—å',
    infoList:[
      '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É üîç –¥–ª—è –æ—Ö–æ—Ç—ã.',
      '–û—Ö–æ—Ç–Ω–∏–∫ –∏—â–µ—Ç 2 —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã (1, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω "Check 1 Room").',
      '–ï—Å–ª–∏ –≤–∞—à—É –∫–æ–º–Ω–∞—Ç—É –Ω–∞—à–ª–∏, –≤—ã —Ç–µ—Ä—è–µ—Ç–µ –º–æ–Ω–µ—Ç—ã (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫—Ä–∞—Å–Ω—ã–º).',
      '–ï—Å–ª–∏ –≤—ã –∏–∑–±–µ–∂–∞–ª–∏ –æ—Ö–æ—Ç—ã, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –º–æ–Ω–µ—Ç—ã (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∑–µ–ª–µ–Ω—ã–º).',
      '–ü–æ–∫—É–ø–∞–π—Ç–µ –∞–ø–≥—Ä–µ–π–¥—ã –∏–ª–∏ –º–∞–π–Ω–µ—Ä–æ–≤, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å —à–∞–Ω—Å—ã –∏ –¥–æ—Ö–æ–¥.',
      '–ó–∞–±–∏—Ä–∞–π—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∫–≤–µ—Å—Ç—ã –¥–ª—è –±–æ–Ω—É—Å–Ω—ã—Ö –º–æ–Ω–µ—Ç.'
    ],
    profile:'–ü—Ä–æ—Ñ–∏–ª—å', dailyReward:'–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞', dailyText:'–ü–æ–ª—É—á–∏—Ç–µ 30 000 –º–æ–Ω–µ—Ç —Ä–∞–∑ –≤ –¥–µ–Ω—å!',
    claimDaily:'–ó–∞–±—Ä–∞—Ç—å', quest:'–ö–≤–µ—Å—Ç', claimQuest:'–í–∑—è—Ç—å',
    settings:'–ù–∞—Å—Ç—Ä–æ–π–∫–∏', settingsText:'–°–º–µ–Ω–∏—Ç–µ —è–∑—ã–∫ –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.',
    buyFor:'–ö—É–ø–∏—Ç—å {name} –∑–∞ {price}?', buy:'–ö—É–ø–∏—Ç—å', cancel:'–û—Ç–º–µ–Ω–∞', profitHr:'–ü—Ä–∏–±—ã–ª—å/—á:'
  },
  en: {
    pickRoomFirst:'Pick a room first!', notEnough:'Not enough coins!', dailyAlready:'Daily reward already claimed!',
    questAlready:'Quest already claimed!', miningIncome:'Mining Income:', miningShop:'Mining Shop', close:'Close',
    howToPlay:'How to Play', infoList:[
      'Select a room and then click the üîç button to hunt.',
      'The hunter searches 2 random rooms (1 if "Check 1 Room" is active).',
      'If your room is found, you lose coins (shown in red).',
      'If you evade the hunt, you gain coins (shown in green).',
      'Buy upgrades or miners to improve your chances and income.',
      'Claim daily rewards and complete quests for bonus coins.'
    ],
    profile:'Profile', dailyReward:'Daily Reward', dailyText:'Get 30,000 coins once a day!',
    claimDaily:'Claim Daily', quest:'Quest', claimQuest:'Claim Quest',
    settings:'Settings', settingsText:'Change language and other preferences.',
    buyFor:'Buy {name} for {price}?', buy:'Buy', cancel:'Cancel', profitHr:'Profit/hr:'
  }
};
let lang = localStorage.getItem('lang') || 'ru';
function t(key, vars={}){ const val = i18n[lang][key]; if(typeof val==='string') return val.replace(/\{(\w+)\}/g,(m,k)=>vars[k]||''); return val; }
function applyLang(){
  document.getElementById('miningLabel').textContent = t('miningIncome');
  document.getElementById('shopTitle').textContent = t('miningShop');
  document.getElementById('closeMiningShop').textContent = t('close');
  document.getElementById('confirmBuy').textContent = t('buy');
  document.getElementById('cancelBuy').textContent = t('cancel');
  document.getElementById('infoTitle').textContent = t('howToPlay');
  document.getElementById('profileTitle').textContent = t('profile');
  document.getElementById('dailyTitle').textContent = t('dailyReward');
  document.getElementById('dailyText').textContent = t('dailyText');
  document.getElementById('claimDaily').textContent = t('claimDaily');
  document.getElementById('claimQuest').textContent = t('claimQuest');
  document.getElementById('settingsTitle').textContent = t('settings');
  document.getElementById('settingsText').textContent = t('settingsText');
  document.getElementById('closeInfo').textContent = t('close');
  document.getElementById('closeProfile').textContent = t('close');

  const infoListEl = document.getElementById('infoList'); infoListEl.innerHTML=''; t('infoList').forEach(li=>{ const el=document.createElement('li'); el.textContent = li; infoListEl.appendChild(el);});
}

/* ===== UI init and state ===== */
const roomsContainer = document.querySelector('.house');
for(let i=0;i<8;i++){ const d=document.createElement('div'); d.className='room'; d.dataset.idx=i; d.textContent='+'; roomsContainer.appendChild(d); }

let selectedRoom = null;
let coins = +localStorage.getItem('coins')||0;
let maxCoins = +localStorage.getItem('maxCoins')||coins;
const coinsVal = document.getElementById('coinsVal');
let upgrades = JSON.parse(localStorage.getItem('upgrades')) || { x2Prize:0, check1:0 };
let check1Expire = +localStorage.getItem('check1Expire') || 0;
let roundInProgress = false;

/* –º–∞–π–Ω–µ—Ä—ã (–¥–∞–Ω–Ω—ã–µ) */
const minersData = [
  { n:"Miner 1", i:500, p:7000 },
  { n:"Miner 2", i:1788, p:12000 },
  { n:"Miner 3", i:2358, p:15000 },
  { n:"Miner 4", i:3000, p:20000 },
  { n:"Miner 5", i:4500, p:25000 },
  { n:"Miner 6", i:5200, p:30000 },
  { n:"Miner 7", i:6100, p:35000 },
  { n:"Miner 8", i:7200, p:40000 },
  { n:"Miner 9", i:8500, p:45000 },
  { n:"Miner 10", i:9500, p:50000 }
];
let minersState = JSON.parse(localStorage.getItem('minersState')) || minersData.map(_=>({count:0}));

const miningIncomeValEl = document.getElementById('miningIncomeVal');
const minersContainerEl = document.querySelector('#miningShop .miners-container');
const miningShop = document.getElementById('miningShop');
const buyConfirm = document.getElementById('buyConfirm');
const buyText = document.getElementById('buyText');
let pendingMiner = null;

function format(n){
  return n>=1e9?(n/1e9).toFixed(1).replace(/\.0$/,'')+'B':n>=1e6?(n/1e6).toFixed(1).replace(/\.0$/,'')+'M':n>=1e3?(n/1e3).toFixed(1).replace(/\.0$/,'')+'K':String(n);
}

function save(){ localStorage.setItem('coins',coins); localStorage.setItem('maxCoins',maxCoins); localStorage.setItem('upgrades',JSON.stringify(upgrades)); localStorage.setItem('check1Expire',check1Expire); localStorage.setItem('minersState',JSON.stringify(minersState)); localStorage.setItem('lastTime',Date.now()); localStorage.setItem('lang',lang); }

function updCoins(v=0){
  coins += v; if(coins<0) coins=0; if(coins>maxCoins) maxCoins = coins;
  coinsVal.textContent = format(coins);
  updLv(); updUpg(); updIncome(); save();
}

/* –¥–æ—Ö–æ–¥: —Ñ–∞–∫—Ç–æ—Ä 1.5^(count-1) */
function getIncome(){ return minersState.reduce((sum,m,i)=> sum + (m.count>0? Math.floor(minersData[i].i * Math.pow(1.5, m.count-1)):0), 0); }
function updIncome(){ miningIncomeValEl.textContent = format(getIncome()); }

/* –æ—Ñ—Ñ–ª–∞–π–Ω ‚Äî –º–∞–∫—Å–∏–º—É–º 3 —á–∞—Å–∞ = 180 –º–∏–Ω—É—Ç */
function addOfflineCoins(){
  const last = +localStorage.getItem('lastTime') || Date.now();
  const now = Date.now();
  const diffMinutes = (now - last) / 60000;
  if(diffMinutes>0){
    const minutesToAward = Math.min(diffMinutes, 180);
    updCoins(Math.floor(getIncome()/60 * minutesToAward));
  }
  localStorage.setItem('lastTime', now);
}
addOfflineCoins();
setInterval(()=>{ updCoins(Math.floor(getIncome()/3600)); }, 1000);

/* —É—Ä–æ–≤–Ω–∏ / –∞–ø–≥—Ä–µ–π–¥—ã */
function updLv(){ document.querySelectorAll('.level').forEach(l=> l.classList.toggle('active', maxCoins >= +l.dataset.val)); }
function updUpg(){ document.querySelectorAll('.upgrade').forEach(u=>{ let key=u.dataset.key; let base=+u.dataset.basePrice; let count=upgrades[key]||0; let price = base * Math.pow(2,count); let priceEl=u.querySelector('.price'); if(priceEl) priceEl.textContent = format(price); }); }

document.querySelectorAll('.upgrade').forEach(u=>{
  u.onclick = ()=>{
    let key = u.dataset.key; let base = +u.dataset.basePrice; let count = upgrades[key]||0; let price = base * Math.pow(2,count);
    if(coins >= price){
      upgrades[key] = count+1;
      updCoins(-price);
      if(key === 'check1') check1Expire = Date.now() + 60000;
      save(); updUpg();
    } else alert(t('notEnough'));
  };
});

function updCheck(){
  const el = document.getElementById('check1Timer');
  if(check1Expire > Date.now()) el.textContent = '‚è≥ ' + Math.floor((check1Expire - Date.now())/1000) + 's';
  else el.textContent = '';
}
setInterval(updCheck, 1000);

/* –∫–æ–º–Ω–∞—Ç—ã */
document.querySelectorAll('.room').forEach(r=>{
  r.onclick = ()=>{
    if(roundInProgress) return;
    document.querySelectorAll('.room').forEach(x=>x.classList.remove('selected'));
    r.classList.add('selected');
    selectedRoom = +r.dataset.idx;
  };
});

/* START / RESET */
document.getElementById('startBtn').onclick = ()=>{
  if(selectedRoom==null){ alert(t('pickRoomFirst')); return; }
  document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe'));
};
document.getElementById('resetBtn').onclick = ()=>{
  if(selectedRoom==null){ alert(t('pickRoomFirst')); return; }
  roundInProgress = true;
  const numPicks = (check1Expire > Date.now()) ? 1 : 2;
  let picks = [...Array(8).keys()].sort(()=>0.5-Math.random()).slice(0,numPicks);
  document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe','highlight'));
  let delay = 0;
  picks.forEach(i=>{
    let room = document.querySelector(`.room[data-idx="${i}"]`);
    setTimeout(()=>{ room.classList.add('highlight'); }, delay);
    setTimeout(()=>{ room.classList.remove('highlight'); }, delay+600);
    delay += 700;
  });
  setTimeout(()=>{
    let prize = 1000, loss = -2000;
    if(upgrades.x2Prize > 0) { prize *= Math.pow(2, upgrades.x2Prize); loss *= Math.pow(2, upgrades.x2Prize); }
    if(picks.includes(selectedRoom)){
      const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
      room.classList.add('found'); updCoins(loss);
    } else {
      const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
      room.classList.add('safe'); updCoins(prize);
    }
    selectedRoom = null; document.querySelectorAll('.room').forEach(r=>r.classList.remove('selected'));
    roundInProgress = false;
  }, delay+700);
};

/* –†–µ–Ω–¥–µ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ –º–∞–π–Ω–µ—Ä–æ–≤ (–≤ –º–æ–¥–∞–ª–∫–µ). –ù–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ –º–∞–π–Ω–µ—Ä—ã –Ω–µ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è. */
function renderMiners(){
  if(!minersContainerEl) return;
  minersContainerEl.innerHTML = '';
  minersData.forEach((m,i)=>{
    const st = minersState[i];
    const price = m.p * Math.pow(2, st.count);
    const income = st.count > 0 ? Math.floor(m.i * Math.pow(1.5, st.count-1)) : 0;
    const card = document.createElement('div'); card.className = 'miner-card';
    card.innerHTML = `<img class="card-logo" src="logo.png" alt="logo" /><h3>${m.n}</h3><div class="income">${t('profitHr')} <span class="income-val">+${format(income)}</span></div><div class="bottom" style="width:100%;display:flex;justify-content:space-between;font-weight:700;font-size:13px;"><span>Lvl ${st.count}</span><span>${format(price)}</span></div>`;
    card.onclick = ()=>{
      if(coins >= price){
        pendingMiner = i; buyText.textContent = t('buyFor', { name: m.n, price: format(price) });
        buyConfirm.classList.add('show'); buyConfirm.style.display = 'block'; buyConfirm.setAttribute('aria-hidden','false');
      } else alert(t('notEnough'));
    };
    minersContainerEl.appendChild(card);
  });
}

/* –û—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω: –≤—ã–∑–æ–≤–µ—Ç—Å—è –∏ –ø–æ –∫–Ω–æ–ø–∫–µ –∫–æ—Ä–∑–∏–Ω—ã, –∏ –ø–æ –∫–∏—Ä–∫–µ */
function openShop(){
  miningShop.style.display = 'block';
  miningShop.setAttribute('aria-hidden','false');
  renderMiners();
}
document.getElementById('shopBtn').onclick = openShop;
document.getElementById('miningBtn').onclick = openShop;
document.getElementById('closeMiningShop').onclick = ()=>{
  miningShop.style.display = 'none';
  miningShop.setAttribute('aria-hidden','true');
};

/* –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–æ—Ç–º–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏ */
document.getElementById('confirmBuy').onclick = ()=>{
  if(pendingMiner===null) return;
  const i = pendingMiner; const m = minersData[i]; const st = minersState[i];
  const price = m.p * Math.pow(2, st.count);
  if(coins >= price){
    coins -= price; st.count++; updCoins(0); save(); renderMiners();
  } else alert(t('notEnough'));
  pendingMiner = null;
  buyConfirm.classList.remove('show'); buyConfirm.style.display = 'none'; buyConfirm.setAttribute('aria-hidden','true');
};
document.getElementById('cancelBuy').onclick = ()=>{
  pendingMiner = null;
  buyConfirm.classList.remove('show'); buyConfirm.style.display = 'none'; buyConfirm.setAttribute('aria-hidden','true');
};

/* Profile (full-screen opaque background) */
const profileWindowEl = document.getElementById('profileWindow');
document.getElementById('profileBtn').onclick = ()=>{
  profileWindowEl.classList.add('full');
  profileWindowEl.style.display = 'block';
  profileWindowEl.setAttribute('aria-hidden','false');
};
document.getElementById('closeProfile').onclick = ()=>{
  profileWindowEl.classList.remove('full');
  profileWindowEl.style.display = 'none';
  profileWindowEl.setAttribute('aria-hidden','true');
};

/* Info window ‚Äî full-screen opaque background */
document.getElementById('infoBtn').onclick = ()=>{
  const win = document.getElementById('infoWindow');
  win.classList.add('full');
  win.style.display = 'block';
  win.setAttribute('aria-hidden','false');
};
document.getElementById('closeInfo').onclick = ()=>{
  const win = document.getElementById('infoWindow');
  win.classList.remove('full');
  win.style.display = 'none';
  win.setAttribute('aria-hidden','true');
};

/* Daily & Quest */
let questClaimed = localStorage.getItem('questClaimed') === 'true';
let lastDaily = +localStorage.getItem('lastDaily') || 0;
const questStatusEl = document.getElementById('questStatus');
const dailyStatusEl = document.getElementById('dailyStatus');

function updateQuestStatus(){ if(questStatusEl) questStatusEl.textContent = questClaimed? "‚úÖ Completed":"‚ùå Not claimed"; }
function updateDailyStatus(){
  if(!dailyStatusEl) return;
  const now = Date.now(); const nextAvailable = lastDaily + 24*60*60*1000;
  if(now >= nextAvailable) dailyStatusEl.textContent = "üí∞ Available!";
  else {
    const diff = nextAvailable - now;
    const hours = Math.floor(diff / (1000*60*60));
    const minutes = Math.floor((diff % (1000*60*60)) / (1000*60));
    dailyStatusEl.textContent = `Next in ${hours}h ${minutes}m`;
  }
}
setInterval(updateDailyStatus, 60000);
updateDailyStatus(); updateQuestStatus();

document.getElementById('claimQuest').onclick = ()=>{
  if(questClaimed) alert(t('questAlready'));
  else { updCoins(50000); questClaimed = true; localStorage.setItem('questClaimed','true'); updateQuestStatus(); }
};
document.getElementById('claimDaily').onclick = ()=>{
  const now = Date.now();
  if(now - lastDaily < 24*60*60*1000) alert(t('dailyAlready'));
  else { updCoins(30000); lastDaily = now; localStorage.setItem('lastDaily', now); updateDailyStatus(); }
};

/* Language selector */
const langSelect = document.getElementById('langSelect');
if(langSelect){ langSelect.value = lang; langSelect.onchange = ()=>{ lang = langSelect.value; localStorage.setItem('lang', lang); applyLang(); renderMiners(); }; }

coinsVal.textContent = format(coins);
updLv(); updUpg(); updIncome(); updCheck(); applyLang();
/* ensure hidden on load */
document.getElementById('infoWindow').style.display='none';
document.getElementById('profileWindow').style.display='none';
buyConfirm.style.display='none';
</script>
</body>
</html>
