<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hide &amp; Seek ‚Äî Premium Emoji (Updated)</title>
  <style>
:root{   --accent-cyan: #00D8FF;   --birch: #EDE4C8;   --purple-frame: #7a4bff;   --deep-purple: #5a2ecc;   --glass: rgba(255,255,255,0.06); }
/* –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */ html,body{height:100%;margin:0;padding:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);background-size:200% 200%;animation:gradientBG 15s ease infinite;color:#fff;overflow:hidden} @keyframes gradientBG{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}} body{display:flex;flex-direction:column;align-items:center;min-height:100vh} /* Header */ header{width:95%;margin:15px 0;display:flex;justify-content:space-between;align-items:center;background:rgba(0,0,0,0.28);border-radius:12px;padding:10px;backdrop-filter:blur(5px)} .level-bar{display:flex;gap:6px;background:rgba(0,0,0,0.2);padding:6px 10px;border-radius:12px;flex:1;justify-content:space-between} .level{flex:1;text-align:center;padding:6px 0;font-size:14px;font-weight:700;color:#eee;border-radius:8px;background:rgba(255,255,255,0.06);transition:.25s;cursor:pointer} .level.active{background:var(--accent-cyan);color:#000;box-shadow:0 0 8px var(--accent-cyan)} .coin-panel{display:flex;align-items:center;gap:10px;background:rgba(0,0,0,0.28);padding:8px 12px;border-radius:16px;box-shadow:0 0 12px rgba(0,216,255,0.18)} .coin-logo{width:40px;height:40px;border-radius:50%;object-fit:cover;border:3px solid var(--purple-frame);box-shadow:0 6px 18px rgba(122,75,255,0.18);background:#fff} .coin-panel .val{font-weight:700;font-size:18px;color:var(--accent-cyan)} /* –î–æ–º: —Å–µ—Ç–∫–∞ –∫–æ–º–Ω–∞—Ç */ .house{position:relative;width:95%;max-width:500px;margin:20px 0;display:grid;grid-template-columns:repeat(2,1fr);grid-template-rows:repeat(4,1fr);gap:12px} .room{background:rgba(255,255,255,0.06);border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:28px;color:#fff;cursor:pointer;transition:transform .3s,box-shadow .3s;position:relative;border:2px solid rgba(255,255,255,0.14)} .room:hover{transform:scale(1.05);box-shadow:0 0 18px rgba(0,216,255,0.14)} .room.selected{border-color:var(--accent-cyan);box-shadow:0 0 12px var(--accent-cyan)} .room.found{border-color:#FF0054;box-shadow:0 0 12px #FF0054;animation:foundAnim 1s ease} .room.safe{border-color:#39FF14;box-shadow:0 0 12px #39FF14;animation:safeAnim .8s ease} .room.highlight{box-shadow:0 0 22px 4px var(--accent-cyan);transition:box-shadow .3s} @keyframes foundAnim{0%{transform:scale(1)}50%{transform:rotate(10deg) scale(1.15)}100%{transform:scale(1)}} @keyframes safeAnim{0%{transform:scale(1)}50%{transform:rotate(-10deg) scale(0.95)}100%{transform:scale(1)}} /* –ö–æ–Ω—Ç—Ä–æ–ª—ã */ .controls{width:90%;display:flex;justify-content:space-between;margin-bottom:15px} button{flex:1;margin:0 5px;padding:14px;font-size:20px;border:none;border-radius:12px;cursor:pointer;color:#000;background:var(--accent-cyan);box-shadow:0 4px 12px rgba(0,216,255,0.25);transition:transform .2s,box-shadow .2s} button:active{transform:scale(.98);box-shadow:0 2px 6px rgba(0,216,255,0.18)} button.secondary{background:rgba(0,0,0,0.36);color:#fff;border:1px solid rgba(255,255,255,0.06);box-shadow:0 3px 8px rgba(0,216,255,0.12)} /* –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é */ .bottom-menu{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);width:90%;max-width:480px;display:flex;justify-content:space-around;gap:8px;background:rgba(0,0,0,0.28);padding:6px 0;border-radius:16px;backdrop-filter:blur(5px);box-shadow:0 0 12px rgba(0,216,255,0.18)} .bottom-menu button{background:transparent;color:#fff;font-size:22px;transition:transform .2s} .bottom-menu button:hover{transform:scale(1.16);color:var(--accent-cyan)} /* –ê–ø–≥—Ä–µ–π–¥—ã */ .upgrade-panel{display:flex;gap:12px;margin:10px 0;overflow-x:auto;padding:12px 10px;width:95%;justify-content:flex-start;align-items:stretch} .upgrade{flex:0 0 auto;background:linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));padding:16px;border-radius:16px;text-align:left;min-width:220px;cursor:pointer;box-shadow:0 8px 24px rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.06);transition:transform .18s,box-shadow .18s} .upgrade:hover{transform:translateY(-6px)} .upgrade h3{margin:0 0 8px;font-size:16px;color:var(--accent-cyan)} .upgrade p{margin:0;font-size:14px;color:#eee} .upgrade .price{margin-top:10px;font-weight:800;color:var(--birch);font-size:16px} .upgrade .badge{display:inline-block;margin-top:8px;padding:6px 8px;border-radius:999px;background:rgba(0,0,0,0.18);font-weight:700;color:#fff;font-size:12px} .upgrade .timer{margin-top:8px;font-weight:700;color:#fff;font-size:14px;text-align:center} /* Mining info */ .mining-info{margin:10px 0;padding:10px 12px;background:rgba(255,255,255,0.04);border-radius:14px;width:95%;text-align:center;box-shadow:0 2px 6px rgba(0,216,255,0.06)} /* Premium Listing Modal */ #miningShop{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:800;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);color:#fff;padding:28px;box-sizing:border-box;overflow-y:auto} #miningShop .content-center{max-width:480px;margin:0 auto;text-align:center} #miningShop .btnPrimary{margin-top:20px;padding:12px 18px;border-radius:12px;font-weight:900;border:none;cursor:pointer;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;box-shadow:0 12px 36px rgba(0,216,255,0.18);} /* –°–∫—Ä—ã—Ç–∞—è –ø–∞–Ω–µ–ª—å –º–∞–π–Ω–µ—Ä–æ–≤ */ .miners-panel{display:none;width:95%;max-width:900px;gap:12px;padding:10px;overflow-x:auto;align-items:flex-start;margin-bottom:12px;background:transparent;border-radius:12px} /* Info & Profile */ #infoWindow, #profileWindow{display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:700;background:linear-gradient(120deg,#3b2a7a,#8aa7ff);color:#fff;padding:28px;box-sizing:border-box;overflow-y:auto} #infoWindow .content, #profileWindow .content{max-width:1100px;margin:24px auto;border-radius:16px;padding:18px;background:rgba(0,0,0,0.22);color:#fff;box-shadow:0 10px 30px rgba(0,0,0,0.28);border:1px solid rgba(255,255,255,0.04)} #infoWindow h2, #profileWindow h2{color:#ecf8ff;margin-bottom:10px} #infoWindow ul{color:#eaf2ff;padding-left:20px} #infoWindow ul li::before{content:'‚Ä¢ ';color:var(--accent-cyan);font-weight:600} #infoWindow button, #profileWindow button{width:100%;margin-top:12px;padding:12px;font-size:18px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700} .settings-card{margin-top:12px;padding:12px;background:rgba(255,255,255,0.03);border-radius:12px;border:1px solid rgba(255,255,255,0.03)} .settings-row{display:flex;align-items:center;justify-content:space-between;gap:12px} .select-lang{padding:8px 10px;border-radius:8px;border:none;font-weight:700} @media (max-width:520px){   .coin-logo{width:34px;height:34px;border-width:2px}   button{font-size:18px;padding:12px}   .upgrade{min-width:160px}   #wsModalOverlay .title{font-size:18px} }
  </style>
</head>
<body>
  <header>
    <div class="level-bar">
      <div class="level" data-val="10000">10K</div>
      <div class="level" data-val="100000">100K</div>
      <div class="level" data-val="1000000">1M</div>
      <div class="level" data-val="5000000">5M</div>
    </div>
    <div class="coin-panel">
      <img class="coin-logo" src="logo.png" alt="Coin logo" />
      <div class="val" id="coinsVal">0</div>
    </div>
  </header>

  <div class="house"></div>

  <div class="controls">
    <button id="startBtn">üè†</button>
    <button class="secondary" id="resetBtn">üîç</button>
  </div>

  <!-- –ê–ø–≥—Ä–µ–π–¥—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ -->
  <div class="upgrade-panel" id="upgradePanel">
    <div class="upgrade" data-key="x2Prize" data-base-price="20000">
      <h3>x2 Prize / x2 Loss</h3>
      <p>Double rewards &amp; penalties</p>
      <div class="price">20,000</div>
      <div class="badge">Boost</div>
    </div>
    <div class="upgrade" data-key="check1" data-base-price="20000">
      <h3>Check 1 Room Only</h3>
      <p>Hunter checks 1 room only (1 min)</p>
      <div class="price">20,000</div>
      <div class="timer" id="check1Timer"></div>
    </div>
    <!-- –ù–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–¥–µ–π—Å—Ç–≤—É—é—Ç 1 –º–∏–Ω—É—Ç—É) -->
    <div class="upgrade" data-key="safeShield" data-base-price="15000">
      <h3>Safe Shield</h3>
      <p>Your room is safe (1 min)</p>
      <div class="price">15,000</div>
      <div class="timer" id="shieldTimer"></div>
    </div>
    <div class="upgrade" data-key="doubleCoins" data-base-price="25000">
      <h3>x2 Earn</h3>
      <p>Double coin reward (1 min)</p>
      <div class="price">25,000</div>
      <div class="timer" id="doubleCoinsTimer"></div>
    </div>
    <div class="upgrade" data-key="stealthMode" data-base-price="30000">
      <h3>Stealth Mode</h3>
      <p>Hunters skip you (1 min)</p>
      <div class="price">30,000</div>
      <div class="timer" id="stealthModeTimer"></div>
    </div>
  </div>

  <div class="mining-info">
    <strong id="miningLabel">Mining Income:</strong> <span id="miningIncomeVal">0</span>/hr
  </div>

  <!-- –ü–∞–Ω–µ–ª—å –º–∞–π–Ω–µ—Ä–æ–≤ —Å–∫—Ä—ã—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ -->
  <div class="miners-panel" id="minersPanelVisible" aria-hidden="true"></div>

  <!-- Premium listing modal (–ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É —Ç–µ–ª–µ–∂–∫–∏) -->
  <div id="miningShop" aria-hidden="true">
    <div class="content-center">
      <img src="logo.png" alt="Premium Logo" style="width:100px;height:100px;border-radius:50%;margin-top:20px;" />
      <h2 style="margin-top:20px;">Listing Countdown</h2>
      <div id="listingCountdown" style="font-size:24px;margin:20px 0;">Loading...</div>
      <p style="margin-top:10px;color:#eee;">Our project will be listed soon. Listing is when our token becomes available on exchanges.</p>
      <button id="closeMiningShop" class="btnPrimary">Close</button>
    </div>
  </div>

  <!-- Buy confirmation -->
  <div id="buyConfirm" aria-hidden="true">
    <div class="confirm-box">
      <p id="buyText"></p>
      <div style="display:flex;justify-content:center;">
        <button id="confirmBuy">Buy</button>
        <button id="cancelBuy">Cancel</button>
      </div>
    </div>
  </div>

  <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ –æ–∫–Ω–æ -->
  <div id="infoWindow" aria-hidden="true">
    <div class="content">
      <h2 id="infoTitle">How to Play</h2>
      <ul id="infoList">
        <li>Select a room and then click the üîç button to hunt.</li>
        <li>The hunter searches 2 random rooms (1 if "Check 1 Room" is active).</li>
        <li>If your room is found, you lose coins (shown in red).</li>
        <li>If you evade the hunt, you gain coins (shown in green).</li>
        <li>Buy upgrades or miners to improve your chances and income.</li>
        <li>Claim daily rewards and complete quests for bonus coins.</li>
      </ul>
      <button id="closeInfo">Close</button>
    </div>
  </div>

  <!-- –û–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
  <div id="profileWindow" aria-hidden="true">
    <div class="content">
      <h2 id="profileTitle">Profile</h2>

      <div style="margin-bottom:16px;padding:16px;background:rgba(0,0,0,0.06);border-radius:12px;">
        <h3 id="dailyTitle" style="margin-bottom:8px;font-size:18px;color:#ecf8ff">Daily Reward</h3>
        <p id="dailyText" style="margin-bottom:12px;color:#fff">Get 30,000 coins once a day!</p>
        <button id="claimDaily" style="width:100%;padding:12px;font-size:16px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Claim Daily</button>
        <p id="dailyStatus" style="margin-top:8px;color:var(--birch);font-weight:600;text-align:center;"></p>
      </div>

      <div style="margin-bottom:16px;padding:16px;background:rgba(0,0,0,0.06);border-radius:12px;">
        <h3 id="questTitle" style="margin-bottom:8px;font-size:18px;color:#ecf8ff">Quest</h3>
        <p id="questText" style="margin-bottom:12px;color:#fff">Subscribe to get bonus coins!</p>
        <button id="claimQuest" style="width:100%;padding:12px;font-size:16px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Claim Quest</button>
        <p id="questStatus" style="margin-top:8px;color:var(--birch);font-weight:600;text-align:center;"></p>
      </div>

      <div class="settings-card">
        <div class="settings-row">
          <div>
            <h3 id="settingsTitle">Settings</h3>
            <p id="settingsText">Change language and other preferences.</p>
          </div>
          <div>
            <select id="langSelect" class="select-lang">
              <option value="ru">–†—É—Å—Å–∫–∏–π</option>
              <option value="en">English</option>
            </select>
          </div>
        </div>
      </div>

      <button id="closeProfile" style="width:100%;padding:14px;font-size:18px;border:none;border-radius:12px;background:linear-gradient(90deg,var(--accent-cyan),#00A8FF);color:#000;cursor:pointer;font-weight:700;">Close</button>
    </div>
  </div>

  <div class="bottom-menu">
    <button id="infoBtn" class="secondary">‚Ñπ</button>
    <button id="shopBtn" class="secondary">üõí</button>
    <button id="miningBtn" class="secondary">‚õè</button>
    <button id="profileBtn" class="secondary">üë§</button>
  </div>

  <script>
  /* –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è */
  const i18n = {
    ru: {
      pickRoomFirst: '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É!',
      notEnough: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!',
      dailyAlready: '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ —É–∂–µ –ø–æ–ª—É—á–µ–Ω–∞!',
      questAlready: '–ö–≤–µ—Å—Ç —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω!',
      miningIncome: '–î–æ—Ö–æ–¥ –º–∞–π–Ω–∏–Ω–≥–∞:',
      miningShop: '–ú–∞–≥–∞–∑–∏–Ω –º–∞–π–Ω–∏–Ω–≥–∞',
      close: '–ó–∞–∫—Ä—ã—Ç—å',
      howToPlay: '–ö–∞–∫ –∏–≥—Ä–∞—Ç—å',
      infoList: [
        '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–Ω–∞—Ç—É, –∑–∞—Ç–µ–º –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É üîç –¥–ª—è –æ—Ö–æ—Ç—ã.',
        '–û—Ö–æ—Ç–Ω–∏–∫ –∏—â–µ—Ç 2 —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã (1, –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω "Check 1 Room").',
        '–ï—Å–ª–∏ –≤–∞—à—É –∫–æ–º–Ω–∞—Ç—É –Ω–∞—à–ª–∏, –≤—ã —Ç–µ—Ä—è–µ—Ç–µ –º–æ–Ω–µ—Ç—ã (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∫—Ä–∞—Å–Ω—ã–º).',
        '–ï—Å–ª–∏ –≤—ã –∏–∑–±–µ–∂–∞–ª–∏ –æ—Ö–æ—Ç—ã, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –º–æ–Ω–µ—Ç—ã (–ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∑–µ–ª–µ–Ω—ã–º).',
        '–ü–æ–∫—É–ø–∞–π—Ç–µ –∞–ø–≥—Ä–µ–π–¥—ã –∏–ª–∏ –º–∞–π–Ω–µ—Ä–æ–≤, —á—Ç–æ–±—ã —É–ª—É—á—à–∏—Ç—å —à–∞–Ω—Å—ã –∏ –¥–æ—Ö–æ–¥.',
        '–ó–∞–±–∏—Ä–∞–π—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞–≥—Ä–∞–¥—ã –∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∫–≤–µ—Å—Ç—ã –¥–ª—è –±–æ–Ω—É—Å–Ω—ã—Ö –º–æ–Ω–µ—Ç.'
      ],
      profile: '–ü—Ä–æ—Ñ–∏–ª—å',
      dailyReward: '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞',
      dailyText: '–ü–æ–ª—É—á–∏—Ç–µ 30 000 –º–æ–Ω–µ—Ç —Ä–∞–∑ –≤ –¥–µ–Ω—å!',
      claimDaily: '–ó–∞–±—Ä–∞—Ç—å',
      quest: '–ö–≤–µ—Å—Ç',
      claimQuest: '–í–∑—è—Ç—å',
      settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',
      settingsText: '–°–º–µ–Ω–∏—Ç–µ —è–∑—ã–∫ –∏ –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.',
      buyFor: '–ö—É–ø–∏—Ç—å {name} –∑–∞ {price}?',
      buy: '–ö—É–ø–∏—Ç—å',
      cancel: '–û—Ç–º–µ–Ω–∞',
      profitHr: '–ü—Ä–∏–±—ã–ª—å/—á:'
    },
    en: {
      pickRoomFirst: 'Pick a room first!',
      notEnough: 'Not enough coins!',
      dailyAlready: 'Daily reward already claimed!',
      questAlready: 'Quest already claimed!',
      miningIncome: 'Mining Income:',
      miningShop: 'Mining Shop',
      close: 'Close',
      howToPlay: 'How to Play',
      infoList: [
        'Select a room and then click the üîç button to hunt.',
        'The hunter searches 2 random rooms (1 if "Check 1 Room" is active).',
        'If your room is found, you lose coins (shown in red).',
        'If you evade the hunt, you gain coins (shown in green).',
        'Buy upgrades or miners to improve your chances and income.',
        'Claim daily rewards and complete quests for bonus coins.'
      ],
      profile: 'Profile',
      dailyReward: 'Daily Reward',
      dailyText: 'Get 30,000 coins once a day!',
      claimDaily: 'Claim Daily',
      quest: 'Quest',
      claimQuest: 'Claim Quest',
      settings: 'Settings',
      settingsText: 'Change language and other preferences.',
      buyFor: 'Buy {name} for {price}?',
      buy: 'Buy',
      cancel: 'Cancel',
      profitHr: 'Profit/hr:'
    }
  };
  let lang = localStorage.getItem('lang') || 'ru';
  function t(key, vars = {}) {
    const val = i18n[lang][key];
    if (typeof val === 'string') {
      return val.replace(/\\{(\\w+)\\}/g, (_, k) => vars[k] || '');
    }
    return val;
  }
  function applyLang() {
    document.getElementById('miningLabel').textContent = t('miningIncome');
    document.getElementById('infoTitle').textContent = t('howToPlay');
    document.getElementById('profileTitle').textContent = t('profile');
    document.getElementById('dailyTitle').textContent = t('dailyReward');
    document.getElementById('dailyText').textContent = t('dailyText');
    document.getElementById('claimDaily').textContent = t('claimDaily');
    document.getElementById('questTitle').textContent = t('quest');
    document.getElementById('claimQuest').textContent = t('claimQuest');
    document.getElementById('settingsTitle').textContent = t('settings');
    document.getElementById('settingsText').textContent = t('settingsText');
    document.getElementById('closeInfo').textContent = t('close');
    document.getElementById('closeProfile').textContent = t('close');
    const infoListEl = document.getElementById('infoList');
    infoListEl.innerHTML = '';
    t('infoList').forEach(li => { const el = document.createElement('li'); el.textContent = li; infoListEl.appendChild(el); });
  }

  /* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è */
  const roomsContainer = document.querySelector('.house');
  for (let i = 0; i < 8; i++) {
    const d = document.createElement('div');
    d.className = 'room';
    d.dataset.idx = i;
    d.textContent = '+';
    roomsContainer.appendChild(d);
  }
  let selectedRoom = null;
  let coins = +localStorage.getItem('coins') || 0;
  let maxCoins = +localStorage.getItem('maxCoins') || coins;
  const coinsVal = document.getElementById('coinsVal');
  // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ –∞–ø–≥—Ä–µ–π–¥–æ–≤ —Å –Ω–æ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏
  let upgrades = JSON.parse(localStorage.getItem('upgrades')) || { x2Prize: 0, check1: 0, safeShield: 0, doubleCoins: 0, stealthMode: 0 };
  let check1Expire = +localStorage.getItem('check1Expire') || 0;
  let safeShieldExpire = +localStorage.getItem('safeShieldExpire') || 0;
  let doubleCoinsExpire = +localStorage.getItem('doubleCoinsExpire') || 0;
  let stealthModeExpire = +localStorage.getItem('stealthModeExpire') || 0;
  let roundInProgress = false;
  // –º–∞–π–Ω–µ—Ä—ã
  const minersData = [
    { n: "Miner 1", i: 500, p: 7000 },
    { n: "Miner 2", i: 1788, p: 12000 },
    { n: "Miner 3", i: 2358, p: 15000 },
    { n: "Miner 4", i: 3000, p: 20000 },
    { n: "Miner 5", i: 4500, p: 25000 },
    { n: "Miner 6", i: 5200, p: 30000 },
    { n: "Miner 7", i: 6100, p: 35000 },
    { n: "Miner 8", i: 7200, p: 40000 },
    { n: "Miner 9", i: 8500, p: 45000 },
    { n: "Miner 10", i: 9500, p: 50000 }
  ];
  let minersState;
  try {
    const saved = JSON.parse(localStorage.getItem('minersState'));
    if (Array.isArray(saved)) {
      minersState = minersData.map((_, i) => {
        const s = saved[i];
        if (s && typeof s.count === 'number') return { count: s.count };
        return { count: 0 };
      });
    } else {
      minersState = minersData.map(_ => ({ count: 0 }));
    }
  } catch (e) {
    minersState = minersData.map(_ => ({ count: 0 }));
  }
  const miningIncomeValEl = document.getElementById('miningIncomeVal');
  const minersContainerEl = document.querySelector('.miners-container');
  const minersPanelVisible = document.getElementById('minersPanelVisible');
  const miningShop = document.getElementById('miningShop');
  const buyConfirm = document.getElementById('buyConfirm');
  const buyText = document.getElementById('buyText');
  let pendingMiner = null;

  function format(n) {
    return n >= 1e9 ? (n/1e9).toFixed(1).replace(/\\.0$/,'') + 'B' :
           n >= 1e6 ? (n/1e6).toFixed(1).replace(/\\.0$/,'') + 'M' :
           n >= 1e3 ? (n/1e3).toFixed(1).replace(/\\.0$/,'') + 'K' : String(n);
  }
  function save() {
    try {
      localStorage.setItem('coins', coins);
      localStorage.setItem('maxCoins', maxCoins);
      localStorage.setItem('upgrades', JSON.stringify(upgrades));
      localStorage.setItem('check1Expire', check1Expire);
      localStorage.setItem('safeShieldExpire', safeShieldExpire);
      localStorage.setItem('doubleCoinsExpire', doubleCoinsExpire);
      localStorage.setItem('stealthModeExpire', stealthModeExpire);
      localStorage.setItem('minersState', JSON.stringify(minersState));
      localStorage.setItem('lastTime', Date.now());
      localStorage.setItem('lang', lang);
    } catch (e) {
      console.warn('Save failed', e);
    }
  }
  function updCoins(v = 0) {
    coins += v;
    if (coins < 0) coins = 0;
    if (coins > maxCoins) maxCoins = coins;
    coinsVal.textContent = format(coins);
    updLv();
    updUpg();
    updIncome();
    save();
  }
  function getIncome() {
    return minersState.reduce((sum, m, i) => {
      const count = (m && typeof m.count === 'number') ? m.count : 0;
      return sum + (count > 0 ? Math.floor(minersData[i].i * Math.pow(1.5, count - 1)) : 0);
    }, 0);
  }
  function updIncome() { miningIncomeValEl.textContent = format(getIncome()); }

  function addOfflineCoins() {
    const last = +localStorage.getItem('lastTime') || Date.now();
    const now = Date.now();
    const diffMinutes = (now - last) / 60000;
    if (diffMinutes > 0) {
      const minutesToAward = Math.min(diffMinutes, 180);
      updCoins(Math.floor(getIncome()/60 * minutesToAward));
    }
    localStorage.setItem('lastTime', now);
  }
  addOfflineCoins();
  setInterval(()=>{ updCoins(Math.floor(getIncome()/3600)); }, 1000);

  function updLv() { document.querySelectorAll('.level').forEach(l => l.classList.toggle('active', maxCoins >= +l.dataset.val)); }
  function updUpg() {
    document.querySelectorAll('.upgrade').forEach(u => {
      let key = u.dataset.key;
      let base = +u.dataset.basePrice;
      let count = upgrades[key] || 0;
      let price = base * Math.pow(2, count);
      let priceEl = u.querySelector('.price');
      if (priceEl) priceEl.textContent = format(price);
      const badge = u.querySelector('.badge');
      if (badge) badge.textContent = count > 0 ? `Lvl ${count}` : 'New';
    });
  }

  /* –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π */
  function updTimers() {
    const now = Date.now();
    const shieldEl = document.getElementById('shieldTimer');
    const doubleEl = document.getElementById('doubleCoinsTimer');
    const stealthEl = document.getElementById('stealthModeTimer');
    shieldEl.textContent = safeShieldExpire > now ? '‚è≥ ' + Math.floor((safeShieldExpire - now)/1000) + 's' : '';
    doubleEl.textContent = doubleCoinsExpire > now ? '‚è≥ ' + Math.floor((doubleCoinsExpire - now)/1000) + 's' : '';
    stealthEl.textContent = stealthModeExpire > now ? '‚è≥ ' + Math.floor((stealthModeExpire - now)/1000) + 's' : '';
  }
  setInterval(updTimers, 1000);

  /* –ö–ª–∏–∫–∏ –ø–æ –∞–ø–≥—Ä–µ–π–¥–∞–º */
  document.querySelectorAll('.upgrade').forEach(u=>{
    u.onclick = ()=>{
      let key = u.dataset.key; let base = +u.dataset.basePrice; let count = upgrades[key]||0;
      let price = base * Math.pow(2, count);
      if (coins >= price) {
        upgrades[key] = count+1; updCoins(-price);
        if (key === 'check1') check1Expire = Date.now()+60000;
        if (key === 'safeShield') safeShieldExpire = Date.now()+60000;
        if (key === 'doubleCoins') doubleCoinsExpire = Date.now()+60000;
        if (key === 'stealthMode') stealthModeExpire = Date.now()+60000;
        save(); updUpg();
      } else alert(t('notEnough'));
    };
  });

  /* –¢–∞–π–º–µ—Ä –¥–ª—è check1 */
  function updCheck() {
    const el = document.getElementById('check1Timer');
    const now = Date.now();
    if (check1Expire > now) el.textContent = '‚è≥ ' + Math.floor((check1Expire - now)/1000) + 's';
    else el.textContent = '';
  }
  setInterval(updCheck, 1000);

  /* –í—ã–±–æ—Ä –∫–æ–º–Ω–∞—Ç—ã */
  document.querySelectorAll('.room').forEach(r => {
    r.onclick = () => {
      if (roundInProgress) return;
      document.querySelectorAll('.room').forEach(x=>x.classList.remove('selected'));
      r.classList.add('selected');
      selectedRoom = +r.dataset.idx;
    };
  });

  /* –°—Ç–∞—Ä—Ç–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ */
  document.getElementById('startBtn').onclick = ()=>{
    if (selectedRoom == null) { alert(t('pickRoomFirst')); return; }
    document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe'));
  };

  /* Reset / –æ—Ö–æ—Ç–∞ */
  document.getElementById('resetBtn').onclick = ()=>{
    if (selectedRoom == null) { alert(t('pickRoomFirst')); return; }
    roundInProgress = true;
    const now = Date.now();
    const shieldActive = safeShieldExpire > now;
    const doubleActive = doubleCoinsExpire > now;
    const stealthActive = stealthModeExpire > now;
    const numPicks = (check1Expire > now) ? 1 : 2;
    let picks = [];
    let delay = 0;

    /* –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∏–∫–æ–≤ */
    if (!stealthActive) {
      picks = [...Array(8).keys()].sort(()=>0.5-Math.random()).slice(0,numPicks);
      document.querySelectorAll('.room').forEach(r=>r.classList.remove('found','safe','highlight'));
      picks.forEach(i=>{
        let room = document.querySelector(`.room[data-idx="${i}"]`);
        setTimeout(()=>{ room.classList.add('highlight'); }, delay);
        setTimeout(()=>{ room.classList.remove('highlight'); }, delay+600);
        delay += 700;
      });
    }

    setTimeout(()=>{
      let prize = 1000, loss = -2000;
      if (upgrades.x2Prize > 0) { prize *= Math.pow(2, upgrades.x2Prize); loss *= Math.pow(2, upgrades.x2Prize); }
      if (doubleActive) prize *= 2;

      if (stealthActive) {
        /* Stealth Mode: –≤—Å–µ–≥–¥–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ */
        const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
        room.classList.add('safe');
        updCoins(prize);
      } else if (picks.includes(selectedRoom)) {
        /* –ö–æ–º–Ω–∞—Ç–∞ –Ω–∞–π–¥–µ–Ω–∞ */
        if (shieldActive) {
          /* Safe Shield: –ø—Ä–µ–≤—Ä–∞—â–∞–µ–º –≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π */
          const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
          room.classList.add('safe');
          updCoins(prize);
        } else {
          /* –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —à—Ç—Ä–∞—Ñ */
          const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
          room.classList.add('found');
          updCoins(loss);
        }
      } else {
        /* –ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ */
        const room = document.querySelector(`.room[data-idx="${selectedRoom}"]`);
        room.classList.add('safe');
        updCoins(prize);
      }

      selectedRoom = null;
      document.querySelectorAll('.room').forEach(r=>r.classList.remove('selected'));
      roundInProgress = false;
    }, delay + 700);
  };

  /* Miner cards (—Ç–æ–ª—å–∫–æ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å) */
  function renderMiners(){
    if (!minersContainerEl) return;
    minersContainerEl.innerHTML = '';
    minersData.forEach((m,i)=>{
      const st = (minersState[i] && typeof minersState[i].count === 'number') ? minersState[i] : { count: 0 };
      const price = m.p * Math.pow(2, st.count);
      const income = st.count > 0 ? Math.floor(m.i * Math.pow(1.5, st.count - 1)) : 0;
      const card = document.createElement('div'); card.className = 'miner-card';
      card.innerHTML = `
        <img class="card-logo" src="logo.png" alt="logo" />
        <h3>${m.n}</h3>
        <div class="income">+${format(income)} / hr</div>
        <div class="bottom">
          <span class="lvl">Lvl ${st.count}</span>
          <span class="price-pill">${format(price)}</span>
        </div>
      `;
      card.onclick = ()=>{
        const currentSt = (minersState[i] && typeof minersState[i].count === 'number') ? minersState[i] : { count: 0 };
        const currentPrice = m.p * Math.pow(2, currentSt.count);
        if (coins >= currentPrice) {
          pendingMiner = i;
          buyText.textContent = t('buyFor', { name: m.n, price: format(currentPrice) });
          buyConfirm.classList.add('show'); buyConfirm.style.display = 'block'; buyConfirm.setAttribute('aria-hidden','false');
        } else { alert(t('notEnough')); }
      };
      minersContainerEl.appendChild(card);
    });
  }

  /* –ö–Ω–æ–ø–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –º–∞–≥–∞–∑–∏–Ω–∞ –º–∞–π–Ω–µ—Ä–æ–≤ –∏ –ø—Ä–µ–º–∏—É–º (—Ç–µ–ø–µ—Ä—å shopBtn –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –æ–∫–Ω–æ —Å –ª–∏—Å—Ç–∏–Ω–≥–æ–º) */
  const miningBtn = document.getElementById('miningBtn');
  const shopBtn = document.getElementById('shopBtn');
  miningBtn.onclick = () => { /* –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–∞–π–Ω–µ—Ä–æ–≤ –∏–ª–∏ —É–±—Ä–∞—Ç—å */ };
  shopBtn.onclick = () => { 
    updateListingCountdown();
    document.getElementById('miningShop').style.display = 'block';
    document.getElementById('miningShop').setAttribute('aria-hidden','false');
  };
  document.getElementById('closeMiningShop').onclick = ()=>{ 
    document.getElementById('miningShop').style.display = 'none'; 
    document.getElementById('miningShop').setAttribute('aria-hidden','true');
  };

  /* Buy confirm actions */
  document.getElementById('confirmBuy').onclick = ()=>{
    if (pendingMiner === null) return;
    const i = pendingMiner; const m = minersData[i]; const st = minersState[i] || { count: 0 };
    const price = m.p * Math.pow(2, st.count);
    if (coins >= price) {
      coins -= price; minersState[i] = { count: (st.count || 0) + 1 }; updCoins(0); save(); renderMiners();
    } else alert(t('notEnough'));
    pendingMiner = null;
    buyConfirm.classList.remove('show'); buyConfirm.style.display = 'none'; buyConfirm.setAttribute('aria-hidden','true');
  };
  document.getElementById('cancelBuy').onclick = ()=>{ pendingMiner = null; buyConfirm.classList.remove('show'); buyConfirm.style.display = 'none'; buyConfirm.setAttribute('aria-hidden','true'); };

  /* Profile window */
  const profileWindowEl = document.getElementById('profileWindow');
  document.getElementById('profileBtn').onclick = ()=>{ profileWindowEl.style.display = 'block'; profileWindowEl.setAttribute('aria-hidden','false'); };
  document.getElementById('closeProfile').onclick = ()=>{ profileWindowEl.style.display = 'none'; profileWindowEl.setAttribute('aria-hidden','true'); };

  /* Daily & quest */
  let questClaimed = localStorage.getItem('questClaimed') === 'true';
  let lastDaily = +localStorage.getItem('lastDaily') || 0;
  const questStatusEl = document.getElementById('questStatus');
  const dailyStatusEl = document.getElementById('dailyStatus');
  function updateQuestStatus(){ questStatusEl.textContent = questClaimed ? "‚úÖ Completed" : "‚ùå Not claimed"; }
  function updateDailyStatus(){
    const now = Date.now();
    const nextAvailable = lastDaily + 24*60*60*1000;
    if (now >= nextAvailable) dailyStatusEl.textContent = "üí∞ Available!";
    else {
      const diff = nextAvailable - now;
      const hours = Math.floor(diff / (1000*60*60));
      const minutes = Math.floor((diff % (1000*60*60)) / (1000*60));
      dailyStatusEl.textContent = `Next in ${hours}h ${minutes}m`;
    }
  }
  setInterval(updateDailyStatus, 60000); updateDailyStatus(); updateQuestStatus();
  document.getElementById('claimQuest').onclick = ()=>{
    if (questClaimed) alert(t('questAlready'));
    else { updCoins(50000); questClaimed = true; localStorage.setItem('questClaimed','true'); updateQuestStatus(); }
  };
  document.getElementById('claimDaily').onclick = ()=>{
    const now = Date.now();
    if (now - lastDaily < 24*60*60*1000) alert(t('dailyAlready'));
    else { updCoins(30000); lastDaily = now; localStorage.setItem('lastDaily', now); updateDailyStatus(); }
  };

  /* Info window */
  const infoWindowEl = document.getElementById('infoWindow');
  document.getElementById('infoBtn').onclick = ()=>{ infoWindowEl.style.display = 'block'; infoWindowEl.setAttribute('aria-hidden','false'); };
  document.getElementById('closeInfo').onclick = ()=>{ infoWindowEl.style.display = 'none'; infoWindowEl.setAttribute('aria-hidden','true'); };

  /* Initialize */
  // –°–∫—Ä—ã–≤–∞–µ–º –≤–∏–¥–∏–º—É—é –ø–∞–Ω–µ–ª—å –º–∞–π–Ω–µ—Ä–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ
  minersPanelVisible.style.display = 'none';
  document.getElementById('coinsVal').textContent = format(coins);
  updLv(); updUpg(); updIncome(); updCheck(); updTimers(); applyLang();

  // Listing countdown
  const listingCountdownEl = document.getElementById('listingCountdown');
  const listingTime = Date.now() + 122*24*60*60*1000;
  function updateListingCountdown() {
    const now = Date.now();
    const diff = listingTime - now;
    if (diff < 0) { listingCountdownEl.textContent = '0d 0h 0m 0s'; return; }
    const days = Math.floor(diff/(1000*60*60*24));
    const hours = Math.floor((diff%(1000*60*60*24))/(1000*60*60));
    const minutes = Math.floor((diff%(1000*60*60))/(1000*60));
    const seconds = Math.floor((diff%(1000*60))/1000);
    listingCountdownEl.textContent = days+'d '+hours+'h '+minutes+'m '+seconds+'s';
  }
  setInterval(updateListingCountdown, 1000);
  </script>
</body>
</html>
